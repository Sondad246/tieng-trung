<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hán Ngữ</title>
<style>

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
/* Hiệu ứng bùng nổ cho ô pinyin - giữ nguyên vàng cam */
.pinyin-box.reveal {
  animation: pinyinReveal 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes pinyinReveal {
  0% {
    transform: scale(0.2);
    background-color: gold;
    box-shadow: 0 0 20px gold;
    opacity: 0;
  }
  40% {
    transform: scale(1.2);
    background-color: orange;
    box-shadow: 0 0 30px orange;
    opacity: 1;
  }
  70% {
    transform: scale(0.9);
    background-color: #bdc3c7;
    box-shadow: 0 0 10px #bdc3c7;
  }
  100% {
    transform: scale(1);
    background-color: #bdc3c7;
    box-shadow: none;
  }
}

/* Hiệu ứng cho nghĩa tiếng Việt - dùng vàng cam text-shadow */
.meaning-pop {
  animation: meaningPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  display: inline-block;
}

@keyframes meaningPop {
  0% {
    transform: scale(0.2) translateY(15px);
    opacity: 0;
  }
  50% {
    transform: scale(1.05) translateY(-3px);

    opacity: 1;
  }
  100% {
    transform: scale(1) translateY(0);
    text-shadow: none;
  }
}

/* Hiệu ứng cho pinyin tooltip - dùng vàng cam text-shadow */
.pinyin-tooltip-pop {
  animation: tooltipPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  display: inline-block;
}

@keyframes tooltipPop {
  0% {
    transform: scale(0.2) translateY(15px);
    opacity: 0;
  }
  50% {
    transform: scale(1.05) translateY(-3px);

    opacity: 1;
  }
  100% {
    transform: scale(1) translateY(0);
    text-shadow: none;
  }
}
#soundStatusIcon {
    position: absolute;
    right: 10px;
    top: 10px;
    z-index: 1000;
    font-size: 50px;
    transition: opacity 0.4s ease-in-out;
}
.pinyin-separator {
    color: #9999; /* màu xám */
}


 .gear-icon {
            cursor: pointer;
            margin-right: 25px;
            transition: transform 0.3s;
            font-size: 28px !important;
        }
        
        .gear-icon:hover {
         transform: scale(1.8);
        }
        
        .voice-options {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        
        .voice-options.active {
            display: block;
        }
        
        .voice-control {
            margin-bottom: 10px;
        }
        
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
        }
        
        #soundStatusIcon {
            margin-left: 10px;
            font-size: 18px;
        }
        
        .test-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .test-button:hover {
            background-color: #45a049;
        }
.login-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none; /* THAY ĐỔI: Ẩn mặc định */
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.login-container {
    background-color: #2d2d2d;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    width: 380px;
    text-align: center;
    border: 1px solid #404040;
    position: relative;
    overflow: hidden;
    animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.login-container::before {

    content: ''; 
    position: absolute;
    top: -100%;
    left: 0;
    width: 100%;
    height: 30px;
    background: linear-gradient(
        to right,
        transparent,
        rgba(72, 226, 74, 0.6),
        transparent

    );
    animation: horizontalLight 10s linear infinite;
    z-index: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 0 0 5px rgba(0,0,0,0.8);
}

.login-container::after {

    content: ''; 
    position: absolute;
    top: 0;
    left: -100%;
    width: 30px;
    height: 100%;
    background: linear-gradient(
        to bottom,
        transparent,
        rgba(72, 226, 74, 0.6),
        transparent
    );
    animation: verticalLight 10s linear infinite;
    z-index: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 14px;
    writing-mode: vertical-rl; /* HIỂN THỊ DỌC */
    text-orientation: mixed;
    text-shadow: 0 0 5px rgba(0,0,0,0.8);
}

@keyframes horizontalLight {
    0% {
        top: -100%;
    }
    50% {
        top: 150%;
    }
    100% {
        top: -100%;
    }
}

@keyframes verticalLight {
    0% {
        left: -100%;
    }
    50% {
        left: 150%;
    }
    100% {
        left: -100%;
    }
}

.login-content {
    position: relative;
    z-index: 1;
}

.phone-display {
    background-color: #3a3a3a;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
    border: 1px solid #555;
    font-size: 18px;
    font-weight: bold;
    color: #a8e6a8;
    display: none;
    transition: all 0.3s ease;
}

.login-title {
    color: #f0f0f0;
    margin-bottom: 20px;
}

.login-input {
    width: 100%;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid #555;
    border-radius: 4px;
    box-sizing: border-box;
    background-color: #3a3a3a;
    color: #e0e0e0;
    font-size: 16px;
    text-align: center;
    position: relative;
    z-index: 1;
}

.login-input:focus {
    outline: none;
    border-color: #4a90e2;
    box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
}

.login-button-container {
    display: flex;
    gap: 10px;
    justify-content: space-between;
    position: relative;
    z-index: 1;
}

.phone-btn {
    background-color: #666;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
    width: 30%;
    font-size: 25px;
    padding: 10px;
}

.phone-btn:hover {
    background-color: #777;
}

.confirm-btn {
    background-color: #4a90e2;
    color: white;
    padding: 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
    width: 70%;
    font-size: 14px;
}

.confirm-btn:hover {
    background-color: #3a7bc8;
}

.login-message {
    margin-top: 15px;
    padding: 10px;
    border-radius: 4px;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

.success {
    background-color: #2d5a2d;
    color: #a8e6a8;
}

.error {
    background-color: #5a2d2d;
    color: #e6a8a8;
}

.hidden {
    display: none;
}

.password-attempts {
    background-color: #5a2d2d;
    color: #e6a8a8;
    padding: 10px;
    border-radius: 4px;
    margin-top: 15px;
    display: none;
    border: 1px solid #7a4d4d;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

.lesson-sidebar {
  transition: transform 0.3s;
}

/* Nút toggle để hiện/ẩn slider */
.height-toggle-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.height-toggle-btn:hover {
    background: rgba(255, 255, 255, 1);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Slider container khi hiển thị */
.slider-container.show {
    display: flex;
    animation: slideIn5 0.3s ease;
    right: -90px; 
    z-index: 900;/* Thêm dòng này để khi hiện sẽ di chuyển vào vị trí mong muốn */
}

.slider-container.hide {
    animation: slideOut5 0.3s ease forwards;
}

@keyframes slideIn5 {
    from {
        opacity: 0;
        right: -200px; /* Đồng bộ với vị trí ban đầu */

    }
    to {
        opacity: 1;
        right: -90px; /* Vị trí khi hiển thị hoàn toàn */
    }
}

@keyframes slideOut5 {
    from {
        opacity: 1;
        right: -90px;
    }
    to {
        opacity: 0;
        right: -200px; /* Quay lại vị trí ẩn */
        display: none;
    }
}
/* Dark mode cho nút */
.dark-mode .height-toggle-btn {
    background: rgba(30, 30, 30, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
}

.dark-mode .height-toggle-btn:hover {
    background: rgba(50, 50, 50, 1);
}

.slider-container {
    position: fixed;
    right: -200px; /* Đã sửa từ -200px thành -100px */
    bottom: 40px;
    transform: translateY(-50%) rotate(270deg);
    transform-origin: left center;
    z-index: 1;
    background: rgba(255, 255, 255, 1);
    color: #333;
    padding: 15px 10px;
    border-radius: 6px;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    backdrop-filter: blur(5px);
    min-height: 25px;
    justify-content: center;
    box-sizing: border-box;
    width: auto;
    height: auto;
    border: 1px solid rgba(0, 0, 0, 0.1);
}
#inputHeightSlider {
    writing-mode: bt-lr;
    width: 120px;
    height: 7px;
    background: transparent;
    outline: none;
    cursor: pointer;
    border: 1px solid #666; /* Viền trung tính */
    -webkit-appearance: none;
    appearance: none;
    margin: 0 auto;
    border-radius: 2px;
}

#inputHeightSlider::-webkit-slider-track {
    width: 10px;
    height: 4px;
    background: #ddd; /* Track sáng hơn */
    auto   border-radius: 2px;
    cursor: pointer;
    border: 1px solid #999; /* Viền nhẹ hơn */
}

#inputHeightSlider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 17px;
    height: 30px;
    background: #444; /* Màu trung tính */
    border-radius: 4px;
    cursor: pointer;
    border: 2px solid #777;
    transition: all 0.2s ease-in-out;
}

#inputHeightSlider:hover::-webkit-slider-thumb {
    background: #6c9bc2; /* Xanh lam nhạt khi hover */
    transform: scale(1.05);
    border-color: #4a7ba6;
}

#inputHeightSlider:active::-webkit-slider-thumb {
    background-color: #2ecc71; /* Xanh lá khi click */
    transform: scale(1.1);
    border-color: #27ae60;
}

#inputHeightSlider:hover::-webkit-slider-track {
    background: #ccc;
    border-color: #777;
}

/* Dark Mode Styles */
.dark-mode .slider-container {
    background: rgba(130, 130, 130, 0.1); /* Nền tối đậm hơn */
    color: #fff; /* Chữ sáng */
    border: 1px solid rgba(255, 255, 255, 0.1); /* Viền sáng nhẹ */
}

.dark-mode #inputHeightSlider {
    border: 1px solid #888; /* Viền sáng hơn trong dark mode */
}

.dark-mode #inputHeightSlider::-webkit-slider-track {
    background: #555; /* Track tối hơn */
    border: 1px solid #777;
}

.dark-mode #inputHeightSlider::-webkit-slider-thumb {
    background: #aaa; /* Thumb sáng hơn trong dark mode */
    border: 2px solid #888;
}

.dark-mode #inputHeightSlider:hover::-webkit-slider-thumb {
    background: #4a7ba6; /* Xanh đậm hơn khi hover trong dark mode */
    border-color: #3a6b96;
}

.dark-mode #inputHeightSlider:active::-webkit-slider-thumb {
    background-color: #27ae60; /* Xanh lá đậm hơn khi click */
    border-color: #219653;
}

.dark-mode #inputHeightSlider:hover::-webkit-slider-track {
    background: #666;
    border-color: #888;
}

/* Phần mới: Phân tích bộ thủ */
.radical-analysis {
  position: fixed;
  top: 50%;
  right: 20px;
  width: 220px;
  background-color: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  z-index: 15;
  max-height: auto;
  position: absolute;
  transform: translateY(-50%);
}
.dark-mode .radical-analysis {
  background-color: rgba(40, 40, 40, 0.95);
}

.radical-header {
  font-size: 22px;
  font-weight: bold;
  color: #e74c3c;
  margin-bottom: 15px;
  text-align: center;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.radical-item {
  margin: 10px 0;
  padding: 10px;
  background-color: #f9f9f9;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.dark-mode .radical-item {
  background-color: #2d2d2d;
}

.radical-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.radical-character {
  font-size: 25px;
  font-weight: bold;
  text-align: center;
  margin-bottom: -5px;
}

.radical-component {
  margin: 1px 0;
  padding: 4px 0;
  display: flex;
  flex-direction: column;
  align-items: left;
}
.radical-hanzi {
  font-size: 20px;
  min-width: 25px;
  text-align: center;
  font-style: normal; 
  font-weight: 600;
}
.radical-hint {
  font-size: 18px;
  color: rgba(128, 128, 128, 0.7);
}

..radical-line1 {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.radical-pinyin {
  color: rgba(128, 128, 128, 0.7);
  font-size: 16px;
}

/* Khi pinyin nằm trong dòng đầu tiên (không có hint) */
.radical-line1 .radical-pinyin {
  margin-left: 8px;
}

/* Khi pinyin nằm ở dòng riêng (có hint) */
.radical-component > .radical-pinyin {
  display: block;
  margin-bottom: 4px;
}

.radical-meaning {
  display: block;
  color: #3498db;
  font-size: 16px;
}


.no-radicals {
  text-align: center;
  color: red;
  font-style: italic;
  padding: 20px 0;
}

/* Thêm vào phần CSS hiện có */
.result-container.victory {
  min-width: 500px;
  display: block;
  border: 4px solid #ffd600;
  border-radius: 20px;
  padding: 40px;
  position: relative;
  box-shadow: 0 4px 15px rgba(255, 214, 0, 0.3);
  animation: fadeIn 0.5s ease-out;
  margin: -40px;
  z-index: 20;
  color: #333;
  background: linear-gradient(135deg, #fff9c4, #ffecb3);
}

@keyframes wordCounterAppear {
  0% {
    opacity: 1;
    transform: translateY(-300px);
  } 
  50% {
    opacity: 1;
    transform: translateY(+30px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}
.lesson-sidebar:hover {
  transform: translateY(-50%) scale(1.05); 
}

.result-container.victory::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.2) 0%,
    rgba(255, 235, 59, 0.4) 100%
  );
  border-radius: 20px;
  pointer-events: none;
  mix-blend-mode: soft-light;
}

.energy-particle {
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  z-index: 100;
  animation: particleFloat 3s ease-out forwards;
}

@keyframes particleFloat {
  0% {
    transform: translate(0, 0);
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx), var(--ty));
    opacity: 0;
  }
}

.victory-title {
  animation: pulseGold 0.5s infinite alternate;
}

@keyframes pulseGold {
  0% { 
    transform: scale(1);
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
  }
  100% { 
    transform: scale(1);
    text-shadow: 0 0 20px gold, 0 0 20px gold;
  }
}



@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.25; }
    100% { opacity: 1; }
}
.word-counter {
  display:none;
  position: fixed;
  top: 80px;
  left: 20px;
  background-color: rgba(255, 255, 255, 0.9);
  border-radius: 10px;
  padding: 2px 15px;
  font-size: 40px;
  font-weight: bold;
  color: rgba(0, 0, 0, 0.1);
  z-index: 0;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  margin-top: 10px; 
 animation: wordCounterAppear 0.5s ease-out forwards;
opacity: 0; 
}

.dark-mode .word-counter {
  background-color: rgba(40, 40, 40, 0.9);
  color: rgba(255, 255, 255, 0.1);
}

.special-lessons {
 position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 15px;
  z-index: 100;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);

}

.special-lesson-btn {
  background: rgba(240, 240, 240, 0.9);
  color: gray;
  border: none;
  min-width: 110px;
  min-height: 70px;
  border-radius: 10px;
  font-size: 0px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.special-lesson-btn:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  background: rgba(180, 180, 180, 0.5);
}

.special-lesson-btn span {
  font-size: 16px;
  margin-top: 5px;
  display: block;
}

/* Dark mode */
.dark-mode .special-lessons {
 background: rgba(40, 40, 40, 0.5);
  border-color: #2ecc71;
}
.dark-mode .special-lesson-btn {
 background: rgba(35, 35, 35, 0.9);
}


.dark-mode .special-lesson-btn:hover {
 background: rgba(20, 20, 20, 0.8);
}

.catalog-tabs {
  display: flex;
  border-bottom: 1px solid #f0f0f0;
  background-color: #f8f9fa;
}

.catalog-tab {
  flex: 1;
  padding: 12px;
  background: none;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  font-size: 14px;
  color: #7f8c8d;
  font-weight: 500;
  transition: none; 
}
.catalog-tab.active {
  color: #3498db;
  border-bottom-color: #3498db;
  font-weight: 600;
}

.catalog-content {
  display: none;
  padding: 15px;
  max-height: calc(70vh - 120px);
  overflow-y: auto;
    scrollbar-width: thin;
  scrollbar-color: #3498db #f1f1f1;



}
.catalog-content::-webkit-scrollbar {
  width: 8px;
}

.catalog-content::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.catalog-content::-webkit-scrollbar-thumb {
  background: linear-gradient(45deg, #95a5a6, #7f8c8d);
  border-radius: 3px;
  transition: background 0.3s ease;
}

.catalog-content::-webkit-scrollbar-thumb:hover {
  background: #2980b9;
}
.catalog-content.active {
  display: block;
}
body.dark-mode {
  background: linear-gradient(135deg, #121212, #1e1e1e);
  color: #e0e0e0;
}

.dark-mode .container {
  background-color: #2d2d2d;
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
}

.dark-mode .chinese {
  color: #ffffff;
}

.dark-mode .vietnamese,
.dark-mode .next-word-preview {
  color: #b0b0b0;
}

.dark-mode #chineseInput {
  background-color: #3d3d3d;
  color: white;
  border-color: #4a4a4a;
}


.dark-mode .lesson-sidebar {
  background-color: rgba(51, 51, 51, 0.9);
}
.dark-mode #lessonSidebar h3,
.dark-mode .lesson-sidebar-item {
  color: #e0e0e0 !important;
}


.dark-mode .lesson-sidebar-item:hover {
  background-color: #444;
  color: #fff !important;
transition: background-color 0.3s, color 0.3s; 
}

.dark-mode .lesson-sidebar-item.active {
  background-color: #1e88e5;
}

.dark-mode .lesson-selection .lesson-title {
  color: #ffffff !important;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}
.dark-mode .dictionary-title {
  color: #1e90ff; /* DodgerBlue */
}
/* Đổi màu icon */
.dark-mode #lessonSidebar h3::before {
  filter: brightness(1.5);
}

body, .container, #chineseInput {
  transition: background-color 0.3s ease, color 0.3s ease;
}

#gameScreen #darkModeToggle {
  display: none;
}

.add-word-modal #darkModeToggle,
.lesson-catalog #darkModeToggle {
  display: none;
}

.time-settings {
  padding: 20px;
  background: #f8f9fa;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  margin-top: 5px;

}
.time-control {
  display: flex;
  align-items: center;
  margin: 3px 0;
  padding: 15px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  transition: all 0.3s ease;

  position: relative;
  padding-right: 1px;
}

.time-control:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}

.time-control label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
.time-control-input-group {
  display: flex;
  align-items: center;
  position: absolute;
  right: 15px; 
}
.time-control input {
  width: 70px;
  padding: 12px;
  border: 2px solid #3498db;
  border-radius: 8px;
  text-align: center;
  font-size: 16px;
  font-weight: 600;
  color: #2c3e50;
  background: #f1f9ff;
  transition: all 0.3s ease;
}

.time-control input:focus {
  border-color: #ff6b81;
  box-shadow: 0 0 0 3px rgba(255, 107, 129, 0.2);
  outline: none;
}

.time-control span {
  margin-left: 10px;
  font-size: 14px;
  color: #7f8c8d;
  min-width: 50px;
}
#showVietnamese {
 position: absolute;
  width: 30px;
  height: 30px;
  right: 15px;
  margin-left: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.time-control:has(#showVietnamese) {
  align-items: center;
  padding: 15px;
}

.time-control:has(#showVietnamese) label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#showVietnamese:hover {
    transform: scale(1.2);
}

#showVietnamese:checked {
    accent-color: #4CAF50;
}

#showRadicalAnalysis {
 position: absolute;
  width: 30px;
  height: 30px;
  right: 15px;
  margin-left: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.time-control:has(#showRadicalAnalysis) {
  align-items: center;
  padding: 15px;
}

.time-control:has(#showRadicalAnalysis) label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#showRadicalAnalysis:hover {
    transform: scale(1.2);
}

#showRadicalAnalysis:checked {
    accent-color: #4CAF50;
}
#swapDisplay {
 position: absolute;
  width: 30px;
  height: 30px;
  right: 15px;
  margin-left: 10px;
    cursor: pointer;
  transition: transform 0.3s ease;
}

.time-control:has(#swapDisplay) {
  align-items: center;
  padding: 15px;
}

.time-control:has(#swapDisplay) label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#swapDisplay:hover {
    transform: scale(1.2);
}

#swapDisplay:checked {
    accent-color: #4CAF50;
}

#autoPronounce {
 position: absolute;
  width: 30px;
  height: 30px;
  right: 15px;
  margin-left: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.time-control:has(#autoPronounce) {
  align-items: center;
  padding: 15px;
}

.time-control:has(#autoPronounce) label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#autoPronounce:hover {
    transform: scale(1.2);
}

/* Đổi màu dấu tích thành xanh lá */
#autoPronounce:checked {
    accent-color: #4CAF50;
}
#listenWriteMode {
 position: absolute;
  width: 30px;
  height: 30px;
  right: 15px;
  margin-left: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

#preSpeak {

  width: 20px;
  height: 20px;
  height: 20px;
  cursor: pointer;
  transition: transform 0.3s ease;
}
#postSpeak {
  width: 20px;
  height: 20px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.time-control:has(#listenWriteMode) label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#listenWriteMode:hover {
    transform: scale(1.2);
}

/* Đổi màu dấu tích thành xanh lá */
#listenWriteMode:checked {
    accent-color: #4CAF50;
}


#showExampleInstead {
 position: absolute;
  width: 30px;
  height: 30px;
  right: 15px;
  margin-left: 10px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.time-control:has(#showExampleInstead) {
  align-items: center;
  padding: 15px;
}

.time-control:has(#showExampleInstead) label {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#showExampleInstead:hover {
    transform: scale(1.2);
}

/* Đổi màu dấu tích thành xanh lá */
#showExampleInstead:checked {
    accent-color: #4CAF50;
}



#bulkAddWords {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  margin-bottom: 10px;
  font-family: inherit;
}

.creator-signature {
  position: fixed;
  bottom: 0px;
  right: 15px;
  font-family: 'Cormorant Garamond', monospace;
  font-size: 16px;
  color: #6c757d;
  display: flex;
  align-items: center;
  gap: 5px;
  z-index: 9999;
}
.move-btn {
  padding: 5px 10px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.move-btn:hover {
  background-color: #2980b9;
}

.move-options {
    max-height: 50vh;  
    overflow-y: auto;
    display: none;
    position: fixed;
    background: white;
    border: 1px solid #f0f0f0; /* Đổi thành xám siêu nhạt */
    border-radius: 5px;
    padding: 10px;
    z-index: 9999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* Làm nhẹ bóng đổ */
    color: #555;
}

.move-options::-webkit-scrollbar {
    width: 8px;
}

.move-options::-webkit-scrollbar-track {
    background: #fafafa; /* Xám siêu nhạt */
    border-radius: 3px;
    margin: 10px 0;
}

.move-options::-webkit-scrollbar-thumb {
    background: #e0e0e0; /* Xám rất nhạt */
    border-radius: 2px;
    transition: background 0.3s ease;
}

.move-options::-webkit-scrollbar-thumb:hover {
    background: #d0d0d0; /* Xám nhạt khi hover */
}


.move-option {
    padding: 8px 12px;
    cursor: pointer;
    white-space: nowrap;

}

.move-option:hover {
    background-color: #f1f1f1;
}
.add-word-form {
  width: 100%;
  max-width: 500px;
  margin: 0 auto;
  height: auto; 
  min-height: 200px; 
  overflow: hidden; 

}

.form-row {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
}

.form-label {
  width: 100px;
  text-align: left;
  margin-right: 10px;
  font-weight: bold;
}

.form-input {
  flex: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  min-width: 0; 
}


body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
background: linear-gradient(135deg, #f5f7fa, #e4edf9);
padding: 20px;
position: relative;
overflow: hidden;
}
.message {
  padding: 10px 15px;
  border-radius: 5px;
  margin: 10px 0;
  text-align: center;
  animation: fadeIn 0.3s;
}

.message.success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.message.error {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.container {
background-color: #ffffff;
border-radius: 20px;
box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
padding: 40px;
width: 100%;
width: auto !important;
text-align: center;
position: relative;
overflow: hidden;
z-index: 800;
animation: none;
opacity: 1;
animation-fill-mode: forwards;
position: relative;
}
.normal-lesson .container {
  animation: containerAppear 0.6s ease-out forwards;
  opacity: 0;
}
@keyframes containerAppear {
  0% {
    transform: translateY(-80px);
    opacity: 0;
  }
  50% {
    transform: translateY(15px);
    opacity: 1;
  }

  100% {
    transform: translateY(0);
    opacity: 1;
  }
}
.special-lesson .container {
  animation: simpleFadeIn 0.6s ease-out forwards;
}
@keyframes simpleFadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}
.time-bar-container {
position: fixed;
top: -50px;
left: 50%;
transform: translateX(-50%);
width: 99%;
height: 12px;
z-index: 100;
overflow: hidden;
display: none;
border: 2px solid #000;
background-color: #f5f5f5;
border-radius: 8px;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
animation: slideDown 0.6s ease-out forwards;
}
.export-btn:hover {
  background-color: #45a049;
}

.time-bar-container.hide {
animation: slideOut 0.6s ease-in forwards;
}

.time-progress {
height: 100%;
width: 0%;
background: linear-gradient(90deg, #2ecc71, #27ae60);
border-radius: 6px;
transition: width 0.1s linear;
}

.dictionary-section {
display: block;
position: fixed;
bottom: 95px;
Right: 20px;
z-index: 1000;
}

.dictionary-btn {
background: linear-gradient(45deg, #3498db, #2980b9);
color: white;
border: none;
width: 60px;
height: 60px;
border-radius: 50%;
font-size: 40px;
cursor: pointer;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
transition: all 0.3s;
}

.dictionary-btn:hover {
transform: scale(1.1);
box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}



.dictionary-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.7);
z-index: 2000;
justify-content: center;
align-items: flex-start; 
padding-top: 50px;
overflow-y: auto;
scrollbar-width: thin;
scrollbar-color: #9b59b6 #f8f9fa;

}


.dictionary-modal::-webkit-scrollbar {
    width: 8px;
}

.dictionary-modal::-webkit-scrollbar-track {
    background: #f8f9fa;
    border-radius: 4px;
    margin: 10px 0;
}

.dictionary-modal::-webkit-scrollbar-thumb {
    background: linear-gradient(45deg, #95a5a6, #7f8c8d);
    border-radius: 4px;
    transition: background 0.3s ease;
}

.dictionary-modal::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(45deg, #7f8c8d, #6c757d);
}
.dictionary-content {
width: 90%;
max-width: 1500px;
max-height: 80vh;
}

.lesson-tabs {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin-bottom: 20px;
padding-bottom: 10px;
border-bottom: 1px solid #eee;
  align-items: center;
}

.lesson-tab {
padding: 8px 16px;
background: #f1f1f1;
border-radius: 20px;
cursor: pointer;
transition: all 0.3s;
}

.lesson-tab:hover {
background: #ddd;
}

.lesson-tab.active {
background: #3498db;
color: white;
}

.search-container {
margin-bottom: 20px;
position: relative;
}

#dictionarySearch {
width: 100%;
padding: 12px 15px;
border: 2px solid #ddd;
border-radius: 8px;
font-size: 16px;
white-space: pre; 
text-transform: none;
}

#dictionarySearch:focus {
border-color: #3498db;
outline: none;
}

.words-container {
display: none;
}

.words-container.active {
display: block;
}

.word-count {
font-size: 14px;
color: #999;
margin-bottom: 10px;
}
.dictionary-title {
font-size: 32px;
margin-bottom: 15px;
color: #1e90ff;
text-align: center;
}

.dictionary-words {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
gap: 10px;
}

.word-card {
border: 1px solid #ddd;
border-radius: 8px;
padding: 10px;
background-color: #f9f9f9;
}

.word-card h3 {
margin-top: 0;
color: #2c3e50;
}

.word-card p {
margin: 5px 0;
color: #7f8c8d;
}

.word-actions {
display: flex;
justify-content: space-between;
margin-top: 10px;
}

.edit-btn, .delete-btn {
padding: 5px 10px;
border: none;
border-radius: 4px;
cursor: pointer;
font-size: 14px;
}

.edit-btn {
background-color: #f39c12;
color: white;
}

.delete-btn {
background-color: #e74c3c;
color: white;
}

.edit-word-form {
margin-top: 15px;
border-top: 1px solid #eee;
padding-top: 15px;
}

.edit-word-form input {
width: 100%;
padding: 8px;
margin-bottom: 5px;
border: 1px solid #ddd;
border-radius: 4px;
}

.save-btn, .cancel-edit-btn {
padding: 5px 10px;
margin-right: 5px;
border: none;
border-radius: 4px;
cursor: pointer;
}

.save-btn {
background-color: #2ecc71;
color: white;
}

.cancel-edit-btn {
background-color: #95a5a6;
color: white;
}

.dictionary-buttons {
display: flex;
justify-content: space-between;
margin-top: 20px;
}
.export-btn {
padding: 10px 20px;
background-color: #4CAF50;
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
margin: 10px 0;
font-size: 16px;
}


.close-dictionary {
background: #e74c3c;
color: white;
border: none;
padding: 10px 20px;
border-radius: 4px;
cursor: pointer;
font-size: 16px;
margin: 10px 0;
}

.word-display {
margin: 20px 0;
flex-direction: column;
gap: 30px;
min-height: 300px;
overflow: hidden;
display: none;
align-items: center;
}



.pinyin-box {
width: 30px;
height: 30px;
background-color: #2ecc71;
border: 2px solid #000; 
border-radius: 5px;
display: flex;
justify-content: center;
align-items: center;
color: transparent; /* Ẩn số */
font-weight: normal;
z-index: 1;
}

.pinyin-box.used {
background-color: #bdc3c7; 
border: 2px solid #000; 
}

.chinese {
margin-bottom: 10px;
font-size: 72px;
color: #2f3542;
font-weight: bold;
position: relative;
z-index: 10;
font-family: "Microsoft YaHei", "SimHei", sans-serif;
transition: none;
padding: 10px 40px; /* Thêm padding dọc để tạo không gian */
display: inline-block;
min-width: 250px; 

}
.chinese-intro {

  animation: slideInFromRight 0.4s forwards;
}

.vietnamese {
    font-size: 24px;
    color: #57606f;
    margin-bottom: 20px;
    animation: slideInFromLeft 0.6s forwards;
    position: relative;
    min-height: 32px; 
    display: flex;
    align-items: center;
    justify-content: center;
}
/* Hiệu ứng bùng nổ cho ô pinyin */

.pinyin-tooltip {
color: #e84118;
font-style: italic;
margin-right: 10px;
display: none;
}

.correct-pinyin {
    color: #2ecc71 !important; 
}
.incorrect-pinyin {
    color: #e84118 !important;
}
.correct-pinyin2 {
    color: rgba(0, 255, 0, 0.2) !important;
}
.incorrect-pinyin2 {
    color: rgba(255,0,0,0.2 ) !important; 
}


.next-word-preview {
font-size: 36px;
color: rgba(0, 0, 0, 0.3);
margin-bottom: 40px;
font-family: "Microsoft YaHei", "SimHei", sans-serif;
height: 45px;
animation: slideInFromLeft 0.6s forwards; 
will-change: transform, opacity;

}

/* Định vị visualizer ở giữa input area */
.input-area {
    position: relative; /* Quan trọng: tạo context cho absolute */
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 450px;
    padding: 0 0 15px;
    z-index: 801;
    opacity: 0;
}

#audio-visualizer {
    position: absolute;
    top: -28%;
    left: 48%;
    transform: translate(-50%, -50%) scale(0.6);
    z-index: 802;
    opacity: 0;
    visibility: hidden;
    display: inline-flex;
    align-items: center;
    gap: 3px;
    height: 30px;
    transition: opacity 0.4s ease-out, transform 0.4s ease-out, visibility 0.4s ease-out;
    will-change: opacity, transform, visibility;
}

#audio-visualizer.visible {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    visibility: visible;
}

/* Đảm bảo input có z-index thấp hơn */
#chineseInput {
    position: relative;
    z-index: 801;
    /* Giữ nguyên các style khác của input */
    width: 100%;
    padding: 20px;
    font-size: 43px;
    border: 3px solid #e0e0e0;
    border-radius: 12px;
    height: 70px;
    text-align: center;
    outline: none;
    background: #f8f9fa;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.input-area.visible {
    animation: slideInputUp 0.5s ease-out forwards;
    opacity: 1;
    bottom: var(--input-area-height, 30vh);
}

.input-area.hiding {
animation: slideInputDown 0.6s ease-in forwards;
}



#chineseInput:focus {
  box-shadow: 0 0 0 3px rgba(200, 200, 200, 0.3); 
}

#chineseInput::placeholder {
  color: rgba(128, 128, 128, 0.1); 
}

.result-container {
display: none;
margin-top: 20px;
animation: fadeIn 0.5s ease-out;
}

.result-header {
  display: flex;
  justify-content: left;
  position: relative;
  margin-bottom: 25px;
  align-items: center; 
  margin-top: -30px;

}

.result-title {
  font-size: 55px;
  font-weight: bold;
  color: #059669;
  position: relative; 
  display: inline-block; 
  padding: 10px 20px; 
}

.result-title::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(200, 200, 200, 0.15);
  border-radius: 10px; /* Độ bo góc */
  z-index: -1; /* Đặt phía sau chữ */
}


.high-score {
  position: absolute;
  right: 0;
  font-size: 40px;
  color:  #27ae60;
  font-weight: bold;
  display: inline-block;
  padding: 20px 10px; 
}
.high-score::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(200, 200, 200, 0.15);
  border-radius: 10px; 
  z-index: -1; 
}



.result-stats {
font-size: 30px;
color: #27ae60;
}  



.wrong-words {
text-align: left;
margin-top: 30px;
max-height: 350px;
overflow-y: auto;
padding-right: 15px;
font-size: 26px;
}
.wrong-words::-webkit-scrollbar {
    width: 8px;
}

.wrong-words::-webkit-scrollbar-track {
    background: #f1f1f1; /* Màu xám nhạt cho phần track */
    border-radius: 3px;
    margin: 10px 0;
}

.wrong-words::-webkit-scrollbar-thumb {
    background: #343a40; /* Màu xám đậm */
    border-radius: 2px;
    transition: background 0.3s ease;
}

.wrong-words::-webkit-scrollbar-thumb:hover {
    background: #2b3035; /* Màu đen/gray-900 khi hover */
}



.wrong-word {
display: flex;
justify-content: space-between;
padding: 15px 0;
border-bottom: 1px solid gray;
align-items: center;
}

.wrong-word .move-btn {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #3498db;
    padding: 5px;
    margin-left: 10px;
}

.wrong-word .move-btn:hover {
    transform: scale(1.2);
    color: #2980b9;
}

.mastered-btn {
  padding: 5px 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  background-color: #95a5a6;
  color: white;
}

.mastered-btn.mastered {
  background-color: #2ecc71;
}
.back-btn:hover {
transform: translateY(-2px);
}
.correct-answer {
    animation: correctFlash 0.5s;
    border-radius: 12px;
}

.back-btn {
background: linear-gradient(45deg, #95a5a6, #7f8c8d);
color: white;
border: none;
padding: 15px 35px;
font-size: 18px;
border-radius: 40px;
cursor: pointer;
margin-top: 20px;
font-weight: bold;
box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
transition: transform 0.3s;
min-width: 150px;
}


.restart-btn {
background: linear-gradient(45deg, #ff4757, #e84118);
color: white;
border: none;
padding: 15px 35px;
font-size: 18px;
border-radius: 40px;
cursor: pointer;
margin-top: 20px;
font-weight: bold;
box-shadow: 0 5px 15px rgba(232, 65, 24, 0.3);
transition: transform 0.3s, box-shadow 0.3s;
min-width: 150px;
}

.restart-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 20px rgba(232, 65, 24, 0.4);
}
    
.decor {
position: absolute;
font-size: 120px;
color: rgba(255, 255, 255, 0.05);
z-index: 1;
user-select: none;
}

.decor-1 { top: 10%; left: 5%; transform: rotate(-15deg); }
.decor-2 { top: 20%; right: 10%; transform: rotate(25deg); }
.decor-3 { bottom: 15%; left: 15%; transform: rotate(15deg); }
.decor-4 { bottom: 20%; right: 5%; transform: rotate(-20deg); }

/* Phần chọn bài học */
.lesson-selection {
text-align: center;
margin-bottom: 30px;
}


.lesson-title {
  font-size: 32px;
  margin-bottom: 25px;
  color: #2c3e50;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  text-align: center;  
}
.lesson-selection .lesson-title {
  font-size: 32px !important;
  margin-bottom: 0px;
  color: #2c3e50;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  text-align: center;
  display: block;
  width: 100%;
}

.lessons-container {
display: grid;
grid-template-columns: repeat(5, 1fr);
gap: 7.5px;
margin: 20px auto;
max-width: 500px;
}
.current-lesson-title {
position: fixed;
top: -20px; 
left: 20px ;
font-size: 18px;
color: #2c3e50;
font-weight: bold;
z-index: 20;
background-color: rgba(255, 255, 255, 0.9);
padding: 8px 20px;
border-radius: 8px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
text-align: center;
width: auto;
max-width: 80%;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
border: 2px solid #000;
animation-duration: 0.6s;
animation-fill-mode: forwards;

}
.pinyin-indicator {
position: fixed;
top: -70px;
left: 20px;
gap: 10px;
display: none;
flex-wrap: wrap; 
gap: 5px;
width: 180px; 

animation-duration: 0.6s;
animation-fill-mode: forwards;

}
@keyframes shake {
  0%, 100% { 
    transform: translateX(0); 
  }
  25%, 55% { 
    transform: translateX(-8px); /* Giảm từ -10px xuống -8px */
  }
  45%, 75% { 
    transform: translateX(8px); /* Giảm từ 10px xuống 8px */
  }
}

.shake-effect {
animation: shake 0.4s ease-in-out;
}
@keyframes slideDown1 {
0% { top: -50px; }
70% { top: 30px; } 
100% { top: 20px; } 
}

@keyframes slideOut {
0% { top: 20px; }
30% { top: 30px; } 
100% { top: -100px; }
}
@keyframes slideDown2 {
0% { top: -50px; }
70% { top: 80px; } 
100% { top: 70px; }
}


@keyframes slideOut2 {
0% { top: 70px; }
30% { top: 80px; } 
100% { top: -100px; }
}
.show-header .current-lesson-title {
animation-name: slideDown1;
}

.show-header .pinyin-indicator {
animation-name: slideDown2;
}

.lesson-btn {
  background: linear-gradient(45deg, var(--base-color), var(--gradient-color));
  color: white;
  border: 2px solid var(--border-color);
  border-radius: 10px;
  min-width: 80px;
  min-height: 80px; 
  aspect-ratio: 1/1; 
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px; 
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
  padding: 0; 
  position: relative;
}

.lesson-btn:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  background: linear-gradient(45deg, var(--gradient-color), var(--base-color));
  border-color: var(--base-color);
}



.lesson-btn:active {
transform: translateY(0);
}

@keyframes wrongFlash {
0% { background-color: transparent; }
50% { background-color: rgba(255, 71, 87, 0.3); } 
100% { background-color: transparent; }
}
/* Animations */
@keyframes correctFlash {
0% { background-color: transparent; }
50% { background-color: rgba(46, 204, 113, 0.3); }
100% { background-color: transparent; }
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInputUp {
    0% {
        bottom: 10vh;
        opacity: 0;
    }
    70% {
        bottom: calc(var(--input-area-height, 30vh) + 2vh);
    }
    100% {
        bottom: var(--input-area-height, 30vh);
        opacity: 1;
    }
}

@keyframes slideInputDown {
    0% {
        bottom: var(--input-area-height, 30vh);
        opacity: 1;
    }
    40% {
        bottom: calc(var(--input-area-height, 30vh) + 2vh);
    }
    100% {
        bottom: -2vh;
        opacity: 0;
    }
}

@keyframes slideDown {
0% { top: -50px; }
70% { top: 10px; }
100% { top: 5px; }
}


@keyframes slideInFromRight {
0% { transform: translateX(100vw); }
50% { transform: translateX(-30px); }
100% { transform: translateX(0); }
}

@keyframes slideInFromLeft {
0% { transform: translateX(-100vw); }
70% { transform: translateX(30px); }
100% { transform: translateX(0); }
}



@keyframes slideUp {
from { bottom: -80px; }
to { bottom: 20px; }
}

@keyframes fadeInScale {
0% { opacity: 0; transform: scale(0.9); }
100% { opacity: 1; transform: scale(1); }
}


.add-word-section {
display: block;
position: fixed;
bottom: 30px;
right: 20px;
z-index: 1000;
}

.add-word-btn {
background: linear-gradient(45deg, #9b59b6, #8e44ad);
color: white;
border: none;
width: 60px;
height: 60px;
border-radius: 50%;
font-size: 40px;
cursor: pointer;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
transition: all 0.3s;
}

.add-word-btn:hover {
transform: scale(1.1);
box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.add-word-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.7);
z-index: 2000;
justify-content: center;
align-items: center;
overflow-y: auto;

}


.add-word-content {
  max-height: 90vh; 
  position: relative;
  min-height: 540px;
  background-color: white;
  border-radius: 10px;
  padding: 30px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  animation: fadeInScale 0.3s;
  
  & h2.add-word-title {
    background: linear-gradient(45deg, #9b59b6, #8e44ad);
    color: white;
    padding: 15px 20px;
    margin: -30px -30px 20px -30px;
    border-radius: 15px 15px 0 0;
    text-align: center;
    font-size: 20px;
    box-shadow: 0 3px 5px rgba(0,0,0,0.1);
  }
}


.success-message {
position: absolute;
bottom: 20px;
left: 0;
right: 0;
text-align: center;
color: #2ecc71;
font-weight: bold;
animation: fadeIn 0.5s;
padding: 10px;
background: rgba(255,255,255,0.9);
border-radius: 5px;
margin: 0 30px;
}

.add-word-title {
font-size: 24px;
margin-bottom: 20px;
color: #2c3e50;
text-align: center;
}

.add-word-form {
display: flex;
flex-direction: column;
gap: 10px;
}

.add-word-form label {
width: 120px;
text-align: right;
font-weight: bold;  
color: #34495e;
}

.add-word-form input {
  flex: 1;
padding: 12px;
border: 2px solid #bdc3c7;
border-radius: 8px;
font-size: 18px;
}

.add-word-form input:focus {
border-color: #3498db;
outline: none;
}

.add-word-buttons {
display: flex;
justify-content: space-between;
margin-top: 20px;
}

.add-word-submit, .add-word-cancel {
padding: 12px 25px;
border: none;
border-radius: 8px;
font-size: 16px;
cursor: pointer;
transition: all 0.3s;
}

.add-word-submit {
background: linear-gradient(45deg, #2ecc71, #27ae60);
color: white;
}

.add-word-submit:hover {
transform: translateY(-2px);
}

.add-word-cancel {
background: #e74c3c;
color: white;
}

.add-word-cancel:hover {
transform: translateY(-2px);
}

.lesson-selector {
margin-bottom: 20px;
}

.lesson-selector select {
width: 100%;
padding: 12px;
border: 2px solid #bdc3c7;
border-radius: 8px;
font-size: 16px;
}
.wrong-answer {
  animation: wrongFlash 0.4s, shake 0.6s ease-in-out;
  border-radius: 12px;
  animation-fill-mode: forwards;
  position: relative; /* Thêm dòng này */
  z-index: 100; /* Thêm dòng này - tăng z-index để hiển thị trên các phần tử khác */
  overflow: visible; /* Đảm bảo không bị cắt */
}


/* Hiệu ứng cho tiếng Việt khi hoán đổi */
.vietnamese-intro {

    animation: slideInFromRight 0.5s forwards;
}

@keyframes vietnameseSlideIn {
  0% {
    opacity: 0;
    transform: translateX(100px); /* Trượt từ bên phải */
  }
    50% {
    opacity: 0;
    transform: translateX(-20px); /* Trượt từ bên phải */
  }
  100% {
    opacity: 1;
    transform: translateX(0); /* Về vị trí ban đầu */
  }
}


/* Điều chỉnh kích thước và màu sắc cho chế độ hoán đổi */
.swap-mode .target-character {
  font-size: 28px; /* Nhỏ hơn chữ Hán một chút */
  color: #3498db; /* Màu xanh dương cho tiếng Việt */
  font-weight: normal; /* Bỏ đậm nếu cần */
}

.swap-mode .meaning-text {
  font-size: 500px; /* Lớn hơn cho chữ Hán */
  color: #2c3e50;
  font-weight: bold;
}

/* Điều chỉnh container tiếng Việt khi hoán đổi */
.swap-mode #vietnameseMeaning {
  font-size: 18px; /* Chữ Hán ở dưới nhỏ hơn */
  margin-top: 5px;
}



.catalog-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 2999;

}
.lesson-catalog {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80%;
  max-width: 600px;
  max-height: 80vh;
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  z-index: 3000;
  display: none;
  flex-direction: column;
  overflow: hidden;


    animation: fadeInScale2 0.3s;
  transform-origin: center; 

}
@keyframes fadeInScale2 {
  0% { 
    opacity: 0; 
    transform: translate(-50%, -50%) scale(0.9);
  }
  100% { 
    opacity: 1; 
    transform: translate(-50%, -50%) scale(1);
  }
}

.catalog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: linear-gradient(45deg, #3498db, #2980b9);

}
.catalog-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  display: flex;
  align-items: center;
}
.catalog-header::before {
  content: "📚";
  margin-right: 10px;
  font-size: 20px;
}


.close-catalog {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}
.close-catalog:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

.catalog-list {
  padding: 20px;

  background: #f8f9fa; 
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
 margin-top: 5px;
}


/* GIỮ LẠI PHẦN NÀY */
.lesson-item {
  display: flex;
  align-items: center;
  padding: 15px;
  margin: 3px 0; 
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  transition: box-shadow 0.3s ease;
  cursor: pointer;
}

.lesson-item:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}

.lesson-item.active {
  border-left: 3px solid #3498db;
  background-color: #f8fafc;
}


.lesson-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  background: linear-gradient(45deg, #3498db, #2980b9);
  color: white;
  border-radius: 50%;
  font-weight: bold;
  margin-right: 15px;
  flex-shrink: 0;
}

.lesson-title {
  flex: 1;
  font-size: 16px;
  color: #2c3e50;
  font-weight: 500;
}
#catalogList {
  padding: 10px;
}

.lesson-item.active .lesson-number {
  background: linear-gradient(45deg, #2ecc71, #27ae60);
}

.lesson-item.active .lesson-title {
  font-weight: 600;
  color: #3498db;
}
.edit-lesson-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #7f8c8d;
  font-size: 18px;
  padding: 5px;
  margin-left: 10px;
  transition: color 0.2s;
}

.edit-lesson-btn:hover {
  color: #3498db;
  transform: scale(1.1);
}

.edit-controls {
  display: none;
  flex-direction: column;
  gap: 15px;
  margin-top: 15px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  border: 2px solid #e0e0e0;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.color-buttons-container {
  display: flex;
  align-items: center; /* Căn giữa theo chiều dọc */
  gap: 15px;
  justify-content: space-between; /* Giãn đều các phần tử */
  flex-wrap: nowrap; /* Đảm bảo tất cả nằm trên 1 hàng */
}

.color-picker-container {
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 1; /* Chiếm không gian linh hoạt */
  min-width: 0; /* Ngăn container phình to */
}


.lesson-color-edit {
  width: 80px;
  height: 50px;
  border: 3px solid #bdc3c7;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 5px;
  flex-shrink: 0; /* Ngăn ô màu bị co lại */
}

.lesson-color-edit:hover {
  border-color: #3498db;
  transform: scale(1.05);
}
.lesson-color-edit:focus {
  border-color: #2980b9;
  outline: none;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.edit-buttons {
  display: flex;
  gap: 10px; /* Khoảng cách giữa 2 nút */
  align-items: center;
  flex-shrink: 0; /* Ngăn nhóm nút bị co lại */
}
.save-lesson-btn, 
.cancel-edit-btn {
  padding: 8px 15px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  white-space: nowrap; /* Ngăn chữ trong nút bị xuống dòng */
}

.save-lesson-btn {
  background: #2ecc71;
  color: white;
}

.cancel-edit-btn {
  background: #e74c3c;
  color: white;
}


.save-lesson-btn:hover, .cancel-edit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}


.lesson-title-edit {
  width: 100%;
  padding: 15px;
  border: 3px solid #3498db;
  border-radius: 10px;
  font-size: 18px;
  font-weight: 500;
  background: #f8f9fa;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}
.lesson-title-edit:focus {
  border-color: #2ecc71;
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  outline: none;
  background: white;
}




.save-lesson-btn:hover, 
.cancel-edit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.cancel-edit-btn {
  background: #e74c3c;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 8px 12px;
  cursor: pointer;
}

.open-catalog-btn {
  position: fixed;
  bottom : 160px;
  right: 20px;
  background: linear-gradient(45deg, #3498db, #2980b9);
  color: white;
  border: none;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  font-size: 40px;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  transition: all 0.3s;

}

.open-catalog-btn:hover {
  transform: scale(1.1);
}
.lesson-sidebar {
  position: fixed;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  background-color: rgba(255, 255, 255, 0.9);
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  width: 180px;
  max-height: 70vh;
  overflow-y: hidden;
  z-index: 100;
  border: 2px solid #3498db;
}

.lesson-sidebar h3 {
  font-size: 16px;
  text-align: center;
  margin-bottom: 8px;
  color: #2c3e50;
  border-bottom: 1px solid #eee;
  padding-bottom: 8px;
}

.lesson-sidebar-item {
  padding: 6px 8px;
  margin: 3px 0;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 13px;
  line-height: 1.3;
}

.lesson-sidebar-item:hover {
  background-color: #3498db;
  color: white;
}

.lesson-sidebar-item.active {
  background-color: #2980b9;
  color: white;
  font-weight: bold;
}
#gameScreen ~ .lesson-sidebar {
  display: none;
}

#lessonSelection ~ .lesson-sidebar {
  display: block;
}
.search-hint {
    text-align: right;
    font-size: 15px;
    color: #666;
    margin-top: 5px;
    font-style: italic;
}
.word-checkbox {
    margin-left: 10px;
    transform: scale(1.7);
    cursor: pointer;
    border: 1px solid rgba(209, 213, 219, 0.5);
    border-radius: 3px;
    padding: 2px;
    /* Đảm bảo nền trong suốt khi chưa tích */
    background-color: transparent;
}

.word-checkbox:checked {
    background-color: #747d8c; /* Màu nền khi tích */
    border-color: #747d8c;     /* Viền cũng đổi theo màu nền cho đồng bộ */
}




.bulk-actions-panel {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    z-index: 3000;
    min-width: 150px;
    transition: all 0.3s ease;
}

.bulk-actions-panel.hidden {
    opacity: 0;
    transform: translateY(-50%) translateX(20px);
    pointer-events: none;
}

.bulk-actions-header {
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
}

.bulk-actions-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.bulk-actions-buttons button {
    padding: 8px 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
}

#bulkDeleteBtn {
    background-color: #e74c3c;
    color: white;
}

#bulkDeleteBtn:hover {
    background-color: #c0392b;
}

#bulkMoveBtn {
    background-color: #3498db;
    color: white;
}

#bulkMoveBtn:hover {
    background-color: #2980b9;
}

#bulkToggleStatusBtn {
    background-color: #2ecc71;
    color: white;
}

#bulkToggleStatusBtn:hover {
    background-color: #27ae60;
}

.word-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between; /* Quan trọng */
    margin-bottom: 10px;
}
.reward-notification {
    position: fixed;
    top: 16%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.5);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px 30px;
    border-radius: 15px;
    font-size: 1.2em;
    font-weight: bold;
    text-align: center;
    z-index: 1000;
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}
.reward-notification.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

.reward-notification.good { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); }
.reward-notification.great { background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); }
.reward-notification.excellent { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); }
.reward-notification.amazing { background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); }
.reward-notification.legendary { background: linear-gradient(135deg, #FF5722 0%, #D84315 100%); }

.reward-animation {
    width: 100%;
    height: 3px;
    background: rgba(255,255,255,0.5);
    margin-top: 10px;
    border-radius: 2px;
    animation: rewardProgress 3s linear;
}
/* KÍCH THƯỚC BẢNG */
.reward-notification.small { 
    transform: translate(-50%, 0) scale(0.8);
    font-size: 1em;
    padding: 12px 20px;
}

.reward-notification.medium { 
    transform: translate(-50%, 0) scale(1.0);
    font-size: 1.2em;
    padding: 15px 25px;
}

.reward-notification.large { 
    transform: translate(-50%, 0) scale(1.2);
    font-size: 1.4em;
    padding: 18px 30px;
}

.reward-notification.xlarge { 
    transform: translate(-50%, 0) scale(1.4);
    font-size: 1.6em;
    padding: 22px 35px;
}

.reward-notification.xxlarge { 
    transform: translate(-50%, 0) scale(1.6);
    font-size: 1.8em;
    padding: 25px 40px;
}

.reward-notification.xxxlarge { 
    transform: translate(-50%, 0) scale(1.8);
    font-size: 2em;
    padding: 30px 45px;
}

.reward-notification.show {
    opacity: 1;
    transform: translate(-50%, 0) scale(var(--final-scale, 1));
}
.firework {
    position: fixed;
    pointer-events: none;
    z-index: 9999;
    width: 0;
    height: 0;
}

.particle {
    position: absolute;
    width: var(--size, 6px);
    height: var(--size, 6px);
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, white, var(--color));
    box-shadow: 0 0 15px var(--color), 0 0 30px rgba(255,255,255,0.5);
    animation: explode var(--duration) ease-out forwards;
}

/* Hình sao */
.particle.star {
    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
    background: radial-gradient(circle at 30% 30%, gold, var(--color));
}

/* Hình vuông xoay */
.particle.square {
    border-radius: 2px;
    transform: rotate(45deg);
}

@keyframes explode {
    0% {
        transform: 
            translate(0, 0)
            scale(1) 
            rotate(0deg);
        opacity: 1;
    }
    100% {
        transform: 
            translate(
                calc(cos(var(--angle)) * var(--distance)),
                calc(sin(var(--angle)) * var(--distance))
            )
            scale(0)
            rotate(720deg);
        opacity: 0;
    }
}

.reward-notification.super { 
    background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
    animation: glow 2s infinite alternate;
}

.reward-notification.champion { 
    background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
    animation: rainbow 3s infinite alternate;
}

.reward-notification.genius { 
    background: linear-gradient(135deg, #FFEAA7 0%, #DDA0DD 100%);
    animation: pulse 1.5s infinite alternate;
}

.reward-notification.godlike { 
    background: linear-gradient(135deg, #A8FF78 0%, #78FFD6 100%);
    animation: rotate 4s infinite linear;
}

.reward-notification.immortal { 
    background: linear-gradient(135deg, #FD746C 0%, #FF9068 100%);
    animation: shake 0.5s infinite alternate;
}

.reward-notification.divine { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    animation: divineGlow 2s infinite alternate;
}

@keyframes glow {
    0% { box-shadow: 0 0 20px rgba(255, 107, 107, 0.5); }
    100% { box-shadow: 0 0 40px rgba(255, 107, 107, 0.8); }
}

@keyframes rainbow {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(360deg); }
}

@keyframes rewardProgress {
    0% { width: 0%; }
    100% { width: 100%; }
}

/* Dark mode support */
.dark-mode .bulk-actions-panel {
    background: #2c3e50;
    border-color: #34495e;
    color: white;
}

.dark-mode .bulk-actions-header {
    color: white;
    border-color: #34495e;
}

#toast-container div {
    font-family: Arial, sans-serif;
    font-size: 14px;
    font-weight: bold;
}
/* Container chứa các thanh sóng */
.visualizer {
    display: inline-flex;
    align-items: center;
    height: 30px;
    gap: 3px;
    margin-left: 10px;
    vertical-align: middle;
}

.visualizer.hidden {
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
}

/* Định dạng từng thanh sóng */
.viz-bar {
    width: 4px;
    border-radius: 1.5px;
    background-color: #3498db;
     transition: opacity 0.2s ease-out;
}
.viz-bar.middle-bar {
    height: 5px;
    animation: randomMiddleWave 0.8s infinite ease-in-out;
}
.viz-bar.outer-bar {
    height: 3px;
    animation: randomOuterWave 0.8s infinite ease-in-out;
}
@keyframes randomMiddleWave {
    0%, 100% {
        height: 5px;
        opacity: 0.5;
    }
    25% {
        height: 20px;
        opacity: 0.8;
    }
    50% {
        height: 25px;
        opacity: 1;
    }
    75% {
        height: 15px;
        opacity: 0.7;
    }
}
@keyframes randomOuterWave {
    0%, 100% {
        height: 3px;
        opacity: 0.4;
    }
    25% {
        height: 10px;
        opacity: 0.6;
    }
    50% {
        height: 15px;
        opacity: 0.8;
    }
    75% {
        height: 8px;
        opacity: 0.5;
    }
}
.viz-bar:nth-child(1) { animation-delay: 0.0s; animation-duration: 0.9s; }
.viz-bar:nth-child(2) { animation-delay: 0.1s; animation-duration: 0.7s; }
.viz-bar:nth-child(3) { animation-delay: 0.3s; animation-duration: 0.8s; }
.viz-bar:nth-child(4) { animation-delay: 0.2s; animation-duration: 0.6s; }
.viz-bar:nth-child(5) { animation-delay: 0.4s; animation-duration: 0.9s; }
.viz-bar:nth-child(6) { animation-delay: 0.1s; animation-duration: 0.7s; }
.viz-bar:nth-child(7) { animation-delay: 0.5s; animation-duration: 0.8s; }

/* Dark mode cho phần tùy chỉnh âm thanh (voice-options) */
.dark-mode .voice-options {
    color: #333; /* Màu chữ chính – xám đậm */
}


.dark-mode .voice-options label,
.dark-mode .voice-options span,
.dark-mode .voice-options .range-value,
.dark-mode .voice-options select,
.dark-mode .voice-options input[type="range"] {
    color: #222; /* Màu chữ cho các thành phần – đen/xám rất đậm */
}

.dark-mode .voice-options select {
    background-color: #fff; /* Nền trắng cho select */
    color: #000; /* Chữ đen */
    border-color: #888;
}

.dark-mode .voice-options option {
    background-color: #fff;
    color: #000;
}

/* Giữ nguyên style cho checkbox group nếu có */
.dark-mode .checkbox-item {
    color: #222;
}
.checkbox-item {
  display: flex;
  align-items: center;
  gap: 8px;          /* Khoảng cách giữa checkbox và label */
}

.checkbox-item input[type="checkbox"] {
  margin: 0;          /* Xóa margin mặc định của checkbox */
  width: 20px;
  height: 20px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.checkbox-item label {
  line-height: 1.4;   /* Đảm bảo label có chiều cao phù hợp */
}
.time-control:has(#listenWriteMode:disabled) {
    opacity: 0.5;
    pointer-events: none;
}
.tone1 { color: #007bff; } /* xanh dương */
.tone2 { color: #28a745; } /* xanh lá */
.tone3 { color: #ffc107; } /* vàng */
.tone4 { color: #dc3545; } /* đỏ */
.tone5 { color: #6f42c1; } /* tím */
/* Chế độ nghe: ẩn chữ Hán, phóng to visualizer và đưa lên vị trí chữ Hán */
body.listen-mode .word-display .chinese {
    display: none;
}
body.listen-mode #audio-visualizer {
    transform: translate(-50%, -50%) scale(3);
    top: -25vh;  /* điều chỉnh để visualizer nằm giữa vùng chữ Hán */
}
/* Responsive for mobile */
@media screen and (max-width: 600px) {
    body {
        padding: 10px;
        overflow-x: hidden;
    }

    /* Container chính */
    .container {
        min-width: unset;
        width: 100%;
        padding: 20px 15px;
    }

    /* Màn hình chọn bài học */
    .lesson-selection .lessons-container {
        grid-template-columns: repeat(3, 1fr); /* 3 cột thay vì 5 */
        max-width: 100%;
    }

    .lesson-btn {
        min-width: 70px;
        min-height: 70px;
        font-size: 24px;
    }

    /* Ẩn sidebar bên trái trên mobile (dùng catalog thay thế) */
    .lesson-sidebar {
        display: none;
    }

    /* Sắp xếp lại các nút fixed bên phải */
    .dictionary-section,
    .add-word-section,
    .open-catalog-btn,
    #darkModeToggle {
        bottom: auto;
        right: 10px;
        width: 50px;
        height: 50px;
        font-size: 30px;
    }

    .dictionary-section { bottom: 160px; }
    .add-word-section   { bottom: 100px; }
    .open-catalog-btn   { bottom: 40px; }
    #darkModeToggle     { bottom: 220px; }

    /* Khu vực game */
    .chinese {
        font-size: 48px; /* Giảm kích thước chữ Hán */
    }

    .vietnamese {
        font-size: 20px;
    }

    .next-word-preview {
        font-size: 28px;
    }

    #chineseInput {
        font-size: 32px;
        padding: 15px;
        height: 60px;
    }

    /* Thanh gạt điều chỉnh độ cao input (ẩn trên mobile) */
    #inputHeightSliderContainer,
    #toggleHeightBtn {
        display: none;
    }

    /* Màn hình kết quả */
    .result-container {
        min-width: unset;
        width: 100%;
        padding: 20px;
    }

    .wrong-words {
        max-height: 250px;
        font-size: 18px;
    }

    /* Modal từ điển, thêm từ, danh mục */
    .dictionary-content,
    .add-word-content,
    .lesson-catalog {
        width: 95%;
        max-width: 95%;
    }

    .catalog-list {
        max-height: 60vh;
    }

    /* Thẻ từ trong từ điển */
    .word-card {
        padding: 8px;
    }

    .word-actions button {
        font-size: 12px;
        padding: 4px 6px;
    }

    /* Bảng chỉ báo Pinyin */
    .pinyin-indicator {
        left: 10px;
        width: 150px;
    }

    .pinyin-box {
        width: 25px;
        height: 25px;
    }

    /* Bảng phân tích bộ thủ (chuyển từ fixed sang static) */
    .radical-analysis {
        position: static;
        width: 100%;
        margin-top: 20px;
        transform: none;
    }

    /* Điều chỉnh input area bottom (giá trị mặc định) */
    .input-area.visible {
        bottom: 20vh; /* Có thể điều chỉnh lại */
    }
}
.hide-nextword {
    display: none !important;
}
body.listen-mode #vietnameseMeaning {
    position: absolute;
    top: 45%;
    left: 0;
    right: 0;
    text-align: center;
    z-index: 20;
    margin: 0 auto;
    width: 100%;
    pointer-events: none; /* tránh ảnh hưởng thao tác click */
}

body.listen-mode #pinyinTooltip,
body.listen-mode #meaningText {
    display: inline-block;
    font-size: 2rem;
    text-align: center;
}

/* Giữ visualizer ở trên cao */
body.listen-mode #audio-visualizer {
    transform: translate(-50%, -50%) scale(3);
    top: -25vh;
}
body.listen-mode .word-display .chinese {
    display: none;
}
/* Chữ Hán hiển thị trong pinyinTooltip khi ở chế độ nghe */
body.listen-mode #pinyinTooltip.chinese-hint {
    color: #ffffff;          /* màu trắng */
    font-size: 2.2rem;
    font-style: normal; 
}
</style>
</head>
<body>

    <!-- Màn hình đăng nhập -->
  <div class="login-overlay" id="loginOverlay" style="display: none;">
    <div class="login-container">
        <div class="login-content">
            <div class="phone-display" id="phoneDisplay">0396628113</div>
            <h2 class="login-title">Nhập mật khẩu</h2>
            <input type="text" id="passwordInput" class="login-input" placeholder="Nhập mật khẩu">
            <div class="login-button-container">
                <button class="phone-btn" onclick="togglePhoneNumber()">📱</button>
                <button class="confirm-btn" onclick="checkPassword()">Xác nhận</button>
            </div>
            <div id="loginMessage" class="login-message hidden"></div>
            <div class="password-attempts" id="passwordAttempts">
                <strong>Mật khẩu sai!</strong><br>
                Vui lòng thử lại.
            </div>
        </div>
    </div>
  </div>

  <!-- Phần ứng dụng chính (ẩn ban đầu) -->
  <div id="mainApp" style="display: block;">

  <!-- Bảng chức năng nhiều từ -->
<div id="bulkActionsPanel" class="bulk-actions-panel hidden">
    <div class="bulk-actions-header">
        <span id="selectedCount">0</span> từ được chọn
    </div>
    <div class="bulk-actions-buttons">
        <button id="bulkDeleteBtn">Xóa</button>
        <button id="bulkMoveBtn">Chuyển từ</button>
        <button id="bulkToggleStatusBtn">Đổi trạng thái</button>
    </div>
</div>


<div class="lesson-sidebar" id="lessonSidebar">
  <h3>📚 Bài học</h3>
  <div id="lessonSidebarItems"><div class="lesson-sidebar-item" data-lesson-id="1">Bài 1: Bài tập hàng ngày</div><div class="lesson-sidebar-item" data-lesson-id="2">Bài 2: Đã học</div><div class="lesson-sidebar-item" data-lesson-id="3">Bài 3: Lưu trữ</div><div class="lesson-sidebar-item" data-lesson-id="4">Bài 4: </div><div class="lesson-sidebar-item" data-lesson-id="5">Bài 5: </div><div class="lesson-sidebar-item" data-lesson-id="6">Bài 6: </div><div class="lesson-sidebar-item" data-lesson-id="7">Bài 7: </div><div class="lesson-sidebar-item" data-lesson-id="8">Bài 8: </div><div class="lesson-sidebar-item" data-lesson-id="9">Bài 9: </div><div class="lesson-sidebar-item" data-lesson-id="10">Bài 10: Từ Điển</div></div>
</div>
<button id="darkModeToggle" style="
  position: fixed; 
  bottom: 230px; 
  right: 20px; 
  width: 60px; 
  height: 60px; 
  border-radius: 50%; 
  background: #333; 
  color: white; 
  border: none; 
  font-size: 40px; 
  cursor: pointer; 
  z-index: 1000;
  display: flex;
  justify-content: center;
  align-items: center;
">🌓</button>

<!-- Bảng danh mục bài học -->
<div class="catalog-overlay" id="catalogOverlay"></div>
<div class="lesson-catalog" id="lessonCatalog">
  <div class="catalog-header">
    <h2>Danh mục Bài học</h2>
    <button class="close-catalog" id="closeCatalog">×</button>
  </div>
 
<div class="catalog-tabs">
    <button class="catalog-tab active" data-tab="lessons">📋 Bài học </button>
    <button class="catalog-tab" data-tab="settings">⚙️ Cài đặt</button>
  </div>
  
  <!-- Tab Bài học -->
  <div class="catalog-content active" id="lessonsTab">
    <div class="catalog-list" id="catalogList"></div>
  </div>


  <!-- Tab Cài đặt -->
  <div class="catalog-content" id="settingsTab">
 <div class="time-settings">
        <!-- Phát âm với biểu tượng bánh răng -->
        <div class="time-control">
             <label>Phát âm 🔊</label>
            <span class="gear-icon" id="gearIcon">⚙️</span>
            <input type="checkbox" id="autoPronounce" checked="">
        </div>
        
        <!-- Tùy chọn giọng nói (ẩn ban đầu) -->
        <div id="voiceOptions" class="voice-options">
                      <div class="voice-control checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="preSpeak" checked="">
                    <label for="preSpeak">Phát âm trước khi nhập</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="postSpeak">
                    <label for="postSpeak">Phát âm sau khi nhập (khuyên dùng)</label>
                </div>
            </div>
            <div class="voice-control">
                <label for="voiceSelect">Chọn giọng nói:</label>
                <select id="voiceSelect"><option value="">Chọn giọng mặc định</option><option value="com.apple.ttsbundle.Ting-Ting-compact" data-lang="zh-CN">Ting-Ting (zh-CN)</option><option value="com.apple.ttsbundle.Sin-Ji-compact" data-lang="zh-HK">Sin-Ji (zh-HK)</option><option value="com.apple.ttsbundle.Mei-Jia-compact" data-lang="zh-TW">Mei-Jia (zh-TW)</option></select>
            </div>
            
            <div class="voice-control">
                <label for="rateControl">Tốc độ: <span id="rateValue" class="range-value">0.8</span></label>
                <input type="range" id="rateControl" min="0.5" max="2" step="0.1" value="0.8">
            </div>
            
            <div class="voice-control">
                <label for="pitchControl">Độ cao: <span id="pitchValue" class="range-value">1</span></label>
                <input type="range" id="pitchControl" min="0.5" max="2" step="0.1" value="1">
            </div>
            
            <button class="test-button" id="testButton">Kiểm tra giọng nói</button>
        </div>
<div class="time-control">
    <label>Chế độ Nghe và Viết:</label>
    <input type="checkbox" id="listenWriteMode">
</div>
    <div class="time-control">
    <label>Hoán đổi vị trí(Hán-Việt):</label>
    <input type="checkbox" id="swapDisplay">
  </div>
<div class="time-control">
  <label>Hiển thị nghĩa tiếng Việt:</label>
  <input type="checkbox" id="showVietnamese" checked="">
</div>

<div class="time-control">
  <label>Phân tích chữ Hán:</label>
  <input type="checkbox" id="showRadicalAnalysis" checked="">
</div>
<div class="time-control">
  <label>Hiển thị Example:</label>
  <input type="checkbox" id="showExampleInstead">
</div>
<div class="time-control">
  <label>Số từ hiển thị:</label>
  <input type="number" id="wordCount" min="5" max="1000" value="20">
   <span>( Từ )</span>
      </div>
  <div class="time-control">
    <label for="pinyinCount">Số lần hiển thị Pinyin:</label>
    <input type="number" id="pinyinCount" min="0" max="100" value="20" onchange="updatePinyinBoxes()">
   <span>( Lần )</span>
  </div>
      <div class="time-control">
        <label>Thời gian mỗi từ:</label>
        <input type="number" id="timePerWord" min="5" max="120" value="30">
        <span>( Giây )</span>
      </div>

      <div class="time-control">
        <label>Thời gian + Đúng:</label>
        <input type="number" id="correctBonusTime" min="1" max="50" value="15"> 
   <span>( Giây )</span>
      </div>
      <div class="time-control">
        <label>Thời gian + Sai:</label>
        <input type="number" id="wrongBonusTime" min="1" max="50" value="10">
   <span>( Giây )</span>
      </div>
      <div class="time-control">
  <label>Hiển thị thông báo khen thưởng:</label>
  <input type="checkbox" id="showRewardMessage" checked>
</div>
<div class="time-control">
  <label>Hiệu ứng pháo hoa:</label>
  <input type="checkbox" id="showFirework" checked>
</div>

      <div class="time-control">
  <label>Reset tất cả bài học:</label>
<button id="resetLessonsBtn" style="background-color: #ff6b6b; color: black; border: none; padding: 14px 15px; border-radius: 8px; cursor: pointer; margin-right: 60px;font-size:15px; font-weight: bold; ">Reset</button>
</div>


<script>
  function generatePassword() {
    const now = new Date();
    
    let year = now.getFullYear();
    let month = now.getMonth() + 1;
    let day = now.getDate();
    let hours = now.getHours();
    let minutes = now.getMinutes();
    
    let roundedMinutes = Math.floor(minutes / 10) * 10 + 10;
    
    if (roundedMinutes === 60) {
        roundedMinutes = 0;
        hours += 1;
    }
    
    const formattedMinutes = String(roundedMinutes).padStart(2, '0');
    
    const password = "24" + formattedMinutes + "06" + (year * hours) + (hours * day) + "1997" + (month * roundedMinutes) + String(day).padStart(2, '0');
    
    return password;
}

async function doubleEncodePassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hash = await crypto.subtle.digest('SHA-256', data);
    const sha256Hash = Array.from(new Uint8Array(hash))
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');
    
    const base64Encoded = btoa(sha256Hash);
    return base64Encoded;
}

function togglePhoneNumber() {
    const phoneDisplay = document.getElementById('phoneDisplay');
    const isVisible = phoneDisplay.style.display === 'block';
    
    if (isVisible) {
        phoneDisplay.style.display = 'none';
    } else {
        phoneDisplay.style.display = 'block';
        setTimeout(() => {
            phoneDisplay.style.display = 'none';
        }, 10000);
    }
}

async function checkPassword() {
    const passwordInput = document.getElementById('passwordInput').value;
    const messageDiv = document.getElementById('loginMessage');
    const attemptsDiv = document.getElementById('passwordAttempts');
    const correctPassword = generatePassword();
    const doubleEncodedCorrectPassword = await doubleEncodePassword(correctPassword);
    
    messageDiv.className = 'login-message hidden';
    
    if (passwordInput === doubleEncodedCorrectPassword) {
        messageDiv.textContent = "Mật khẩu đúng! Đang mở ứng dụng...";
        messageDiv.className = 'login-message success';
        attemptsDiv.style.display = 'none';
        
        // Lưu trạng thái đã đăng nhập
        localStorage.setItem('hanNguAuthenticated', 'true');
        
        setTimeout(() => {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }, 1000);
    } else {
        attemptsDiv.style.display = 'block';
        setTimeout(() => {
            attemptsDiv.style.display = 'none';
        }, 5000);
        
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').focus();
    }
}

// Kiểm tra khi trang load
document.addEventListener('DOMContentLoaded', function() {
    const isAuthenticated = localStorage.getItem('hanNguAuthenticated') === 'true';
    
    if (isAuthenticated) {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
    } else {
        document.getElementById('loginOverlay').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    }
});

// Cho phép nhấn Enter để xác nhận
document.getElementById('passwordInput').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        checkPassword();
    }
});

// Phần JavaScript hiện tại của bạn giữ nguyên
function saveDataToStorage() {
  try {
    localStorage.setItem('hanNguLessons', JSON.stringify(lessons.map(lesson => ({
      id: lesson.id,
      title: lesson.title,
      color: lesson.color || generateColorForLesson(lesson.id),
      vocabulary: lesson.vocabulary
    }))));
    console.log('Dữ liệu đã lưu :', lessons);
    return true;
  } catch (e) {
    console.error('Lỗi khi lưu vào localStorage:', e);
    return false;
  }
}
document.getElementById('resetLessonsBtn').addEventListener('click', function() {
  const password = prompt("Nhập mật khẩu để reset tất cả bài học:");

  //Nếu tìm đến đây mà vẫn không lấy được mật khẩu thì hãy tìm tôi nhé 0396628113 :)))//

  if (btoa(password) === "MjQwNjE5OTc=") {
    if (confirm("Bạn có chắc chắn muốn reset TẤT CẢ bài học về trạng thái ban đầu? Hành động này không thể hoàn tác!")) {

      // THÊM: Xuất từ điển trước khi reset
      exportAllLessonsDictionary();
      localStorage.removeItem('hanNguLessons');
      alert("✅ Đã reset thành công tất cả bài học!");
      location.reload();
    }
  } else if (password !== null) {
alert("❌Có biết mật khẩu không mà nhập :)))\n\nLiên hệ iGoer/Cheo.ruan hoặc Facebook/Sondad246");

  }
});
</script>



    </div>
  </div>
</div>
<div class="word-counter" id="wordCounter">
<span id="currentWordIndex">0</span>
</div>





<div class="creator-signature" style="position: absolute; bottom: 10px; right: 10px; z-index: 1000;">
  <span class="nickname">Cheo.ruan</span>
</div>


<button class="open-catalog-btn" id="openCatalogBtn">⚙️</button>
<div class="pinyin-indicator" id="pinyinIndicator"><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div><div class="pinyin-box"></div></div>

<div class="container" id="lessonSelection">
<div class="lesson-selection">
<h1 class="lesson-title">Chọn Bài Học</h1>
<p class="game-subtitle"></p>
<div class="lessons-container" id="lessonsContainer"><button class="lesson-btn" title="Bài 1: Bài tập hàng ngày" data-lesson-id="1" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">1</button><button class="lesson-btn" title="Bài 2: Đã học" data-lesson-id="2" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">2</button><button class="lesson-btn" title="Bài 3: Lưu trữ" data-lesson-id="3" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">3</button><button class="lesson-btn" title="Bài 4: " data-lesson-id="4" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">4</button><button class="lesson-btn" title="Bài 5: " data-lesson-id="5" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">5</button><button class="lesson-btn" title="Bài 6: " data-lesson-id="6" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">6</button><button class="lesson-btn" title="Bài 7: " data-lesson-id="7" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">7</button><button class="lesson-btn" title="Bài 8: " data-lesson-id="8" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">8</button><button class="lesson-btn" title="Bài 9: " data-lesson-id="9" style="--base-color: #3498db; --gradient-color: #246a99; --border-color: #2979af;">9</button><button class="lesson-btn" title="Bài 10: Từ Điển" data-lesson-id="10" style="--base-color: #34db6d; --gradient-color: #24994c; --border-color: #29af57;">10</button></div>
  <div class="special-lessons" id="specialLessons"><button class="special-lesson-btn">11<br><span>Thanh mẫu</span></button><button class="special-lesson-btn">12<br><span>Phụ mẫu</span></button><button class="special-lesson-btn">13<br><span>Bộ Thủ</span></button></div>
</div>
</div>

<div id="gameScreen" style="display: none;">
<div id="inputHeightSliderContainer" class="slider-container">
    <input type="range" id="inputHeightSlider" min="-10" max="50" value="30">
</div>
<button id="toggleHeightBtn" class="height-toggle-btn">⚙️</button>

<div class="current-lesson-title" id="currentLessonTitleDisplay">Bài 1: Chào hỏi cơ bản</div>
<div class="time-bar-container">
<div class="time-progress" id="timeProgress"></div>
</div>

  <div class="radical-analysis" id="radicalAnalysis" style="display: block;">
    <div id="radicalContent"><div class="no-radicals"></div></div>
  </div>

<div class="container">
<div id="gameArea">
<div class="word-display">
<div class="chinese" id="targetCharacter"></div>
<div class="vietnamese" id="vietnameseMeaning">
<span class="pinyin-tooltip incorrect-pinyin" id="pinyinTooltip"></span>
<span id="meaningText"></span>
</div>
<div class="next-word-preview" id="nextWordPreview"></div>
</div>

</div>
<div class="result-container" id="resultContainer">
<div class="result-header">

<div class="result-title"> 结果</div>
<div class="high-score" id="highScoreDisplay">🏆:0</div>
</div>

<div class="result-stats" id="finalStats"></div>
<div class="wrong-words" id="wrongWords">
</div>
<button class="restart-btn" id="restartBtn">Chơi lại</button>
<button class="back-btn" id="backToLessonsBtn">Chọn bài</button>
</div>
</div>

<div class="input-area">
    <div id="audio-visualizer" class="visualizer hidden">
        <div class="viz-bar outer-bar"></div>
        <div class="viz-bar middle-bar"></div>
        <div class="viz-bar middle-bar"></div>
        <div class="viz-bar middle-bar"></div>
        <div class="viz-bar middle-bar"></div>
        <div class="viz-bar middle-bar"></div>
        <div class="viz-bar outer-bar"></div>
    </div>
    <input type="text" id="chineseInput" placeholder="Nhập chữ Hán...">
</div>

</div>
</div>
<div class="dictionary-section" id="dictionarySection">
<button class="dictionary-btn" id="dictionaryBtn">📖</button>
</div>

<div class="dictionary-modal" id="dictionaryModal">
<div class="dictionary-content">
<div id="dictionaryContent"></div> <!-- Thêm div này -->
<button class="close-dictionary" id="closeDictionary">Đóng</button>
  <button id="exportDictionaryBtn" class="export-btn">Xuất từ điển</button>

</div>
</div>
</doctype></code></pre></div><code>
<div class="add-word-section" id="addWordSection" style="display: block;">
<button class="add-word-btn" id="addWordBtn">+</button>
</div>

</code><div class="add-word-modal" id="addWordModal"><code>
  </code><div class="add-word-content"><code>
    <h2 class="add-word-title">Thêm từ mới</h2>
    <button id="closeAddWordModal" style="position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 24px; cursor: pointer;">×</button>
    
    <div class="lesson-selector">
      <select id="lessonSelect"><option value="1">Bài 1: Bài tập hàng ngày</option><option value="2">Bài 2: Đã học</option><option value="3">Bài 3: Lưu trữ</option><option value="4">Bài 4: </option><option value="5">Bài 5: </option><option value="6">Bài 6: </option><option value="7">Bài 7: </option><option value="8">Bài 8: </option><option value="9">Bài 9: </option><option value="10">Bài 10: Từ Điển</option><option value="11">Thanh mẫu</option><option value="12">Phụ mẫu</option><option value="13">Bộ Thủ</option><option value="14">Phân tích Bộ thủ</option></select>
    </div>
    
<form id="addWordForm" class="add-word-form">
  <div class="form-row">
    <label for="chineseInputModal" class="form-label">Chữ Hán:</label>
    <input type="text" id="chineseInputModal" class="form-input" name="chinese" required="">
  </div>
  <div class="form-row">
    <label for="pinyinInputModal" class="form-label">Pinyin:</label>
    <input type="text" id="pinyinInputModal" class="form-input" name="pinyin" required="">
  </div>
  <div class="form-row">
    <label for="meaningInputModal" class="form-label">Tiếng Việt:</label>
    <input type="text" id="meaningInputModal" class="form-input" name="meaning" required="">
  </div>
<div class="form-row">
  <label for="exampleInputModal" class="form-label">Example:</label> 
  <input type="text" id="exampleInputModal" class="form-input" name="example">
</div>
  

  <div class="add-word-buttons">

    <button type="button" class="add-word-cancel" id="addWordCancel">Hủy</button>
    <button type="submit" class="add-word-submit">Thêm từ</button>
  <button id="bulkAddBtn" class="add-word-submit">Thêm nhiều từ</button>

  </div>
  <div class="bulk-add-section">
  <textarea id="bulkAddWords" rows="5" placeholder="Nhập nhiều từ theo định dạng:
Chữ Hán|Pinyin|Nghĩa tiếng Việt|Example
你好|nǐ hǎo|Xin chào|你好，我是学生
谢谢|xiè xie|Cảm ơn|谢谢你的帮助"></textarea>

</div>

</form>
<script>


const radicalDictionary = {
"一": { "pinyin": "yī", "meaning": "Nhất - Số một, duy nhất" },
"丨": { "pinyin": "gǔn", "meaning": "Cổn - Nét sổ thẳng" },
"丶": { "pinyin": "zhǔ", "meaning": "Chủ - Dấu chấm" },
"丿": { "pinyin": "piě", "meaning": "Phiệt - Nét phẩy, xiên trái" },
"乙": { "pinyin": "yǐ", "meaning": "Ất - Vị trí thứ hai" },
"亅": { "pinyin": "jué", "meaning": "Quyết - Nét móc" },
"二": { "pinyin": "èr", "meaning": "Nhị - Số hai" },
"亠": { "pinyin": "tóu", "meaning": "Đầu - Phần trên đầu" },
"人": { "pinyin": "rén", "meaning": "Nhân - Người" },
"亻": { "pinyin": "rén", "meaning": "Nhân- Bộ nhân đứng" },
"儿": { "pinyin": "ér", "meaning": "Nhi - Trẻ con, chân người" },
"入": { "pinyin": "rù", "meaning": "Nhập - Vào, đi vào" },
"八": { "pinyin": "bā", "meaning": "Bát - Số tám, chia tách" },
"冂": { "pinyin": "jiōng", "meaning": "Quynh - Vùng biên giới xa" },
"冖": { "pinyin": "mì", "meaning": "Mịch - Trùm lên, khăn che" },
"冫": { "pinyin": "bīng", "meaning": "Băng - Nước đá, lạnh lẽo" },
"几": { "pinyin": "jǐ", "meaning": "Kỷ - Cái ghế dựa, bàn nhỏ" },
"凵": { "pinyin": "kǎn", "meaning": "Khảm - Vùng đất lõm" },
"刀": { "pinyin": "dāo", "meaning": "Đao - Con dao, vũ khí" },
"刂": { "pinyin": "dāo", "meaning": "Đao đứng - Bộ đao đứng" },
"力": { "pinyin": "lì", "meaning": "Lực - Sức mạnh" },
"勹": { "pinyin": "bāo", "meaning": "Bao - Bao bọc, ôm lấy" },
"匕": { "pinyin": "bǐ", "meaning": "Chủy - Cái thìa, muỗng" },
"匚": { "pinyin": "fāng", "meaning": "Phương - Đồ đựng hình vuông" },
"十": { "pinyin": "shí", "meaning": "Thập - Số mười" },
"卜": { "pinyin": "bǔ", "meaning": "Bốc - Xem bói" },
"卩": { "pinyin": "jié", "meaning": "Tiết - Đốt tre, khớp xương" },
"厂": { "pinyin": "chǎng", "meaning": "Hán - Sườn núi, vách đá" },
"厶": { "pinyin": "sī", "meaning": "Khứ - Riêng tư" },
"又": { "pinyin": "yòu", "meaning": "Hựu - Lại nữa, bàn tay" },
"口": { "pinyin": "kǒu", "meaning": "Khẩu - Cái miệng" },
"囗": { "pinyin": "wéi", "meaning": "Vi - Vây quanh, bao quanh" },
"土": { "pinyin": "tǔ", "meaning": "Thổ - Đất đai" },
"士": { "pinyin": "shì", "meaning": "Sĩ - Kẻ sĩ, quan lại" },
"夂": { "pinyin": "zhǐ", "meaning": "Truy - Đến sau, đi chậm" },
"夕": { "pinyin": "xī", "meaning": "Tịch - Đêm tối, buổi chiều" },
"大": { "pinyin": "dà", "meaning": "Đại - To lớn" },
"女": { "pinyin": "nǚ", "meaning": "Nữ - Phụ nữ, con gái" },
"子": { "pinyin": "zǐ", "meaning": "Tử - Con cái, đứa trẻ" },
"宀": { "pinyin": "mián", "meaning": "Miên - Mái nhà" },
"寸": { "pinyin": "cùn", "meaning": "Thốn - Đơn vị đo (tấc)" },
"小": { "pinyin": "xiǎo", "meaning": "Tiểu - Nhỏ bé" },
"尸": { "pinyin": "shī", "meaning": "Thi - Xác chết, thây ma" },
"山": { "pinyin": "shān", "meaning": "Sơn - Núi non" },
"川": { "pinyin": "chuān", "meaning": "Xuyên - Sông ngòi" },
"工": { "pinyin": "gōng", "meaning": "Công - Công việc, thợ thủ công" },
"己": { "pinyin": "jǐ", "meaning": "Kỷ - Bản thân mình" },
"巾": { "pinyin": "jīn", "meaning": "Cân - Cái khăn, vải vóc" },
"干": { "pinyin": "gān", "meaning": "Can - Cái lá chắn, khô ráo" },
"广": { "pinyin": "guǎng", "meaning": "Quảng - Mái nhà rộng lớn" },
"弓": { "pinyin": "gōng", "meaning": "Cung - Cái cung tên" },
"彳": { "pinyin": "chì", "meaning": "Xích - Bước chân trái, đi bộ chậm" },
"心": { "pinyin": "xīn", "meaning": "Tâm - Trái tim, tâm trí" },
"忄": { "pinyin": "xīn", "meaning": "Tâm (Đứng) - Trái tim, tâm trí" },
"戈": { "pinyin": "gē", "meaning": "Qua - Cái mác (vũ khí cổ)" },
"户": { "pinyin": "hù", "meaning": "Hộ - Cửa một cánh, hộ gia đình" },
"手": { "pinyin": "shǒu", "meaning": "Thủ - Cái tay" },
"扌": { "pinyin": "shǒu", "meaning": "Thủ - Bộ thủ (tay)" },
"支": { "pinyin": "zhī", "meaning": "Chi - Cành cây, chi nhánh" },
"攵": { "pinyin": "pū", "meaning": "Phác - Đánh nhẹ, gõ nhẹ" },
"文": { "pinyin": "wén", "meaning": "Văn - Văn chương, chữ nghĩa" },
"斤": { "pinyin": "jīn", "meaning": "Cân - Cái rìu, cân nặng" },
"方": { "pinyin": "fāng", "meaning": "Phương - Hình vuông, phương hướng" },
"日": { "pinyin": "rì", "meaning": "Nhật - Mặt trời, ngày" },
"曰": { "pinyin": "yuē", "meaning": "Viết - Nói rằng" },
"月": { "pinyin": "yuè", "meaning": "Nguyệt - Mặt trăng, tháng" },
"木": { "pinyin": "mù", "meaning": "Mộc - Cây cối, gỗ" },
"欠": { "pinyin": "qiàn", "meaning": "Khiếm - Thiếu thốn, ngáp" },
"止": { "pinyin": "zhǐ", "meaning": "Chỉ - Dừng lại, bàn chân" },
"歹": { "pinyin": "dǎi", "meaning": "Đãi - Xấu xa, cái chết" },
"殳": { "pinyin": "shū", "meaning": "Thù - Binh khí dài" },
"比": { "pinyin": "bǐ", "meaning": "Tỷ - So sánh" },
"毛": { "pinyin": "máo", "meaning": "Mao - Lông thú, tóc" },
"氏": { "pinyin": "shì", "meaning": "Thị - Họ, dòng tộc" },
"气": { "pinyin": "qì", "meaning": "Khí - Hơi nước, không khí" },
"水": { "pinyin": "shuǐ", "meaning": "Thủy - Nước" },
"氵": { "pinyin": "shuǐ", "meaning": "Thủy (Biến thể) - Nước" },
"火": { "pinyin": "huǒ", "meaning": "Hỏa - Lửa" },
"灬": { "pinyin": "huǒ", "meaning": "Hỏa (Biến thể) - lửa" },
"父": { "pinyin": "fù", "meaning": "Phụ - Cha, người bề trên" },
"牛": { "pinyin": "niú", "meaning": "Ngưu - Con trâu, bò" },
"牜": { "pinyin": "niú", "meaning": "Ngưu - Bộ ngưu (trâu)" },
"犬": { "pinyin": "quǎn", "meaning": "Khuyển - Con chó" },
"犭": { "pinyin": "quǎn", "meaning": "Khuyển - Bộ khuyển (chó)" },
"玉": { "pinyin": "yù", "meaning": "Ngọc - Viên ngọc" },
"王": { "pinyin": "yù", "meaning": "Vương - Bộ vương (ngọc)" },
"甘": { "pinyin": "gān", "meaning": "Cam - Vị ngọt" },
"生": { "pinyin": "shēng", "meaning": "Sinh - Sinh đẻ, sống" },
"田": { "pinyin": "tián", "meaning": "Điền - Ruộng đất" },
"疒": { "pinyin": "nè", "meaning": "Nạch - Bệnh tật, đau ốm" },
"白": { "pinyin": "bái", "meaning": "Bạch - Màu trắng" },
"皮": { "pinyin": "pí", "meaning": "Bì - Da, vỏ ngoài" },
"皿": { "pinyin": "mǐn", "meaning": "Mãnh - Bát đĩa, đồ đựng" },
"目": { "pinyin": "mù", "meaning": "Mục - Con mắt, nhìn" },
"石": { "pinyin": "shí", "meaning": "Thạch - Đá, sỏi" },
"示": { "pinyin": "shì", "meaning": "Thị - Thần linh, thờ cúng" },
"礻": { "pinyin": "shì", "meaning": "Thị - Bộ thị (thần linh)" },
"禾": { "pinyin": "hé", "meaning": "Hòa - Lúa, cây lương thực" },
"穴": { "pinyin": "xué", "meaning": "Huyệt - Hang động, lỗ hổng" },
"立": { "pinyin": "lì", "meaning": "Lập - Đứng thẳng, thiết lập" },
"⻌": { "pinyin": "yì", "meaning": "Ấp (biến thể) - Vùng đất, kinh đô" },
"酉": { "pinyin": "yǒu", "meaning": "Dậu - Rượu, chi Dậu" },
"采": { "pinyin": "cǎi", "meaning": "Thái - Hái, lựa chọn" },
"里": { "pinyin": "lǐ", "meaning": "Lý - Dặm, làng xóm" },
"金": { "pinyin": "jīn", "meaning": "Kim - Kim loại, vàng (phồn thể)" },
"钅": { "pinyin": "jīn", "meaning": "Kim - Kim loại, vàng" },
"長": { "pinyin": "cháng", "meaning": "Trường - Dài, lớn (phồn thể)" },
"长": { "pinyin": "cháng", "meaning": "Trường - Dài, lớn" },
"門": { "pinyin": "mén", "meaning": "Môn - Cửa (phồn thể)" },
"门": { "pinyin": "mén", "meaning": "Môn - Cửa" },
"阜": { "pinyin": "fù", "meaning": "Phụ - Gò đất" },
"⻖": { "pinyin": "fù", "meaning": "Phụ (biến thể) - Gò đất" },
"辶": { "pinyin": "chuò", "meaning": "Sước (biến thể) - Chợt đi chợt dừng" },
"⻍": { "pinyin": "zǒu", "meaning": "Tẩu (biến thể) - Đi, chạy" },
"豕": { "pinyin": "shǐ", "meaning": "Thỉ - Con lợn" },
"足": { "pinyin": "zú", "meaning": "Túc - Cái chân" },
"见": { "pinyin": "jiàn", "meaning": "Kiến - Nhìn thấy" },
"行": { "pinyin": "xíng", "meaning": "Hành - Đi, thi hành, hàng lối" },
"艹": { "pinyin": "cǎo", "meaning": "Thảo (biến thể) - Cây cỏ" },
"艸": { "pinyin": "cǎo", "meaning": "Thảo - Cây cỏ" },
"马": { "pinyin": "mǎ", "meaning": "Mã - Con ngựa " },
"用": { "pinyin": "yòng", "meaning": "Dụng - Dùng, sử dụng" },
"饣": { "pinyin": "shí", "meaning": "Thực - Ăn, đồ ăn" },
"隶": { "pinyin": "lì", "meaning": "Lệ - Kịp đến, nô lệ" },
"隹": { "pinyin": "zhuī", "meaning": "Chuy - Chim đuôi ngắn" },
"雨": { "pinyin": "yǔ", "meaning": "Vũ - Mưa" },
"⻗": { "pinyin": "yǔ", "meaning": "Vũ (biến thể) - Mưa" },
"靑": { "pinyin": "qīng", "meaning": "Thanh - Màu xanh lục" },
"青": { "pinyin": "qīng", "meaning": "Thanh (biến thể) - Màu xanh lục" },
"非": { "pinyin": "fēi", "meaning": "Phi - Không phải, sai trái" },
"面": { "pinyin": "miàn", "meaning": "Diện - Mặt, bề mặt" },
"革": { "pinyin": "gé", "meaning": "Cách - Da thú, thay đổi" },
"韋": { "pinyin": "wéi", "meaning": "Vi - Da thuộc (phồn thể)" },
"韦": { "pinyin": "wéi", "meaning": "Vi - Da thuộc " },
"韭": { "pinyin": "jiǔ", "meaning": "Cửu - Rau hẹ" },
"音": { "pinyin": "yīn", "meaning": "Âm - Âm thanh" },
"頁": { "pinyin": "yè", "meaning": "Hiệt - Trang giấy, cái đầu (phồn thể)" },
"页": { "pinyin": "yè", "meaning": "Hiệt - Trang giấy" },
"風": { "pinyin": "fēng", "meaning": "Phong - Gió (phồn thể)" },
"风": { "pinyin": "fēng", "meaning": "Phong - Gió" },
"飛": { "pinyin": "fēi", "meaning": "Phi - Bay (phồn thể)" },
"飞": { "pinyin": "fēi", "meaning": "Phi - Bay" },
"食": { "pinyin": "shí", "meaning": "Thực - Ăn, đồ ăn" },
"飠": { "pinyin": "shí", "meaning": "Thực - Ăn, đồ ăn (phồn thể)" },
"首": { "pinyin": "shǒu", "meaning": "Thủ - Cái đầu" },
"香": { "pinyin": "xiāng", "meaning": "Hương - Mùi thơm" },
"馬": { "pinyin": "mǎ", "meaning": "Mã - Con ngựa (phồn thể)" },
"骨": { "pinyin": "gǔ", "meaning": "Cốt - Xương" },
"高": { "pinyin": "gāo", "meaning": "Cao - Cao lớn" },
"髟": { "pinyin": "biāo", "meaning": "Tiêu - Tóc dài" },
"鬥": { "pinyin": "dòu", "meaning": "Đấu - Chiến đấu" },
"鬯": { "pinyin": "chàng", "meaning": "Sướng - Rượu tế thần" },
"鬲": { "pinyin": "lì", "meaning": "Cách - Cái nồi cổ" },
"鬼": { "pinyin": "guǐ", "meaning": "Quỷ - Ma quỷ" },
"魚": { "pinyin": "yú", "meaning": "Ngư - Con cá (phồn thể)" },
"鱼": { "pinyin": "yú", "meaning": "Ngư - Con cá " },
"鳥": { "pinyin": "niǎo", "meaning": "Điểu - Con chim (phồn thể)" },
"鸟": { "pinyin": "niǎo", "meaning": "Điểu - Con chim " },
"鹵": { "pinyin": "lǔ", "meaning": "Lỗ - Đất mặn, muối" },
"鹿": { "pinyin": "lù", "meaning": "Lộc - Con hươu" },
"麥": { "pinyin": "mài", "meaning": "Mạch - Lúa mạch (phồn thể)" },
"麦": { "pinyin": "mài", "meaning": "Mạch - Lúa mạch" },
"麻": { "pinyin": "má", "meaning": "Ma - Cây gai, tê liệt" },
"黃": { "pinyin": "huáng", "meaning": "Hoàng - Màu vàng" },
"黍": { "pinyin": "shǔ", "meaning": "Thử - Lúa nếp" },
"黑": { "pinyin": "hēi", "meaning": "Hắc - Màu đen" },
"黹": { "pinyin": "zhǐ", "meaning": "Chỉ - May vá, thêu thùa" },
"黽": { "pinyin": "mǐn", "meaning": "Mãnh - Con ếch, cố gắng" },
"鼎": { "pinyin": "dǐng", "meaning": "Đỉnh - Cái đỉnh" },
"鼓": { "pinyin": "gǔ", "meaning": "Cổ - Cái trống" },
"鼠": { "pinyin": "shǔ", "meaning": "Thử - Con chuột" },
"鼻": { "pinyin": "bí", "meaning": "Tị - Cái mũi" },
"齊": { "pinyin": "qí", "meaning": "Tề - Ngang bằng (phồn thể)" },
"齐": { "pinyin": "qí", "meaning": "Tề - Ngang bằng" },
"齒": { "pinyin": "chǐ", "meaning": "Xỉ - Răng (phồn thể)" },
"齿": { "pinyin": "chǐ", "meaning": "Xỉ - Răng" },
"龍": { "pinyin": "lóng", "meaning": "Long - Con rồng (phồn thể)" },
"龙": { "pinyin": "lóng", "meaning": "Long - Con rồng " },
"龜": { "pinyin": "guī", "meaning": "Quy - Con rùa (phồn thể)" },
"龟": { "pinyin": "guī", "meaning": "Quy - Con rùa" },
"龠": { "pinyin": "yuè", "meaning": "Dược - Sáo trúc" },
"疋": { "pinyin": "pǐ", "meaning": "Sơ - Đơn vị đo vải, cái chân" },
"⺪": { "pinyin": "pǐ", "meaning": "Sơ (biến thể) - Đơn vị đo vải, cái chân" },
"癶": { "pinyin": "bō", "meaning": "Bát - Gạt ra, dẫm lên" },
"⺫": { "pinyin": "mù", "meaning": "Mục (biến thể) - Con mắt,nhìn" },
"矛": { "pinyin": "máo", "meaning": "Mâu - Cái mâu (vũ khí)" },
"矢": { "pinyin": "shǐ", "meaning": "Thỉ - Mũi tên" },
"禸": { "pinyin": "róu", "meaning": "Nhựu - Vết chân thú vật" },
"竹": { "pinyin": "zhú", "meaning": "Trúc - Cây tre, trúc" },
"⺮": { "pinyin": "zhú", "meaning": "Trúc (biến thể) - Cây tre, trúc" },
"米": { "pinyin": "mǐ", "meaning": "Mễ - Gạo, hạt nhỏ" },
"糸": { "pinyin": "mì", "meaning": "Mịch - Sợi tơ" },
"纟": { "pinyin": "sī", "meaning": "Mịch (biến thể) - Sợi tơ" },
"缶": { "pinyin": "fǒu", "meaning": "Phẫu - Đồ sành sứ, bình nước" },
"羊": { "pinyin": "yáng", "meaning": "Dương - Con dê" },
"⺷": { "pinyin": "yáng", "meaning": "Dương (biến thể) - Con dê" },
"羽": { "pinyin": "yǔ", "meaning": "Vũ - Lông vũ, cánh chim" },
"老": { "pinyin": "lǎo", "meaning": "Lão - Người già" },
"耂": { "pinyin": "lǎo", "meaning": "Lão (biến thể) - Người già" },
"耳": { "pinyin": "ěr", "meaning": "Nhĩ - Cái tai, nghe" },
"自": { "pinyin": "zì", "meaning": "Tự - Tự bản thân, cái mũi" },
"舌": { "pinyin": "shé", "meaning": "Thiệt - Cái lưỡi" },
"舛": { "pinyin": "chuǎn", "meaning": "Suyễn - Sai lầm, trái ngược" },
"舟": { "pinyin": "zhōu", "meaning": "Chu - Cái thuyền" },
"艮": { "pinyin": "gèn", "meaning": "Cấn - Bền cứng, dừng lại" },
"色": { "pinyin": "sè", "meaning": "Sắc - Màu sắc, dáng vẻ" },
"虍": { "pinyin": "hū", "meaning": "Hổ - Vằn vện của con hổ" },
"虫": { "pinyin": "chóng", "meaning": "Trùng - Sâu bọ, côn trùng" },
"血": { "pinyin": "xuè", "meaning": "Huyết - Máu" },
"衣": { "pinyin": "yī", "meaning": "Y - Quần áo" },
"衤": { "pinyin": "yī", "meaning": "Y (biến thể) - quần áo" },
"襾": { "pinyin": "yà", "meaning": "Á - Che đậy" },
"覀": { "pinyin": "yà", "meaning": "Á (biến thể) - che đậy" },
"見": { "pinyin": "jiàn", "meaning": "Kiến - Nhìn thấy (phồn thể)" },
"角": { "pinyin": "jiǎo", "meaning": "Giác - Sừng thú, góc" },
"言": { "pinyin": "yán", "meaning": "Ngôn - Nói, lời nói" },
"讠": { "pinyin": "yán", "meaning": "Ngôn (biến thể) - Nói" },
"谷": { "pinyin": "gǔ", "meaning": "Cốc - Khe núi, thung lũng" },
"豆": { "pinyin": "dòu", "meaning": "Đậu - Hạt đậu, đồ đựng" },
"豸": { "pinyin": "zhì", "meaning": "Trĩ - Loài muông thú không sừng" },
"貝": { "pinyin": "bèi", "meaning": "Bối - Vỏ ốc, quý báu (phồn thể)" },
"贝": { "pinyin": "bèi", "meaning": "Bối (giản thể) - Vỏ ốc, tiền tệ" },
"赤": { "pinyin": "chì", "meaning": "Xích - Màu đỏ" },
"走": { "pinyin": "zǒu", "meaning": "Tẩu - Đi, chạy" },
"⻊": { "pinyin": "zú", "meaning": "Túc (biến thể) - chân" },
"身": { "pinyin": "shēn", "meaning": "Thân - Thân thể, mình" },
"車": { "pinyin": "chē", "meaning": "Xa - Xe cộ (phồn thể)" },
"车": { "pinyin": "chē", "meaning": "Xa (giản thể) - Xe cộ" },
"辛": { "pinyin": "xīn", "meaning": "Tân - Cay, vất vả" },
"辰": { "pinyin": "chén", "meaning": "Thần - Nhật, nguyệt, tinh tú" },
"辵": { "pinyin": "chuò", "meaning": "Sước - Chợt đi chợt dừng" },
"邑": { "pinyin": "yì", "meaning": "Ấp - Vùng đất, kinh đô" }
};


const lessons = [
{
id: 1,
title: "Bài 1: Bài tập hàng ngày",
color: "#3498db",
vocabulary: [  
{ chinese: "希望", pinyin: "xī wàng", meaning: "Hy vọng", mastered: false },
{ chinese: "护士", pinyin: "hùshi", meaning: "y tá", mastered: false },
{ chinese: "贵", pinyin: "guì", meaning: "đắt, quý", mastered: false },
{ chinese: "度", pinyin: "dù", meaning: "độ ( Độ C)", mastered: false },
{ chinese: "报名", pinyin: "bào míng", meaning: "đăng kí", mastered: false },
{ chinese: "抄", pinyin: "chāo", meaning: "sao chép", mastered: false },
{ chinese: "城市", pinyin: "Chéngshì", meaning: "thành phố", mastered: false },
{ chinese: "苦", pinyin: "kǔ", meaning: "khổ, đắng", mastered: false },
{ chinese: "秒", pinyin: "miǎo", meaning: "giây (đơn vị thời gian)", mastered: false },
{ chinese: "回去", pinyin: "huí qù", meaning: "Về, trở về", mastered: false },
{ chinese: "医生", pinyin: "yīshēng", meaning: "Bác sĩ", mastered: false },
{ chinese: "撞", pinyin: "zhuàng", meaning: "đâm,va chạm", mastered: false },
{ chinese: "任务", pinyin: "rèn wù", meaning: "nhiệm vụ", mastered: false },
{ chinese: "辣", pinyin: "là", meaning: "cay", mastered: false },
{ chinese: "失败", pinyin: "shī bài", meaning: "thất bại", mastered: false },
{ chinese: "其他", pinyin: "qítā", meaning: "khác", mastered: false },
{ chinese: "驾驶员", pinyin: "Jiàshǐ yuán", meaning: "tài xế", mastered: false },
{ chinese: "干预", pinyin: "gān yù", meaning: "can dự, can thiệp", mastered: false },
{ chinese: "介绍", pinyin: "Jièshào", meaning: "giới thiệu", mastered: false },
{ chinese: "规定", pinyin: "guīdìng", meaning: "Quy định", mastered: false },
{ chinese: "买", pinyin: "mǎi", meaning: "Mua", mastered: false },
{ chinese: "原因", pinyin: "yuán yīn", meaning: "nguyên nhân", mastered: false },
{ chinese: "旧", pinyin: "jiù", meaning: "cũ", mastered: false },
{ chinese: "住", pinyin: "zhù", meaning: "sống, cư trú", mastered: false },
{ chinese: "版本", pinyin: "bǎn běn", meaning: "phiên bản", mastered: false },
{ chinese: "我爱你", pinyin: "wǒ ài nǐ", meaning: "Tôi yêu bạn", mastered: false }

      ]
},
{ 
id: 2,
title: "Bài 2: Đã học",
color: "#3498db",
vocabulary: [
{ chinese: "一再", pinyin: "yízài", meaning: "nhiều lần", mastered: false },
{ chinese: "酸", pinyin: "suān", meaning: "chua", mastered: false },
{ chinese: "办法", pinyin: "bànfǎ", meaning: "biện pháp", mastered: false },
{ chinese: "北宁", pinyin: "Běiníng", meaning: "Bắc Ninh", mastered: false },
{ chinese: "不客气", pinyin: "bú kèqì", meaning: "không có gì (đáp lại lời cảm ơn)", mastered: false },
{ chinese: "聪明", pinyin: "cōngmíng", meaning: "thông minh", mastered: false },
{ chinese: "省", pinyin: "Shěng", meaning: "tỉnh", mastered: false },
{ chinese: "质量", pinyin: "zhìliàng", meaning: "chất lượng", mastered: false },
{ chinese: "类型", pinyin: "lèi xíng", meaning: "loại hình", mastered: false },
{ chinese: "练习", pinyin: "liànxí", meaning: "luyện tập", mastered: false },
{ chinese: "检查", pinyin: "jiǎnchá", meaning: "kiểm tra", mastered: false },
{ chinese: "衣服", pinyin: "yīfú", meaning: "Quần áo", mastered: false },
{ chinese: "百分之", pinyin: "Bǎi fēn zhī", meaning: "Phần trăm", mastered: false },
{ chinese: "先", pinyin: "xiān", meaning: "Trước, trước tiên", mastered: false },
{ chinese: "好久", pinyin: "hǎo jiǔ", meaning: "Khá lâu, đã lâu rồi", mastered: false },
{ chinese: "最近", pinyin: "zuìjìn", meaning: "gần đây", mastered: false },
{ chinese: "高兴", pinyin: "gāo xìng", meaning: "Vui", mastered: false },
{ chinese: "认识", pinyin: "rèn shi", meaning: "nhận biết, làm quen", mastered: false },
{ chinese: "先走了", pinyin: "xiān zǒu le", meaning: "đi trước đây", mastered: false },
{ chinese: "会", pinyin: "huì", meaning: "sẽ, biết (kỹ năng)", mastered: false },
{ chinese: "有点", pinyin: "yǒudiǎn", meaning: "một chút, hơi", mastered: false },
{ chinese: "不太", pinyin: "bútài", meaning: "không quá", mastered: false },
{ chinese: "灯", pinyin: "dēng", meaning: "đèn", mastered: false },
{ chinese: "灯光", pinyin: "dēngguāng", meaning: "Ánh sáng", mastered: false },
{ chinese: "里面", pinyin: "lǐmiàn", meaning: "Bên trong", mastered: false },
{ chinese: "外面", pinyin: "wàimiàn", meaning: "Bên ngoài", mastered: false },
{ chinese: "每", pinyin: "měi", meaning: "mỗi", mastered: false },
{ chinese: "站", pinyin: "zhàn", meaning: "Trạm", mastered: false },
{ chinese: "甜", pinyin: "tián", meaning: "ngọt", mastered: false },
{ chinese: "第", pinyin: "dì", meaning: "thứ", mastered: false },
{ chinese: "玩", pinyin: "wán", meaning: "chơi", mastered: false },
{ chinese: "两千", pinyin: "Liǎng qiān", meaning: "Hai nghìn", mastered: false },
{ chinese: "亿", pinyin: "Yì", meaning: "trăm triệu", mastered: false },
{ chinese: "食物", pinyin: "shí wù", meaning: "Thức ăn", mastered: false },
{ chinese: "茶", pinyin: "chá", meaning: "Trà", mastered: false },
{ chinese: "太棒", pinyin: "tàibàng", meaning: "Giỏi quá", mastered: false },
{ chinese: "几", pinyin: "jǐ", meaning: "mấy", mastered: false },
{ chinese: "面条", pinyin: "miàn tiáo", meaning: "Mỳ", mastered: false },
{ chinese: "静置", pinyin: "jìng zhì", meaning: "Đứng yên", mastered: false },
{ chinese: "过去", pinyin: "guòqù", meaning: "quá khứ", mastered: false },
{ chinese: "替代", pinyin: "tìdài", meaning: "thay thế", mastered: false },
{ chinese: "来", pinyin: "lái", meaning: "Đến đây", mastered: false },
{ chinese: "停", pinyin: "tíng", meaning: "dừng", mastered: false },
{ chinese: "停下", pinyin: "tíngxià", meaning: "dừng lại", mastered: false },
{ chinese: "键盘", pinyin: "jiàn pán", meaning: "bàn phím", mastered: false },
{ chinese: "司机", pinyin: "sījī", meaning: "lái xe, tài xế", mastered: false },
{ chinese: "为了", pinyin: "wèi le", meaning: "Để", mastered: false },
{ chinese: "前天", pinyin: "qián tiān", meaning: "Ngày hôm kia", mastered: false },
{ chinese: "可以", pinyin: "kěyǐ", meaning: "có thể", mastered: false },
{ chinese: "能", pinyin: "néng", meaning: "Có thể", mastered: false },
{ chinese: "仍然", pinyin: "réng rán", meaning: "vẫn", mastered: false },
{ chinese: "独特", pinyin: "dútè", meaning: "đặc biệt", mastered: false },
{ chinese: "还", pinyin: "hái", meaning: "vẫn, còn", mastered: false },
{ chinese: "博士", pinyin: "bóshì", meaning: "tiến sỹ", mastered: false },
{ chinese: "助理", pinyin: "zhùlǐ", meaning: "Trợ lý", mastered: false },
{ chinese: "工程师", pinyin: "Gōngchéngshī", meaning: "Kỹ sư", mastered: false },
{ chinese: "农夫", pinyin: "Nóngfū", meaning: "nông dân", mastered: false },
{ chinese: "来自", pinyin: "láizì", meaning: "Đến từ", mastered: false },
{ chinese: "家", pinyin: "Jiā", meaning: "nhà", mastered: false },
{ chinese: "叫", pinyin: "Jiào", meaning: "được gọi là, tên là", mastered: false },
{ chinese: "不过", pinyin: "bù guò", meaning: "nhưng, có điều", mastered: false },
{ chinese: "过年", pinyin: "guònián", meaning: "Năm mới", mastered: false },
{ chinese: "过期", pinyin: "guò qī", meaning: "quá hạn", mastered: false },
{ chinese: "过奖", pinyin: "guò jiǎng", meaning: "quá khen", mastered: false },
{ chinese: "过分", pinyin: "guò fèn", meaning: "quá đáng", mastered: false },
{ chinese: "旁边", pinyin: "pángbiān", meaning: "bên cạnh", mastered: false },
{ chinese: "后面", pinyin: "hòumiàn", meaning: "phía sau", mastered: false },
{ chinese: "前面", pinyin: "qiánmiàn", meaning: "phía trước", mastered: false },
{ chinese: "锤", pinyin: "chuí", meaning: "cái búa", mastered: false },
{ chinese: "便宜", pinyin: "pián yi", meaning: "Rẻ", mastered: false },
{ chinese: "汽车", pinyin: "qì chē", meaning: "Xe hơi", mastered: false },
{ chinese: "位置", pinyin: "wèizhi", meaning: "vị trí, chỗ", mastered: false },
{ chinese: "分钟", pinyin: "Fēnzhōng", meaning: "phút", mastered: false },
{ chinese: "新建", pinyin: "xīnjiàn", meaning: "Tạo mới (New/Create)", mastered: false },
{ chinese: "断线", pinyin: "duànxiàn", meaning: "Mất kết nối", mastered: false },
{ chinese: "中午", pinyin: "zhōngwǔ", meaning: "Buổi Trưa", mastered: false },
{ chinese: "确认", pinyin: "què rèn", meaning: "xác nhận", mastered: false },
{ chinese: "功课", pinyin: "gōng kè", meaning: "bài tập, môn học", mastered: false },
{ chinese: "觉得", pinyin: "jué de", meaning: "Cảm thấy", mastered: false },
{ chinese: "钱", pinyin: "qián", meaning: "Tiền", mastered: false },
{ chinese: "都", pinyin: "Dōu", meaning: "đều", mastered: false },
{ chinese: "请", pinyin: "qǐng", meaning: "mời", mastered: false },
{ chinese: "割", pinyin: "gē", meaning: "Cắt", mastered: false },
{ chinese: "倾听", pinyin: "qīngtīng", meaning: "Lắng nghe", mastered: false },
{ chinese: "油菜", pinyin: "yóucài", meaning: "Hiếp dâm", mastered: false },
{ chinese: "解释", pinyin: "jiěshì", meaning: "giải thích", mastered: false },
{ chinese: "请假", pinyin: "qǐngjià", meaning: "Nghỉ phép (xin nghỉ)", mastered: false },
{ chinese: "聚会", pinyin: "jù huì", meaning: "tụ tập", mastered: false },
{ chinese: "升级", pinyin: "shēngjí", meaning: "Nâng cấp", mastered: false },
{ chinese: "编辑", pinyin: "biānjí", meaning: "Chỉnh sửa (Edit)", mastered: false },
{ chinese: "白班", pinyin: "Báibān", meaning: "Ca ngày", mastered: false },
{ chinese: "爷爷", pinyin: "yéyé", meaning: "Ông", mastered: false },
{ chinese: "部长", pinyin: "bùzhǎng", meaning: "Bộ trưởng", mastered: false },
{ chinese: "员工", pinyin: "yuángōng", meaning: "Công nhân", mastered: false },
{ chinese: "啤酒", pinyin: "píjiǔ", meaning: "Bia", mastered: false },
{ chinese: "回家", pinyin: "huí jiā", meaning: "Về nhà đi", mastered: false },
{ chinese: "火锅", pinyin: "huǒguō", meaning: "Lẩu", mastered: false },
{ chinese: "数量", pinyin: "shùliàng", meaning: "Số lượng", mastered: false },
{ chinese: "六角", pinyin: "liùjiǎo", meaning: "Lục năng (bộ lục)", mastered: false },
{ chinese: "弟弟", pinyin: "dìdì", meaning: "em trai", mastered: false },
{ chinese: "划伤", pinyin: "huà shāng", meaning: "xước(nhẹ)", mastered: false },
{ chinese: "登出", pinyin: "Dēngchū", meaning: "đăng xuất", mastered: false },
{ chinese: "报警", pinyin: "baojǐng", meaning: "Báo động", mastered: false },
{ chinese: "酒", pinyin: "jiǔ", meaning: "Rượu", mastered: false },
{ chinese: "声音", pinyin: "shēngyīn", meaning: "âm thanh", mastered: false },
{ chinese: "一定", pinyin: "yīdìng", meaning: "nhất định", mastered: false },
{ chinese: "一样", pinyin: "yīyàng", meaning: "giống nhau", mastered: false },
{ chinese: "下雨", pinyin: "xià yǔ", meaning: "mưa", mastered: false },
{ chinese: "不足", pinyin: "bú zú", meaning: "không đủ", mastered: false },
{ chinese: "和", pinyin: "hé", meaning: "và", mastered: false },
{ chinese: "生病", pinyin: "shēng bìng", meaning: "Ốm", mastered: false },
{ chinese: "健康", pinyin: "jiàn kāng", meaning: "Sức khỏe", mastered: false },
{ chinese: "按钮", pinyin: "ànniǔ", meaning: "nút ấn", mastered: false },
{ chinese: "登录", pinyin: "Dēnglù", meaning: "đăng nhập", mastered: false },
{ chinese: "份", pinyin: "fèn", meaning: "phần", mastered: false },
{ chinese: "停顿", pinyin: "tíngdùn", meaning: "Tạm dừng", mastered: false },
{ chinese: "准确", pinyin: "zhǔn què", meaning: "chính xác", mastered: false },
{ chinese: "鼠标", pinyin: "Shǔbiāo", meaning: "Chuột", mastered: false },
{ chinese: "完成", pinyin: "wánchéng", meaning: "hoàn thành", mastered: false },
{ chinese: "的", pinyin: "de", meaning: "của (thuộc tính)", mastered: false },
{ chinese: "实际", pinyin: "shí jì", meaning: "thực tế", mastered: false },
{ chinese: "一切", pinyin: "yī qiè", meaning: "tất cả", mastered: false },
{ chinese: "一共", pinyin: "yīgòng", meaning: "tổng cộng", mastered: false },
{ chinese: "连接", pinyin: "liánjiē", meaning: "kết nối", mastered: false },
{ chinese: "送", pinyin: "sòng", meaning: "Tặng, Đưa tiễn", mastered: false },
{ chinese: "名字", pinyin: "Míngzì", meaning: "tên", mastered: false },
{ chinese: "拿", pinyin: "ná", meaning: "Cầm, Lấy", mastered: false },
{ chinese: "返修", pinyin: "fǎnxiū", meaning: "Làm lại", mastered: false },
{ chinese: "少", pinyin: "shǎo", meaning: "ít", mastered: false },
{ chinese: "读", pinyin: "dú", meaning: "Đọc", mastered: false },
{ chinese: "忘", pinyin: "wàng", meaning: "Quên", mastered: false },
{ chinese: "正在", pinyin: "zhèngzài", meaning: "Đang (nhấn mạnh hơn)", mastered: false },
{ chinese: "以前", pinyin: "yǐ qián", meaning: "Trước đây", mastered: false },
{ chinese: "以后", pinyin: "yǐhòu", meaning: "sau này", mastered: false },
{ chinese: "低", pinyin: "dī", meaning: "thấp", mastered: false },
{ chinese: "继续", pinyin: "jìxù", meaning: "tiếp tục", mastered: false },
{ chinese: "学习", pinyin: "xué xí", meaning: "Học tập", mastered: false },
{ chinese: "改进", pinyin: "gǎijìn", meaning: "Cải tiến", mastered: false },
{ chinese: "爱情", pinyin: "ài qíng [ái tình]", meaning: "tình yêu", mastered: false },
{ chinese: "回答", pinyin: "huídá", meaning: "trả lời", mastered: false },
{ chinese: "很", pinyin: "Hěn", meaning: "Rất", mastered: false },
{ chinese: "小心", pinyin: "xiǎoxīn", meaning: "Cẩn thận", mastered: false },
{ chinese: "螺丝", pinyin: "luósī", meaning: "Ốc vít", mastered: false },
{ chinese: "右边", pinyin: "yòubiān", meaning: "Phải", mastered: false },
{ chinese: "管理", pinyin: "guǎnlǐ", meaning: "Quản lý", mastered: false },
{ chinese: "越南语", pinyin: "yuènán yǔ", meaning: "Tiếng việt", mastered: false },
{ chinese: "写", pinyin: "xiě", meaning: "Viết", mastered: false },
{ chinese: "电", pinyin: "diàn", meaning: "Điện", mastered: false },
{ chinese: "冷", pinyin: "lěng", meaning: "Lạnh", mastered: false },
{ chinese: "电钻", pinyin: "diànzuàn", meaning: "Máy khoan điện", mastered: false },
{ chinese: "充电中", pinyin: "chōngdiàn zhōng", meaning: "Đang sạc", mastered: false },
{ chinese: "不相信", pinyin: "bù xiāngxìn", meaning: "không tin", mastered: false },
{ chinese: "累", pinyin: "Lèi", meaning: "mệt", mastered: false },
{ chinese: "进", pinyin: "jìn", meaning: "Tiến", mastered: false },
{ chinese: "放", pinyin: "fàng", meaning: "Thả, Đặt", mastered: false },
{ chinese: "密码", pinyin: "mìmǎ", meaning: "mật mã", mastered: false },
{ chinese: "饿", pinyin: "È", meaning: "đói", mastered: false },
{ chinese: "备份", pinyin: "bèifèn", meaning: "Backup", mastered: false },
{ chinese: "此", pinyin: "cǐ", meaning: "này, đây", mastered: false },
{ chinese: "教室", pinyin: "jiào shì", meaning: "lớp học", mastered: false },
{ chinese: "长", pinyin: "cháng", meaning: "dài", mastered: false },
{ chinese: "完", pinyin: "wán", meaning: "xong, hoàn thành", mastered: false },
{ chinese: "新", pinyin: "xīn", meaning: "mới", mastered: false },
{ chinese: "也", pinyin: "yě", meaning: "cũng", mastered: false },
{ chinese: "已经", pinyin: "yǐjīng", meaning: "đã", mastered: false },
{ chinese: "休息", pinyin: "xiūxi", meaning: "nghỉ ngơi", mastered: false },
{ chinese: "被", pinyin: "bèi", meaning: "bị, được (giới từ bị động)", mastered: false },
{ chinese: "变化", pinyin: "biànhuà", meaning: "thay đổi", mastered: false },
{ chinese: "别人", pinyin: "biérén", meaning: "người khác", mastered: false },
{ chinese: "操作", pinyin: "Cāozuò", meaning: "Thao tác/Vận hành", mastered: false },
{ chinese: "状态", pinyin: "zhuàngtài", meaning: "Trạng thái", mastered: false },
{ chinese: "电量", pinyin: "Diànliàng", meaning: "Mức pin/Dung lượng điện", mastered: false },
{ chinese: "左边", pinyin: "zuǒbiān", meaning: "Bên trái", mastered: false },
{ chinese: "空框", pinyin: "kōng kuàng", meaning: "Lồng Trống", mastered: false },
{ chinese: "终点", pinyin: "zhōngdiǎn", meaning: "Điểm đến", mastered: false },
{ chinese: "订单类型", pinyin: "Dìngdān lèixíng", meaning: "Loại đơn hàng", mastered: false },
{ chinese: "执行订单", pinyin: "zhíxíng dìngdān", meaning: "Thực thi đơn hàng", mastered: false },
{ chinese: "订单", pinyin: "dìngdān", meaning: "Đơn hàng", mastered: false },
{ chinese: "成功", pinyin: "Chénggōng", meaning: "Thành công", mastered: false },
{ chinese: "搞定了", pinyin: "Gǎo dìng le", meaning: "xong việc/ổn rồi", mastered: false },
{ chinese: "我来做", pinyin: "Wǒ lái zuò", meaning: "Để tôi làm", mastered: false },
{ chinese: "下", pinyin: "xià", meaning: "xuống", mastered: false },
{ chinese: "你在干什么", pinyin: "nǐzài gan shenme ？", meaning: "Bạn đang làm gì vậy?", mastered: false },
{ chinese: "上", pinyin: "shàng", meaning: "Lên", mastered: false },
{ chinese: "短", pinyin: "duǎn", meaning: "ngắn", mastered: false },
{ chinese: "料框", pinyin: "liào kuàng", meaning: "Lồng có liệu", mastered: false },
{ chinese: "刚才", pinyin: "gāngcái", meaning: "Vừa nãy / Lúc nãy", mastered: false },
{ chinese: "工作", pinyin: "gōngzuò", meaning: "làm việc", mastered: false },
{ chinese: "今天", pinyin: "jīn tiān", meaning: "Hôm nay", mastered: false },
{ chinese: "输送带", pinyin: "shū sòng dài", meaning: "băng tải", mastered: false },
{ chinese: "运行", pinyin: "yùnxíng", meaning: "Đang chạy", mastered: false },
{ chinese: "传感器", pinyin: "chuán gǎn qì", meaning: "sensor", mastered: false },
{ chinese: "到这里", pinyin: "dào zhèlǐ", meaning: "Đến đây", mastered: false },
{ chinese: "哪个", pinyin: "Nǎge", meaning: "Cái nào", mastered: false },
{ chinese: "那个", pinyin: "nàgè", meaning: "Cái đó", mastered: false },
{ chinese: "空闲", pinyin: "kòngxián", meaning: "Rảnh", mastered: false },
{ chinese: "这个怎么说", pinyin: "Zhège zěnme shuō", meaning: "Cái này nói như thế nào?", mastered: false },
{ chinese: "半", pinyin: "bàn", meaning: "một nửa", mastered: false },
{ chinese: "安全", pinyin: "ān quán [an toàn]", meaning: "an toàn", mastered: false },
{ chinese: "快乐", pinyin: "kuàilè", meaning: "vui vẻ", mastered: false },
{ chinese: "问题", pinyin: "wèntí", meaning: "vấn đề", mastered: false },
{ chinese: "关", pinyin: "guān", meaning: "đóng, tắt", mastered: false },
{ chinese: "层", pinyin: "céng", meaning: "tầng", mastered: false },
{ chinese: "对", pinyin: "duì", meaning: "Đúng", mastered: false },
{ chinese: "手机", pinyin: "shǒujī", meaning: "điện thoại di động", mastered: false },
{ chinese: "电脑", pinyin: "diàn nǎo", meaning: "Máy tính", mastered: false },
{ chinese: "给你", pinyin: "gěi nǐ", meaning: "Cho bạn", mastered: false },
{ chinese: "设备", pinyin: "Shèbèi", meaning: "Thiết bị", mastered: false },
{ chinese: "昨天", pinyin: "zuó tiān", meaning: "Hôm qua", mastered: false },
{ chinese: "修理", pinyin: "xiūlǐ", meaning: "Sửa chữa", mastered: false },
{ chinese: "看到", pinyin: "kàndào", meaning: "nhìn thấy", mastered: false },
{ chinese: "书", pinyin: "shū", meaning: "Sách", mastered: false },
{ chinese: "爱好", pinyin: "àihào", meaning: "sở thích", mastered: false },
{ chinese: "办公室", pinyin: "bàngōngshì", meaning: "văn phòng", mastered: false },
{ chinese: "安排", pinyin: "ān pái [an bài]", meaning: "sắp xếp", mastered: false },
{ chinese: "仓库", pinyin: "cāngkù", meaning: "Nhà kho", mastered: false },
{ chinese: "等一下", pinyin: "děngyíxià", meaning: "Chờ một chút", mastered: false },
{ chinese: "为什么", pinyin: "wèishénme", meaning: "tại sao", mastered: false },
{ chinese: "电梯", pinyin: "diàntī", meaning: "thang máy", mastered: false },
{ chinese: "换", pinyin: "huàn", meaning: "đổi", mastered: false },
{ chinese: "联系", pinyin: "liánxì", meaning: "Liên hệ", mastered: false },
{ chinese: "明天", pinyin: "míng tiān", meaning: "Ngày mai", mastered: false },
{ chinese: "不行", pinyin: "bùxíng", meaning: "Không được", mastered: false },
{ chinese: "删除", pinyin: "shānchú", meaning: "Xóa (Delete)", mastered: false },
{ chinese: "米饭", pinyin: "mǐ fàn", meaning: "Cơm", mastered: false },
{ chinese: "商店", pinyin: "shāng diàn", meaning: "Cửa hàng", mastered: false },
{ chinese: "别动", pinyin: "bie dong", meaning: "Đừng động", mastered: false },
{ chinese: "水", pinyin: "shuǐ", meaning: "Nước", mastered: false },
{ chinese: "他们", pinyin: "Tāmen", meaning: "Họ", mastered: false },
{ chinese: "吗", pinyin: "Ma", meaning: "không (từ để hỏi)", mastered: false },
{ chinese: "帅", pinyin: "Shuài", meaning: "đẹp trai", mastered: false },
{ chinese: "漂亮", pinyin: "Piàoliang", meaning: "xinh gái", mastered: false },
{ chinese: "哥哥", pinyin: "Gēge", meaning: "anh trai", mastered: false },
{ chinese: "今年", pinyin: "Jīnnián", meaning: "năm nay", mastered: false },
{ chinese: "越南", pinyin: "Yuènán", meaning: "Việt Nam", mastered: false },
{ chinese: "中国", pinyin: "Zhōngguó", meaning: "Trung Quốc", mastered: false },
{ chinese: "帮助", pinyin: "bāngzhù", meaning: "giúp đỡ", mastered: false },
{ chinese: "产品", pinyin: "chǎnpǐn", meaning: "sản phẩm", mastered: false },
{ chinese: "地图", pinyin: "dì tú", meaning: "Bản đồ", mastered: false },
{ chinese: "别", pinyin: "bié", meaning: "đừng, không được", mastered: false },
{ chinese: "在哪里", pinyin: "zàinǎli", meaning: "Ở đâu", mastered: false },
{ chinese: "缓存", pinyin: "huǎncún", meaning: "Lưu trữ", mastered: false },
{ chinese: "没错", pinyin: "méicuò", meaning: "không sai, đúng rồi", mastered: false },
{ chinese: "材料", pinyin: "cáiliào", meaning: "nguyên vật liệu, nguyên liệu", mastered: false },
{ chinese: "归", pinyin: "guī", meaning: "trở về", mastered: false },
{ chinese: "交换", pinyin: "jiāohuàn", meaning: "trao đổi", mastered: false },
{ chinese: "闹", pinyin: "nào", meaning: "ồn ào, ầm ĩ", mastered: false },
{ chinese: "要", pinyin: "yào", meaning: "cần, phải", mastered: false },
{ chinese: "走吧", pinyin: "zǒuba", meaning: "đi thôi", mastered: false },
{ chinese: "结婚", pinyin: "Jiéhūn", meaning: "kết hôn", mastered: false },
{ chinese: "公司", pinyin: "gōng sī", meaning: "Công ty", mastered: false },
{ chinese: "安静", pinyin: "ānjìng", meaning: "yên tĩnh", mastered: false },
{ chinese: "多少", pinyin: "duōshǎo", meaning: "bao nhiêu", mastered: false },
{ chinese: "固定", pinyin: "gùdìng", meaning: "cố định", mastered: false },
{ chinese: "喜欢", pinyin: "Xǐhuān", meaning: "thích", mastered: false },
{ chinese: "懂", pinyin: "dǒng", meaning: "hiểu", mastered: false },
{ chinese: "寻找", pinyin: "xúnzhǎo", meaning: "tìm, tìm kiếm", mastered: false },
{ chinese: "是", pinyin: "Shì", meaning: "là", mastered: false },
{ chinese: "在", pinyin: "zài", meaning: "đang", mastered: false },
{ chinese: "开", pinyin: "kāi", meaning: "Bật", mastered: false },
{ chinese: "这点", pinyin: "zhè diǎn", meaning: "điểm này", mastered: false },
{ chinese: "线", pinyin: "xiàn", meaning: "Line", mastered: false },
{ chinese: "对不起", pinyin: "duì bu qǐ", meaning: "Xin lỗi", mastered: false },
{ chinese: "没关系", pinyin: "méi guān xi", meaning: "Không sao", mastered: false },
{ chinese: "五", pinyin: "wǔ", meaning: "Số năm", mastered: false },
{ chinese: "六", pinyin: "liù", meaning: "Số sáu", mastered: false },
{ chinese: "七", pinyin: "qī", meaning: "Số bảy", mastered: false },
{ chinese: "八", pinyin: "bā", meaning: "Số tám", mastered: false },
{ chinese: "九", pinyin: "jiǔ", meaning: "Số chín", mastered: false },
{ chinese: "卖", pinyin: "mài", meaning: "Bán", mastered: false },
{ chinese: "用", pinyin: "yòng", meaning: "Dùng", mastered: false },
{ chinese: "出", pinyin: "chū", meaning: "Ra", mastered: false },
{ chinese: "到", pinyin: "dào", meaning: "Đến", mastered: false },
{ chinese: "找", pinyin: "zhǎo", meaning: "Tìm", mastered: false },
{ chinese: "准备", pinyin: "zhǔn bèi", meaning: "Chuẩn bị", mastered: false },
{ chinese: "厘米", pinyin: "límǐ", meaning: "xentimét", mastered: false },
{ chinese: "偏", pinyin: "piān", meaning: "lệch", mastered: false },
{ chinese: "跑偏", pinyin: "pǎo piān", meaning: "Lệch đường", mastered: false },
{ chinese: "激光", pinyin: "jīguāng", meaning: "Lidar,cảm biến quét", mastered: false },
{ chinese: "系统", pinyin: "xìtǒng", meaning: "Hệ thống", mastered: false },
{ chinese: "赏", pinyin: "shǎng", meaning: "thưởng, khen ngợi", mastered: false },
{ chinese: "移动", pinyin: "yídòng", meaning: "di chuyển", mastered: false },
{ chinese: "现在", pinyin: "xiànzài", meaning: "bây giờ, hiện tại", mastered: false },
{ chinese: "轻易", pinyin: "qīngyì", meaning: "dễ dàng", mastered: false },
{ chinese: "岁", pinyin: "Suì", meaning: "tuổi", mastered: false },
{ chinese: "帽子", pinyin: "màozi", meaning: "cái mũ", mastered: false },
{ chinese: "坐", pinyin: "zuò", meaning: "ngồi", mastered: false },
{ chinese: "时间", pinyin: "shíjiān", meaning: "thời gian", mastered: false },
{ chinese: "老师", pinyin: "lǎo shī", meaning: "Giáo viên", mastered: false },
{ chinese: "开始", pinyin: "kāi shǐ", meaning: "Bắt đầu", mastered: false },
{ chinese: "见", pinyin: "jiàn", meaning: "Gặp", mastered: false },
{ chinese: "再见", pinyin: "zài jiàn", meaning: "Tạm biệt", mastered: false },
{ chinese: "跑", pinyin: "pǎo", meaning: "Chạy", mastered: false },
{ chinese: "免费", pinyin: "miǎnfèi", meaning: "miễn phí", mastered: false },
{ chinese: "加班", pinyin: "jiābān", meaning: "tăng ca", mastered: false },
{ chinese: "按时", pinyin: "ànshí", meaning: "đúng giờ", mastered: false },
{ chinese: "迟到", pinyin: "chídào", meaning: "muộn, đến muộn", mastered: false },
{ chinese: "没有", pinyin: "méiyǒu", meaning: "không có", mastered: false },
{ chinese: "下午", pinyin: "xiàwǔ", meaning: "buổi chiều", mastered: false },
{ chinese: "结束", pinyin: "jié shù", meaning: "Kết thúc", mastered: false },
{ chinese: "会议", pinyin: "huì yì", meaning: "Cuộc họp", mastered: false },
{ chinese: "借", pinyin: "jiè", meaning: "Mượn, Cho mượn", mastered: false },
{ chinese: "忙", pinyin: "máng", meaning: "bận", mastered: false },
{ chinese: "想", pinyin: "xiǎng", meaning: "Nghĩ, Nhớ, Muốn", mastered: false },
{ chinese: "为", pinyin: "wèi", meaning: "Vì", mastered: false },
{ chinese: "因为", pinyin: "yīn wèi", meaning: "Bởi vì", mastered: false },
{ chinese: "做", pinyin: "zuò", meaning: "Làm", mastered: false },
{ chinese: "当", pinyin: "dāng", meaning: "Đảm nhận/Làm", mastered: false },
{ chinese: "到底", pinyin: "dàodǐ", meaning: "Rốt cuộc", mastered: false },
{ chinese: "还是", pinyin: "hái shi", meaning: "Hay là", mastered: false },
{ chinese: "工资", pinyin: "gōngzī", meaning: "Lương", mastered: false },
{ chinese: "高", pinyin: "gāo", meaning: "Cao", mastered: false },
{ chinese: "早上好", pinyin: "zǎo shang hǎo", meaning: "Chào buổi sáng", mastered: false },
{ chinese: "次", pinyin: "cì", meaning: "lần", mastered: false },
{ chinese: "等", pinyin: "děng", meaning: "đợi", mastered: false },
{ chinese: "妹妹", pinyin: "mèimei", meaning: "em gái", mastered: false },
{ chinese: "晚上", pinyin: "wǎnshàng", meaning: "buổi tối", mastered: false },
{ chinese: "逻辑", pinyin: "luójí", meaning: "Logic", mastered: false },
{ chinese: "优化", pinyin: "yōuhuà", meaning: "tối ưu", mastered: false },
{ chinese: "还没", pinyin: "háiméi", meaning: "Chưa", mastered: false },
{ chinese: "处理", pinyin: "chúlǐ", meaning: "xử lí", mastered: false },
{ chinese: "翻译", pinyin: "fānyì", meaning: "Dịch", mastered: false },
{ chinese: "生产", pinyin: "shēngchǎn", meaning: "Sản xuất", mastered: false },
{ chinese: "分析", pinyin: "fēnxī", meaning: "Phân tích", mastered: false },
{ chinese: "热", pinyin: "rè", meaning: "Nóng", mastered: false },
{ chinese: "十", pinyin: "shí", meaning: "Mười", mastered: false },
{ chinese: "百", pinyin: "bǎi", meaning: "Trăm", mastered: false },
{ chinese: "千", pinyin: "qiān", meaning: "Ngàn", mastered: false },
{ chinese: "十万", pinyin: "shí wàn", meaning: "Một trăm ngàn", mastered: false },
{ chinese: "百万", pinyin: "bǎi wàn", meaning: "Triệu", mastered: false },
{ chinese: "千万", pinyin: "qiān wàn", meaning: "Mười triệu", mastered: false },
{ chinese: "正常", pinyin: "zhèngcháng", meaning: "bình thường", mastered: false },
{ chinese: "然后", pinyin: "ránhòu", meaning: "Sau đó", mastered: false },
{ chinese: "重要", pinyin: "zhòngyào", meaning: "Quan trọng", mastered: false },
{ chinese: "但", pinyin: "dàn", meaning: "nhưng", mastered: false },
{ chinese: "程序", pinyin: "Chéngxù", meaning: "Chương trình", mastered: false },
{ chinese: "刚", pinyin: "gāng", meaning: "vừa", mastered: false },
{ chinese: "万", pinyin: "wàn", meaning: "Vạn", mastered: false },
{ chinese: "更新", pinyin: "gēngxīn", meaning: "Cập nhật", mastered: false },
{ chinese: "我爱你", pinyin: "wǒ ài nǐ", meaning: "Tôi yêu bạn", mastered: false },
{ chinese: "朋友", pinyin: "péng yǒu", meaning: "Bạn bè", mastered: false },
{ chinese: "家庭", pinyin: "jiā tíng", meaning: "Gia đình", mastered: false },
{ chinese: "妈妈", pinyin: "mā ma", meaning: "Mẹ", mastered: false },
{ chinese: "爸爸", pinyin: "bà ba", meaning: "Bố", mastered: false }
]
},
{
id: 3,
title: "Bài 3: Lưu trữ",
color: "#3498db",
vocabulary: [
{ chinese: "学生", pinyin: "xué sheng", meaning: "Học sinh", mastered: false },
{ chinese: "学校", pinyin: "xué xiào", meaning: "Trường học", mastered: false },
{ chinese: "学习", pinyin: "xué xí", meaning: "Học tập", mastered: false },
{ chinese: "便宜", pinyin: "pián yi", meaning: "Rẻ", mastered: false },
{ chinese: "喝茶", pinyin: "Hē chá", meaning: "uống chè/trà", mastered: false },
{ chinese: "晚安", pinyin: "Wǎnān", meaning: "Chúc ngủ ngon", mastered: false },
{ chinese: "夜晚", pinyin: "Yèwǎn", meaning: "đêm", mastered: false },
{ chinese: "都", pinyin: "Dōu", meaning: "đều", mastered: false },
{ chinese: "身体", pinyin: "Shēntǐ", meaning: "sức khỏe", mastered: false },
{ chinese: "经理", pinyin: "Jīnglǐ", meaning: "giám đốc", mastered: false },
{ chinese: "健康", pinyin: "jiàn kāng", meaning: "Sức khỏe", mastered: false },
{ chinese: "药", pinyin: "yào", meaning: "Thuốc", mastered: false },
{ chinese: "医院", pinyin: "yī yuàn", meaning: "Bệnh viện", mastered: false },
{ chinese: "早上好", pinyin: "zǎo shang hǎo", meaning: "Chào buổi sáng", mastered: false },
{ chinese: "晚上好", pinyin: "wǎn shang hǎo", meaning: "Chào buổi tối", mastered: false },
{ chinese: "今天", pinyin: "jīn tiān", meaning: "Hôm nay", mastered: false },
{ chinese: "明天", pinyin: "míng tiān", meaning: "Ngày mai", mastered: false },
{ chinese: "昨天", pinyin: "zuó tiān", meaning: "Hôm qua", mastered: false }
]
},
{
id: 4,
title: "Bài 4: ",
color: "#3498db",
vocabulary: [
      { chinese: "你是哪国人", pinyin: "S+ shì nǎ guórén?", meaning: "Hỏi đến từ nước nào", example: "S是+  tên quốc gia +人", mastered: false },
      { chinese: "你今年多大", pinyin: "S + jīnnián duōdà？", meaning: "Bạn năm nay bao nhiêu tuổi?", example: "Dùng để hỏi người từ 10 đến 30 tuổi", mastered: false },
      { chinese: "你叫什么名字", pinyin: "S+ jiào shénme míngzì", meaning: "Tên của bạn là gì?", example: "Nǐ gēgē jiào shénme míngzì?", mastered: false },
      { chinese: "百分之二十", pinyin: "Bǎi fēn zhī èrshí", meaning: "Hai mươi phần trăm", example: "Bǎi fēn zhī + số phần %", mastered: false },
      { chinese: "我先回去了", pinyin: "wǒxiān huíqù le", meaning: "Thông báo hành động sắp diễn ra", example: "Chủ ngữ + Trạng từ + Động từ + Trợ từ", mastered: false },
      { chinese: "明天见，下午见", pinyin: "Míngtiān jiàn ，Xiàwǔ jiàn", meaning: "Cách tạm biệt", example: "Thời gian +见jiàn", mastered: false },
      { chinese: "你好，您好，老师好", pinyin: "Nǐ hǎo,nín hǎo,老师好", meaning: "Cách chào hỏi", example: "Chủ ngữ (người, chức vị) + 好 /你好/您好", mastered: false },
      { chinese: "现场", pinyin: "xiànchǎng", meaning: "Hiện trường", example: "这个地方是事故现场", mastered: false },
      { chinese: "岗位", pinyin: "gǎng wèi", meaning: "vị trí, cương vị", example: "他在这个岗位工作了十年", mastered: false },
      { chinese: "确实", pinyin: "què shí", meaning: "thật sự", example: "这次确实是我的错", mastered: false },
      { chinese: "定义", pinyin: "dìng yì", meaning: "định nghĩa", example: "请给出一个明确的定义", mastered: false },
      { chinese: "规律", pinyin: "guī lǜ", meaning: "qui luật", example: "这个问题的规律很复杂", mastered: false }
]
},
{
id: 5,
title: "Bài 5: ",
color: "#3498db",
vocabulary: [
{ chinese: "工作", pinyin: "gōng zuò", meaning: "Công việc" , mastered: false },
{ chinese: "公司", pinyin: "gōng sī", meaning: "Công ty" , mastered: false },
{ chinese: "电脑", pinyin: "diàn nǎo", meaning: "Máy tính" , mastered: false },
{ chinese: "会议", pinyin: "huì yì", meaning: "Cuộc họp" , mastered: false },
{ chinese: "老板", pinyin: "lǎo bǎn", meaning: "Sếp", mastered: false  }
]
},
{
id: 6,
title: "Bài 6: ",
color: "#3498db",
vocabulary: [
{ chinese: "食物", pinyin: "shí wù", meaning: "Thức ăn" , mastered: false },
{ chinese: "米饭", pinyin: "mǐ fàn", meaning: "Cơm", mastered: false  },
{ chinese: "面条", pinyin: "miàn tiáo", meaning: "Mỳ" , mastered: false },
{ chinese: "水", pinyin: "shuǐ", meaning: "Nước" , mastered: false },
{ chinese: "茶", pinyin: "chá", meaning: "Trà", mastered: false  }
]
},
{
id: 7,
title: "Bài 7: ",
color: "#3498db",
vocabulary: [
{ chinese: "商店", pinyin: "shāng diàn", meaning: "Cửa hàng" , mastered: false },
{ chinese: "钱", pinyin: "qián", meaning: "Tiền" , mastered: false },
{ chinese: "买", pinyin: "mǎi", meaning: "Mua" , mastered: false },
{ chinese: "卖", pinyin: "mài", meaning: "Bán" , mastered: false },
{ chinese: "便宜", pinyin: "pián yi", meaning: "Rẻ" , mastered: false }
]
},
{
id: 8,
title: "Bài 8: ",
color: "#3498db",
vocabulary: [
{ chinese: "汽车", pinyin: "qì chē", meaning: "Xe hơi", mastered: false  },
{ chinese: "公共汽车", pinyin: "gōng gòng qì chē", meaning: "Xe buýt" , mastered: false },
{ chinese: "地铁", pinyin: "dì tiě", meaning: "Tàu điện ngầm" , mastered: false },
{ chinese: "自行车", pinyin: "zì xíng chē", meaning: "Xe đạp" , mastered: false },
{ chinese: "飞机", pinyin: "fēi jī", meaning: "Máy bay", mastered: false  }
]
},
{
id: 9,
title: "Bài 9: ",
color: "#3498db",
vocabulary: [
{ chinese: "医院", pinyin: "yī yuàn", meaning: "Bệnh viện" , mastered: false },
{ chinese: "医生", pinyin: "yī shēng", meaning: "Bác sĩ" , mastered: false },
{ chinese: "生病", pinyin: "shēng bìng", meaning: "Ốm", mastered: false  },
{ chinese: "药", pinyin: "yào", meaning: "Thuốc" , mastered: false },
{ chinese: "健康", pinyin: "jiàn kāng", meaning: "Sức khỏe", mastered: false  }
]
},
{
id: 10,
title: "Bài 10: Từ Điển",
color: "#34db6d", 
vocabulary: [
      { chinese: "中国", pinyin: "Zhōngguó", meaning: "Trung Quốc", example: "中国很大 - nước Trung Quốc rất rộng lớn", mastered: false },
      { chinese: "人民", pinyin: "rénmín", meaning: "nhân dân", example: "中国人民很友好 - nhân dân Trung Quốc rất thân thiện", mastered: false },
      { chinese: "工作", pinyin: "gōngzuò", meaning: "công việc", example: "我在银行工作 - tôi làm việc ở ngân hàng", mastered: false },
      { chinese: "他们", pinyin: "tāmen", meaning: "họ", example: "他们是学生 - họ là học sinh", mastered: false },
      { chinese: "我们", pinyin: "wǒmen", meaning: "chúng tôi", example: "我们去吃饭 - chúng tôi đi ăn cơm", mastered: false },
{ chinese: "龚", pinyin: "gōng", meaning: "cung, họ", example: " AI-Dify", mastered: false },
{ chinese: "龟", pinyin: "guī", meaning: "quy, rùa", example: " AI-Dify", mastered: false }

    ]
  },
   {
    id: 11,
    title: "Thanh mẫu",
    vocabulary: [
  { chinese: "b", pinyin: "b", meaning: "bu - bú không bật hơi", mastered: false },
  { chinese: "P +", pinyin: "ph", meaning: "pu - phú bật hơi mạnh", mastered: false },
  { chinese: "m", pinyin: "m", meaning: "mu - mua", mastered: false },
  { chinese: "f", pinyin: "ph", meaning: "fu - phu", mastered: false },
  { chinese: "d -", pinyin: "t", meaning: "de - tưa nhẹ", mastered: false },
  { chinese: "T +", pinyin: "th", meaning: "te - thưa bật hơi", mastered: false },
  { chinese: "n", pinyin: "n", meaning: "ne - nưa", mastered: false },
  { chinese: "l", pinyin: "l", meaning: "le - lưa", mastered: false },
  { chinese: "g", pinyin: "g", meaning: "ge - gưa", mastered: false },
  { chinese: "K +", pinyin: "kh", meaning: "ke - khưa bật hơi", mastered: false },
  { chinese: "h", pinyin: "h", meaning: "he - hưa", mastered: false },
  { chinese: "j -", pinyin: "ch", meaning: "ji - chi nhẹ", mastered: false },
  { chinese: "Q +", pinyin: "ch", meaning: "qi - chi bật hơi", mastered: false },
  { chinese: "x -", pinyin: "x", meaning: "xi - xi nhẹ", mastered: false },
  { chinese: "zh", pinyin: "tr", meaning: "zhi - trư", mastered: false },
  { chinese: "CH +", pinyin: "tr", meaning: "chi - trư bật hơi", mastered: false },
  { chinese: "sh", pinyin: "s", meaning: "shi - sư", mastered: false },
  { chinese: "r", pinyin: "r", meaning: "ri - rư", mastered: false },
  { chinese: "z -", pinyin: "ch", meaning: "zi - chư nhẹ", mastered: false },
  { chinese: "C +", pinyin: "ch", meaning: "ci - chư bật hơi", mastered: false },
  { chinese: "s", pinyin: "x", meaning: "si - xư", mastered: false }

    ]
  },
 {  
    id: 12,
    title: "Phụ mẫu",
    vocabulary: [
  { chinese: "a", pinyin: "a", meaning: "Mở rộng miệng, lưỡi bằng", mastered: false },
  { chinese: "o", pinyin: "ua", meaning: "Môi tròn, âm ngắn", mastered: false },
  { chinese: "e", pinyin: "ưa", meaning: "Lưỡi cong nhẹ", mastered: false },
  { chinese: "i", pinyin: "i", meaning: "Miệng mỉm cười", mastered: false },
  { chinese: "u", pinyin: "u", meaning: "Môi chu ra tròn", mastered: false },
  { chinese: "ü", pinyin: "uy", meaning: "Môi tròn + mỉm cười", mastered: false },
  { chinese: "er", pinyin: "ơ", meaning: "Cong lưỡi, âm uốn", mastered: false },
  { chinese: "ai", pinyin: "ai", meaning: "a -> i nhanh", mastered: false },
  { chinese: "ei", pinyin: "ây", meaning: "e -> i nhẹ", mastered: false },
  { chinese: "ao", pinyin: "ao", meaning: "a -> o tròn", mastered: false },
  { chinese: "ou", pinyin: "âu", meaning: "o -> u", mastered: false },
  { chinese: "an", pinyin: "an", meaning: "a + mũi (ngắn)", mastered: false },
  { chinese: "ang", pinyin: "ang", meaning: "a + mũi gằn (dài)", mastered: false },
  { chinese: "en", pinyin: "ân", meaning: "ưa + mũi", mastered: false },
  { chinese: "eng", pinyin: "âng", meaning: "ưa + mũi gằn", mastered: false },
  { chinese: "ong", pinyin: "ung", meaning: "u + mũi gằn", mastered: false },
  { chinese: "ia", pinyin: "ia", meaning: "Chuyển nhanh", mastered: false },
  { chinese: "ie", pinyin: "iê", meaning: "Miệng bẹt", mastered: false },
  { chinese: "iao", pinyin: "ieo", meaning: "3 âm nối", mastered: false },
  { chinese: "iou", pinyin: "iu", meaning: "Rút gọn thành 'iu'", mastered: false },
  { chinese: "ian", pinyin: "ien", meaning: "Ghép mũi", mastered: false },
  { chinese: "in", pinyin: "in", meaning: "i + mũi ngắn", mastered: false },
  { chinese: "iang", pinyin: "ieng", meaning: "Mũi gằn dài", mastered: false },
  { chinese: "ing", pinyin: "ing", meaning: "i + mũi gằn", mastered: false },
  { chinese: "iong", pinyin: "iung", meaning: "Môi tròn", mastered: false },
  { chinese: "ua", pinyin: "oa", meaning: "Môi chu", mastered: false },
  { chinese: "uo", pinyin: "ua", meaning: "Như 'qua'", mastered: false },
  { chinese: "uai", pinyin: "uai", meaning: "3 âm nối", mastered: false },
  { chinese: "uei", pinyin: "uây", meaning: "Rút gọn thành 'ui'", mastered: false },
  { chinese: "uan", pinyin: "oan", meaning: "Mũi ngắn", mastered: false },
  { chinese: "uang", pinyin: "oang", meaning: "Mũi gằn dài", mastered: false },
  { chinese: "uen", pinyin: "uân", meaning: "Rút gọn thành 'un'", mastered: false },
  { chinese: "ueng", pinyin: "uâng", meaning: "Dùng độc lập", mastered: false },
  { chinese: "üe", pinyin: "uyê", meaning: "Môi tròn + bẹt", mastered: false },
  { chinese: "üan", pinyin: "uyan", meaning: "Chú ý khẩu hình", mastered: false },
  { chinese: "ün", pinyin: "uyn", meaning: "Mũi + môi tròn", mastered: false } 

    ]
  },
  {
    id: 13,
    title: "Bộ Thủ",
    vocabulary: [
{ chinese: "一", pinyin: "yī", meaning: "Nhất", example: "Số một, duy nhất", mastered: false },
{ chinese: "丨", pinyin: "gǔn", meaning: "Cổn", example: "Nét sổ thẳng", mastered: false },
{ chinese: "丶", pinyin: "zhǔ", meaning: "Chủ", example: "Dấu chấm", mastered: false },
{ chinese: "丿", pinyin: "piě", meaning: "Phiệt", example: "Nét phẩy, xiên trái", mastered: false },
{ chinese: "乙", pinyin: "yǐ", meaning: "Ất", example: "Vị trí thứ hai", mastered: false },
{ chinese: "亅", pinyin: "jué", meaning: "Quyết", example: "Nét móc", mastered: false },
{ chinese: "二", pinyin: "èr", meaning: "Nhị", example: "Số hai", mastered: false },
{ chinese: "亠", pinyin: "tóu", meaning: "Đầu", example: "Phần trên đầu", mastered: false },
{ chinese: "人", pinyin: "rén", meaning: "Nhân", example: "Người", mastered: false },
{ chinese: "亻", pinyin: "rén", meaning: "Nhân", example: "Bộ nhân đứng", mastered: false },
{ chinese: "儿", pinyin: "ér", meaning: "Nhi", example: "Trẻ con, chân người", mastered: false },
{ chinese: "入", pinyin: "rù", meaning: "Nhập", example: "Vào, đi vào", mastered: false },
{ chinese: "八", pinyin: "bā", meaning: "Bát", example: "Số tám, chia tách", mastered: false },
{ chinese: "冂", pinyin: "jiōng", meaning: "Quynh", example: "Vùng biên giới xa", mastered: false },
{ chinese: "冖", pinyin: "mì", meaning: "Mịch", example: "Trùm lên, khăn che", mastered: false },
{ chinese: "冫", pinyin: "bīng", meaning: "Băng", example: "Nước đá, lạnh lẽo", mastered: false },
{ chinese: "几", pinyin: "jǐ", meaning: "Kỷ", example: "Cái ghế dựa, bàn nhỏ", mastered: false },
{ chinese: "凵", pinyin: "kǎn", meaning: "Khảm", example: "Vùng đất lõm", mastered: false },
{ chinese: "刀", pinyin: "dāo", meaning: "Đao", example: "Con dao, vũ khí", mastered: false },
{ chinese: "刂", pinyin: "dāo", meaning: "Đao", example: "Bộ đao đứng", mastered: false },
{ chinese: "力", pinyin: "lì", meaning: "Lực", example: "Sức mạnh", mastered: false },
{ chinese: "勹", pinyin: "bāo", meaning: "Bao", example: "Bao bọc, ôm lấy", mastered: false },
{ chinese: "匕", pinyin: "bǐ", meaning: "Chủy", example: "Cái thìa, muỗng", mastered: false },
{ chinese: "匚", pinyin: "fāng", meaning: "Phương", example: "Đồ đựng hình vuông", mastered: false },
{ chinese: "十", pinyin: "shí", meaning: "Thập", example: "Số mười", mastered: false },
{ chinese: "卜", pinyin: "bǔ", meaning: "Bốc", example: "Xem bói", mastered: false },
{ chinese: "卩", pinyin: "jié", meaning: "Tiết", example: "Đốt tre, khớp xương", mastered: false },
{ chinese: "厂", pinyin: "chǎng", meaning: "Hán", example: "Sườn núi, vách đá", mastered: false },
{ chinese: "厶", pinyin: "sī", meaning: "Khứ", example: "Riêng tư", mastered: false },
{ chinese: "又", pinyin: "yòu", meaning: "Hựu", example: "Lại nữa, bàn tay", mastered: false },
{ chinese: "口", pinyin: "kǒu", meaning: "Khẩu", example: "Cái miệng", mastered: false },
{ chinese: "囗", pinyin: "wéi", meaning: "Vi", example: "Vây quanh, bao quanh", mastered: false },
{ chinese: "土", pinyin: "tǔ", meaning: "Thổ", example: "Đất đai", mastered: false },
{ chinese: "士", pinyin: "shì", meaning: "Sĩ", example: "Kẻ sĩ, quan lại", mastered: false },
{ chinese: "夂", pinyin: "zhǐ", meaning: "Truy", example: "Đến sau, đi chậm", mastered: false },
{ chinese: "夕", pinyin: "xī", meaning: "Tịch", example: "Đêm tối, buổi chiều", mastered: false },
{ chinese: "大", pinyin: "dà", meaning: "Đại", example: "To lớn", mastered: false },
{ chinese: "女", pinyin: "nǚ", meaning: "Nữ", example: "Phụ nữ, con gái", mastered: false },
{ chinese: "子", pinyin: "zǐ", meaning: "Tử", example: "Con cái, đứa trẻ", mastered: false },
{ chinese: "宀", pinyin: "mián", meaning: "Miên", example: "Mái nhà", mastered: false },
{ chinese: "寸", pinyin: "cùn", meaning: "Thốn", example: "Đơn vị đo (tấc)", mastered: false },
{ chinese: "小", pinyin: "xiǎo", meaning: "Tiểu", example: "Nhỏ bé", mastered: false },
{ chinese: "尸", pinyin: "shī", meaning: "Thi", example: "Xác chết, thây ma", mastered: false },
{ chinese: "山", pinyin: "shān", meaning: "Sơn", example: "Núi non", mastered: false },
{ chinese: "川", pinyin: "chuān", meaning: "Xuyên", example: "Sông ngòi", mastered: false },
{ chinese: "工", pinyin: "gōng", meaning: "Công", example: "Công việc, thợ thủ công", mastered: false },
{ chinese: "己", pinyin: "jǐ", meaning: "Kỷ", example: "Bản thân mình", mastered: false },
{ chinese: "巾", pinyin: "jīn", meaning: "Cân", example: "Cái khăn, vải vóc", mastered: false },
{ chinese: "干", pinyin: "gān", meaning: "Can", example: "Cái lá chắn, khô ráo", mastered: false },
{ chinese: "广", pinyin: "guǎng", meaning: "Quảng", example: "Mái nhà rộng lớn", mastered: false },
{ chinese: "弓", pinyin: "gōng", meaning: "Cung", example: "Cái cung tên", mastered: false },
{ chinese: "彳", pinyin: "chì", meaning: "Xích", example: "Bước chân trái, đi bộ chậm", mastered: false },
{ chinese: "心", pinyin: "xīn", meaning: "Tâm", example: "Trái tim, tâm trí", mastered: false },
{ chinese: "忄", pinyin: "xīn", meaning: "Tâm", example: "Bộ tâm đứng", mastered: false },
{ chinese: "戈", pinyin: "gē", meaning: "Qua", example: "Cái mác (vũ khí cổ)", mastered: false },
{ chinese: "户", pinyin: "hù", meaning: "Hộ", example: "Cửa một cánh, hộ gia đình", mastered: false },
{ chinese: "手", pinyin: "shǒu", meaning: "Thủ", example: "Cái tay", mastered: false },
{ chinese: "扌", pinyin: "shǒu", meaning: "Thủ", example: "Bộ thủ (tay)", mastered: false },
{ chinese: "支", pinyin: "zhī", meaning: "Chi", example: "Cành cây, chi nhánh", mastered: false },
{ chinese: "攵", pinyin: "pū", meaning: "Phác", example: "Đánh nhẹ, gõ nhẹ", mastered: false },
{ chinese: "文", pinyin: "wén", meaning: "Văn", example: "Văn chương, chữ nghĩa", mastered: false },
{ chinese: "斤", pinyin: "jīn", meaning: "Cân", example: "Cái rìu, cân nặng", mastered: false },
{ chinese: "方", pinyin: "fāng", meaning: "Phương", example: "Hình vuông, phương hướng", mastered: false },
{ chinese: "日", pinyin: "rì", meaning: "Nhật", example: "Mặt trời, ngày", mastered: false },
{ chinese: "曰", pinyin: "yuē", meaning: "Viết", example: "Nói rằng", mastered: false },
{ chinese: "月", pinyin: "yuè", meaning: "Nguyệt", example: "Mặt trăng, tháng", mastered: false },
{ chinese: "木", pinyin: "mù", meaning: "Mộc", example: "Cây cối, gỗ", mastered: false },
{ chinese: "欠", pinyin: "qiàn", meaning: "Khiếm", example: "Thiếu thốn, ngáp", mastered: false },
{ chinese: "止", pinyin: "zhǐ", meaning: "Chỉ", example: "Dừng lại, bàn chân", mastered: false },
{ chinese: "歹", pinyin: "dǎi", meaning: "Đãi", example: "Xấu xa, cái chết", mastered: false },
{ chinese: "殳", pinyin: "shū", meaning: "Thù", example: "Binh khí dài", mastered: false },
{ chinese: "比", pinyin: "bǐ", meaning: "Tỷ", example: "So sánh", mastered: false },
{ chinese: "毛", pinyin: "máo", meaning: "Mao", example: "Lông thú, tóc", mastered: false },
{ chinese: "氏", pinyin: "shì", meaning: "Thị", example: "Họ, dòng tộc", mastered: false },
{ chinese: "气", pinyin: "qì", meaning: "Khí", example: "Hơi nước, không khí", mastered: false },
{ chinese: "水", pinyin: "shuǐ", meaning: "Thủy", example: "Nước", mastered: false },
{ chinese: "氵", pinyin: "shuǐ", meaning: "Thủy", example: "Nước", mastered: false },
{ chinese: "火", pinyin: "huǒ", meaning: "Hỏa", example: "Lửa", mastered: false },
{ chinese: "灬", pinyin: "huǒ", meaning: "Hỏa", example: "Lửa", mastered: false },
{ chinese: "父", pinyin: "fù", meaning: "Phụ", example: "Cha, người bề trên", mastered: false },
{ chinese: "牛", pinyin: "niú", meaning: "Ngưu", example: "Con trâu, bò", mastered: false },
{ chinese: "牜", pinyin: "niú", meaning: "Ngưu", example: "Con trâu, bò", mastered: false },
{ chinese: "犬", pinyin: "quǎn", meaning: "Khuyển", example: "Con chó", mastered: false },
{ chinese: "犭", pinyin: "quǎn", meaning: "Khuyển", example: "Con chó", mastered: false },
{ chinese: "玉", pinyin: "yù", meaning: "Ngọc", example: "Viên ngọc", mastered: false },
{ chinese: "王", pinyin: "yù", meaning: "Vương", example: "Bộ vương (Ngọc)", mastered: false },
{ chinese: "甘", pinyin: "gān", meaning: "Cam", example: "Vị ngọt", mastered: false },
{ chinese: "生", pinyin: "shēng", meaning: "Sinh", example: "Sinh đẻ, sống", mastered: false },
{ chinese: "田", pinyin: "tián", meaning: "Điền", example: "Ruộng đất", mastered: false },
{ chinese: "疒", pinyin: "nè", meaning: "Nạch", example: "Bệnh tật, đau ốm", mastered: false },
{ chinese: "白", pinyin: "bái", meaning: "Bạch", example: "Màu trắng", mastered: false },
{ chinese: "皮", pinyin: "pí", meaning: "Bì", example: "Da, vỏ ngoài", mastered: false },
{ chinese: "皿", pinyin: "mǐn", meaning: "Mãnh", example: "Bát đĩa, đồ đựng", mastered: false },
{ chinese: "目", pinyin: "mù", meaning: "Mục", example: "Con mắt, nhìn", mastered: false },
{ chinese: "石", pinyin: "shí", meaning: "Thạch", example: "Đá, sỏi", mastered: false },
{ chinese: "示", pinyin: "shì", meaning: "Thị", example: "Thần linh, thờ cúng", mastered: false },
{ chinese: "礻", pinyin: "shì", meaning: "Thị", example: "Bộ thị (thần linh)", mastered: false },
{ chinese: "禾", pinyin: "hé", meaning: "Hòa", example: "Lúa, cây lương thực", mastered: false },
{ chinese: "穴", pinyin: "xué", meaning: "Huyệt", example: "Hang động, lỗ hổng", mastered: false },
{ chinese: "立", pinyin: "lì", meaning: "Lập", example: "Đứng thẳng, thiết lập", mastered: false },
{ chinese: "⻌", pinyin: "yì", meaning: "Ấp", example: "Bộ ấp (biến thể)", mastered: false },
{ chinese: "酉", pinyin: "yǒu", meaning: "Dậu", example: "Rượu, chi Dậu", mastered: false },
{ chinese: "采", pinyin: "cǎi", meaning: "Thái", example: "Hái, lựa chọn", mastered: false },
{ chinese: "里", pinyin: "lǐ", meaning: "Lý", example: "Dặm, làng xóm", mastered: false },
{ chinese: "金", pinyin: "jīn", meaning: "Kim", example: "Kim loại, vàng", mastered: false },
{ chinese: "钅", pinyin: "jīn", meaning: "Kim", example: "Kim loại, vàng (biến thể)", mastered: false },
{ chinese: "長", pinyin: "cháng", meaning: "Trường", example: "Dài, lớn (phồn thể)", mastered: false },
{ chinese: "长", pinyin: "cháng", meaning: "Trường", example: "Dài, lớn ", mastered: false },
{ chinese: "門", pinyin: "mén", meaning: "Môn", example: "Cửa (phồn thể)", mastered: false },
{ chinese: "门", pinyin: "mén", meaning: "Môn", example: "Cửa", mastered: false },
{ chinese: "阜", pinyin: "fù", meaning: "Phụ", example: "Gò đất", mastered: false },
{ chinese: "⻖", pinyin: "fù", meaning: "Phụ", example: "Gò đất (biến thể)", mastered: false },
{ chinese: "辶", pinyin: "chuò", meaning: "Sước", example: "Bộ quai xước", mastered: false },
{ chinese: "⻍", pinyin: "zǒu", meaning: "Tẩu", example: "Biến thể bộ tẩu", mastered: false },
{ chinese: "豕", pinyin: "shǐ", meaning: "Thỉ", example: "Con lợn", mastered: false },
{ chinese: "足", pinyin: "zú", meaning: "Túc", example: "Cái chân", mastered: false },
{ chinese: "见", pinyin: "jiàn", meaning: "Kiến", example: "Nhìn thấy", mastered: false },
{ chinese: "行", pinyin: "xíng", meaning: "Hành", example: "Đi, thi hành, hàng lối", mastered: false },
{ chinese: "艹", pinyin: "cǎo", meaning: "Thảo", example: "Cỏ (biến thể)", mastered: false },
{ chinese: "艸", pinyin: "cǎo", meaning: "Thảo", example: "Cây cỏ", mastered: false },
{ chinese: "马", pinyin: "mǎ", meaning: "Mã", example: "Con ngựa ", mastered: false },
{ chinese: "用", pinyin: "yòng", meaning: "Dụng", example: "Dùng, sử dụng", mastered: false },
{ chinese: "饣", pinyin: "shí", meaning: "Thực", example: "Biến thể bộ thực", mastered: false },
{ chinese: "隶", pinyin: "lì", meaning: "Lệ", example: "Kịp đến, nô lệ", mastered: false },
{ chinese: "隹", pinyin: "zhuī", meaning: "Chuy", example: "Chim đuôi ngắn", mastered: false },
{ chinese: "雨", pinyin: "yǔ", meaning: "Vũ", example: "Mưa", mastered: false },
{ chinese: "⻗", pinyin: "yǔ", meaning: "Vũ", example: "Biến thể bộ vũ", mastered: true },
{ chinese: "靑", pinyin: "qīng", meaning: "Thanh", example: "Màu xanh lục", mastered: true },
{ chinese: "青", pinyin: "qīng", meaning: "Thanh", example: "Biến thể bộ thanh", mastered: true },
{ chinese: "非", pinyin: "fēi", meaning: "Phi", example: "Không phải, sai trái", mastered: true },
{ chinese: "面", pinyin: "miàn", meaning: "Diện", example: "Mặt, bề mặt", mastered: true },
{ chinese: "革", pinyin: "gé", meaning: "Cách", example: "Da thú, thay đổi", mastered: true },
{ chinese: "韋", pinyin: "wéi", meaning: "Vi", example: "Da thuộc (phồn thể)", mastered: true },
{ chinese: "韦", pinyin: "wéi", meaning: "Vi", example: "Da thuộc", mastered: true },
{ chinese: "韭", pinyin: "jiǔ", meaning: "Cửu", example: "Rau hẹ", mastered: true },
{ chinese: "音", pinyin: "yīn", meaning: "Âm", example: "Âm thanh", mastered: true },
{ chinese: "頁", pinyin: "yè", meaning: "Hiệt", example: "Trang giấy, cái đầu (phồn thể)", mastered: true },
{ chinese: "页", pinyin: "yè", meaning: "Hiệt", example: "Trang giấy", mastered: true },
{ chinese: "風", pinyin: "fēng", meaning: "Phong", example: "Gió (phồn thể)", mastered: true },
{ chinese: "风", pinyin: "fēng", meaning: "Phong", example: "Gió", mastered: true },
{ chinese: "飛", pinyin: "fēi", meaning: "Phi", example: "Bay (phồn thể)", mastered: true },
{ chinese: "飞", pinyin: "fēi", meaning: "Phi", example: "Bay", mastered: true },
{ chinese: "食", pinyin: "shí", meaning: "Thực", example: "Ăn, đồ ăn", mastered: true },
{ chinese: "飠", pinyin: "shí", meaning: "Thực", example: "Ăn, đồ ăn (Biến thể)", mastered: true },
{ chinese: "首", pinyin: "shǒu", meaning: "Thủ", example: "Cái đầu", mastered: true },
{ chinese: "香", pinyin: "xiāng", meaning: "Hương", example: "Mùi thơm", mastered: true },
{ chinese: "馬", pinyin: "mǎ", meaning: "Mã", example: "Con ngựa (phồn thể)", mastered: true },
{ chinese: "骨", pinyin: "gǔ", meaning: "Cốt", example: "Xương", mastered: true },
{ chinese: "高", pinyin: "gāo", meaning: "Cao", example: "Cao lớn", mastered: true },
{ chinese: "髟", pinyin: "biāo", meaning: "Tiêu", example: "Tóc dài", mastered: true },
{ chinese: "鬥", pinyin: "dòu", meaning: "Đấu", example: "Chiến đấu", mastered: true },
{ chinese: "鬯", pinyin: "chàng", meaning: "Sướng", example: "Rượu tế thần", mastered: true },
{ chinese: "鬲", pinyin: "lì", meaning: "Cách", example: "Cái nồi cổ", mastered: true },
{ chinese: "鬼", pinyin: "guǐ", meaning: "Quỷ", example: "Ma quỷ", mastered: true },
{ chinese: "魚", pinyin: "yú", meaning: "Ngư", example: "Con cá (phồn thể)", mastered: true },
{ chinese: "鱼", pinyin: "yú", meaning: "Ngư", example: "Con cá ", mastered: true },
{ chinese: "鳥", pinyin: "niǎo", meaning: "Điểu", example: "Con chim (phồn thể)", mastered: true },
{ chinese: "鸟", pinyin: "niǎo", meaning: "Điểu", example: "Con chim ", mastered: true },
{ chinese: "鹵", pinyin: "lǔ", meaning: "Lỗ", example: "Đất mặn, muối", mastered: true },
{ chinese: "鹿", pinyin: "lù", meaning: "Lộc", example: "Con hươu", mastered: true },
{ chinese: "麥", pinyin: "mài", meaning: "Mạch", example: "Lúa mạch (phồn thể)", mastered: true },
{ chinese: "麦", pinyin: "mài", meaning: "Mạch", example: "Lúa mạch ", mastered: true },
{ chinese: "麻", pinyin: "má", meaning: "Ma", example: "Cây gai, tê liệt", mastered: true },
{ chinese: "黃", pinyin: "huáng", meaning: "Hoàng", example: "Màu vàng", mastered: true },
{ chinese: "黍", pinyin: "shǔ", meaning: "Thử", example: "Lúa nếp", mastered: true },
{ chinese: "黑", pinyin: "hēi", meaning: "Hắc", example: "Màu đen", mastered: true },
{ chinese: "黹", pinyin: "zhǐ", meaning: "Chỉ", example: "May vá, thêu thùa", mastered: true },
{ chinese: "黽", pinyin: "mǐn", meaning: "Mãnh", example: "Con ếch, cố gắng", mastered: true },
{ chinese: "鼎", pinyin: "dǐng", meaning: "Đỉnh", example: "Cái đỉnh", mastered: true },
{ chinese: "鼓", pinyin: "gǔ", meaning: "Cổ", example: "Cái trống", mastered: true },
{ chinese: "鼠", pinyin: "shǔ", meaning: "Thử", example: "Con chuột", mastered: true },
{ chinese: "鼻", pinyin: "bí", meaning: "Tị", example: "Cái mũi", mastered: true },
{ chinese: "齊", pinyin: "qí", meaning: "Tề", example: "Ngang bằng (phồn thể)", mastered: true },
{ chinese: "齐", pinyin: "qí", meaning: "Tề", example: "Ngang bằng", mastered: true },
{ chinese: "齒", pinyin: "chǐ", meaning: "Xỉ", example: "Răng (phồn thể)", mastered: true },
{ chinese: "齿", pinyin: "chǐ", meaning: "Xỉ", example: "Răng", mastered: true },
{ chinese: "龍", pinyin: "lóng", meaning: "Long", example: "Con rồng (phồn thể)", mastered: true },
{ chinese: "龙", pinyin: "lóng", meaning: "Long", example: "Con rồng ", mastered: true },
{ chinese: "龜", pinyin: "guī", meaning: "Quy", example: "Con rùa (phồn thể)", mastered: true },
{ chinese: "龟", pinyin: "guī", meaning: "Quy", example: "Con rùa ", mastered: true },
{ chinese: "龠", pinyin: "yuè", meaning: "Dược", example: "Sáo trúc", mastered: true },
{ chinese: "疋", pinyin: "pǐ", meaning: "Sơ", example: "Đơn vị đo vải, cái chân", mastered: true },
{ chinese: "⺪", pinyin: "pǐ", meaning: "Sơ", example: "Biến thể của bộ sơ (chân)", mastered: true },
{ chinese: "癶", pinyin: "bō", meaning: "Bát", example: "Gạt ra, dẫm lên", mastered: true },
{ chinese: "⺫", pinyin: "mù", meaning: "Mục", example: "Con mắt,nhìn (Biến thể)", mastered: true },
{ chinese: "矛", pinyin: "máo", meaning: "Mâu", example: "Cái mâu (vũ khí)", mastered: true },
{ chinese: "矢", pinyin: "shǐ", meaning: "Thỉ", example: "Mũi tên", mastered: true },
{ chinese: "禸", pinyin: "róu", meaning: "Nhựu", example: "Vết chân thú vật", mastered: true },
{ chinese: "竹", pinyin: "zhú", meaning: "Trúc", example: "Cây tre, trúc", mastered: true },
{ chinese: "⺮", pinyin: "zhú", meaning: "Trúc", example: "Cây tre, trúc (Biến thể)", mastered: true },
{ chinese: "米", pinyin: "mǐ", meaning: "Mễ", example: "Gạo, hạt nhỏ", mastered: true },
{ chinese: "糸", pinyin: "mì", meaning: "Mịch", example: "Sợi tơ, dây nhợ", mastered: true },
{ chinese: "纟", pinyin: "sī", meaning: "Mịch", example: "Sợi tơ, dây nhợ", mastered: true },
{ chinese: "缶", pinyin: "fǒu", meaning: "Phẫu", example: "Đồ sành sứ, bình nước", mastered: true },
{ chinese: "羊", pinyin: "yáng", meaning: "Dương", example: "Con dê", mastered: true },
{ chinese: "⺷", pinyin: "yáng", meaning: "Dương", example: "Con dê (Biến thể)", mastered: true },
{ chinese: "羽", pinyin: "yǔ", meaning: "Vũ", example: "Lông vũ, cánh chim", mastered: true },
{ chinese: "老", pinyin: "lǎo", meaning: "Lão", example: "Người già", mastered: true },
{ chinese: "耂", pinyin: "lǎo", meaning: "Lão", example: "Biến thể bộ lão", mastered: true },
{ chinese: "耳", pinyin: "ěr", meaning: "Nhĩ", example: "Cái tai, nghe", mastered: true },
{ chinese: "自", pinyin: "zì", meaning: "Tự", example: "Tự bản thân, cái mũi", mastered: true },
{ chinese: "舌", pinyin: "shé", meaning: "Thiệt", example: "Cái lưỡi", mastered: true },
{ chinese: "舛", pinyin: "chuǎn", meaning: "Suyễn", example: "Sai lầm, trái ngược", mastered: true },
{ chinese: "舟", pinyin: "zhōu", meaning: "Chu", example: "Cái thuyền", mastered: true },
{ chinese: "艮", pinyin: "gèn", meaning: "Cấn", example: "Bền cứng, dừng lại", mastered: true },
{ chinese: "色", pinyin: "sè", meaning: "Sắc", example: "Màu sắc, dáng vẻ", mastered: true },
{ chinese: "虍", pinyin: "hū", meaning: "Hổ", example: "Vằn vện của con hổ", mastered: true },
{ chinese: "虫", pinyin: "chóng", meaning: "Trùng", example: "Sâu bọ, côn trùng", mastered: true },
{ chinese: "血", pinyin: "xuè", meaning: "Huyết", example: "Máu", mastered: true },
{ chinese: "衣", pinyin: "yī", meaning: "Y", example: "Quần áo", mastered: true },
{ chinese: "衤", pinyin: "yī", meaning: "Y", example: "Biến thể bộ y (quần áo)", mastered: true },
{ chinese: "襾", pinyin: "yà", meaning: "Á", example: "Che đậy", mastered: true },
{ chinese: "覀", pinyin: "yà", meaning: "Á", example: "Che đậy (Biến thể)", mastered: true },
{ chinese: "見", pinyin: "jiàn", meaning: "Kiến", example: "Nhìn thấy (phồn thể)", mastered: true },
{ chinese: "角", pinyin: "jiǎo", meaning: "Giác", example: "Sừng thú, góc", mastered: true },
{ chinese: "言", pinyin: "yán", meaning: "Ngôn", example: "Nói, lời nói", mastered: true },
{ chinese: "讠", pinyin: "yán", meaning: "Ngôn", example: "Bộ ngôn giản thể", mastered: true },
{ chinese: "谷", pinyin: "gǔ", meaning: "Cốc", example: "Khe núi, thung lũng", mastered: true },
{ chinese: "豆", pinyin: "dòu", meaning: "Đậu", example: "Hạt đậu, đồ đựng", mastered: true },
{ chinese: "豸", pinyin: "zhì", meaning: "Trĩ", example: "Loài muông thú không sừng", mastered: true },
{ chinese: "貝", pinyin: "bèi", meaning: "Bối", example: "Vỏ ốc, quý báu (phồn thể)", mastered: true },
{ chinese: "贝", pinyin: "bèi", meaning: "Bối", example: "Vỏ ốc, tiền tệ ", mastered: true },
{ chinese: "赤", pinyin: "chì", meaning: "Xích", example: "Màu đỏ", mastered: true },
{ chinese: "走", pinyin: "zǒu", meaning: "Tẩu", example: "Đi, chạy", mastered: true },
{ chinese: "⻊", pinyin: "zú", meaning: "Túc", example: "Biến thể bộ túc (chân)", mastered: true },
{ chinese: "身", pinyin: "shēn", meaning: "Thân", example: "Thân thể, mình", mastered: true },
{ chinese: "車", pinyin: "chē", meaning: "Xa", example: "Xe cộ (phồn thể)", mastered: true },
{ chinese: "车", pinyin: "chē", meaning: "Xa", example: "Xe cộ ", mastered: true },
{ chinese: "辛", pinyin: "xīn", meaning: "Tân", example: "Cay, vất vả", mastered: true },
{ chinese: "辰", pinyin: "chén", meaning: "Thần", example: "Nhật, nguyệt, tinh tú", mastered: true },
{ chinese: "辵", pinyin: "chuò", meaning: "Sước", example: "Chợt đi chợt dừng", mastered: true },
{ chinese: "邑", pinyin: "yì", meaning: "Ấp", example: "Vùng đất, kinh đô", mastered: true },



    ]
  },
{
  id: 14,
  title: "Phân tích Bộ thủ",
  vocabulary: [
   { chinese: "的", pinyin: "de", meaning: "白,勺", mastered: true },
{ chinese: "一", pinyin: "yī", meaning: "一", mastered: true },
{ chinese: "龚", pinyin: "gōng", meaning: "龙,共", mastered: true },
{ chinese: "龟", pinyin: "guī", meaning: "龟,丶", mastered: true }
  ]
}
];

let hideTimeout;
let inputAreaHeight = 30;
let showRadicalAnalysis = true;
// HÀM MỚI: Xuất toàn bộ từ điển các bài học
let isSoundOn = true; // Mặc định bật âm thanh
let preSpeak = true; // Phát trước khi nhập
let postSpeak = false;
let isSpeaking = false;
let selectedVoice = null;
let speechRate = 0.8;
let speechPitch = 1;
let showRewardMessage = true;
let showFirework = true;
let listenWriteMode = false; // mặc định tắt

function colorizePinyin(pinyinStr) {
    if (!pinyinStr) return '';
    
    // Regex hỗ trợ phụ âm ghép zh, ch, sh và âm cuối n, ng, r
    const syllableRegex = /(?:zh|ch|sh|[bpmfdtnlgkhjqxzcsryw])?[aāáǎàeēéěèiīíǐìoōóǒòuūúǔùüǖǘǚǜ]+(?:ng?|r?)?/gi;
    const syllables = pinyinStr.match(syllableRegex);
    
    if (!syllables) return pinyinStr; // fallback
    
    let result = '';
    syllables.forEach(syl => {
        let tone = 5; // mặc định thanh nhẹ
        const toneChar = syl.match(/[āáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜ]/);
        if (toneChar) {
            const char = toneChar[0];
            if ('āēīōūǖ'.includes(char)) tone = 1;
            else if ('áéíóúǘ'.includes(char)) tone = 2;
            else if ('ǎěǐǒǔǚ'.includes(char)) tone = 3;
            else if ('àèìòùǜ'.includes(char)) tone = 4;
        }
        result += `<span class="tone${tone}">${syl}</span> `;
    });
    return result.trim();
}

function loadVoices() {
    const voices = window.speechSynthesis.getVoices();
    const voiceSelect = document.getElementById('voiceSelect');
    
    if (!voiceSelect) {
        console.error('Không tìm thấy phần tử voiceSelect');
        return;
    }
    
    // Xóa các tùy chọn cũ
    voiceSelect.innerHTML = '';
    
    // Thêm tùy chọn mặc định
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Chọn giọng mặc định';
    voiceSelect.appendChild(defaultOption);
    
    // Lọc và thêm giọng tiếng Trung - SỬA LẠI CÁCH LỌC
    const chineseVoices = voices.filter(voice => {
        // Mở rộng điều kiện lọc để bao gồm cả simplified và traditional
        return voice.lang.includes('zh') || 
               voice.lang.includes('cn') ||
               voice.lang.includes('zh-CN') ||
               voice.lang.includes('zh-TW') ||
               voice.name.toLowerCase().includes('chinese') ||
               voice.name.toLowerCase().includes('mandarin') ||
               voice.name.toLowerCase().includes('chinese');
    });
    
    console.log('Tìm thấy giọng tiếng Trung:', chineseVoices.length);
    chineseVoices.forEach(voice => {
        console.log(`- ${voice.name} (${voice.lang}) - URI: ${voice.voiceURI}`);
    });
    
    // Sử dụng voiceURI thay vì index
    chineseVoices.forEach((voice) => {
        const option = document.createElement('option');
        option.value = voice.voiceURI; // QUAN TRỌNG: dùng voiceURI
        option.textContent = `${voice.name} (${voice.lang})`;
        option.setAttribute('data-lang', voice.lang);
        voiceSelect.appendChild(option);
    });
    
    if (chineseVoices.length === 0) {
        const noVoiceOption = document.createElement('option');
        noVoiceOption.value = '';
        noVoiceOption.textContent = 'Không tìm thấy giọng tiếng Trung';
        voiceSelect.appendChild(noVoiceOption);
        
        // Hiển thị tất cả giọng có sẵn để debug
        console.log('Tất cả giọng có sẵn:');
        voices.forEach(voice => {
            console.log(`- ${voice.name} (${voice.lang}) - URI: ${voice.voiceURI}`);
        });
    }
    
    // Khôi phục giọng đã chọn từ localStorage
    const savedVoiceURI = localStorage.getItem('selectedVoiceURI');
    if (savedVoiceURI) {
        const savedVoice = voices.find(v => v.voiceURI === savedVoiceURI);
        if (savedVoice) {
            voiceSelect.value = savedVoiceURI;
            selectedVoice = savedVoice;
            console.log('Đã khôi phục giọng:', savedVoice.name);
        }
    }
    window.speechSynthesis.onvoiceschanged = null;
}
// THÊM HÀM ƯỚC LƯỢNG THỜI GIAN PHÁT ÂM
function estimateSpeechDuration(text, rate = 1) {
    // Ước lượng: mỗi ký tự mất ~0.15s ở tốc độ bình thường
    const baseDuration = text.length * 0.44;
    return Math.max(baseDuration / rate, 0.5); // Tối thiểu 0.5s
}

let speechQueue = Promise.resolve();
let earlyHideTimer = null;
function speak(text, force = false) {
    if (!force && !isSoundOn) return;

    window.speechSynthesis.cancel();
    if (earlyHideTimer) clearTimeout(earlyHideTimer);

    const msg = new SpeechSynthesisUtterance(text);
    const voices = window.speechSynthesis.getVoices();

    // --- Chọn giọng (giữ nguyên) ---
    let voiceFound = false;
    if (selectedVoice) {
        const currentVoice = voices.find(v => v.voiceURI === selectedVoice.voiceURI);
        if (currentVoice) {
            msg.voice = currentVoice;
            msg.lang = currentVoice.lang;
            voiceFound = true;
        }
    }
    if (!voiceFound) {
        const chineseVoice = voices.find(v => 
            v.lang.includes('zh') || v.lang.includes('cn') ||
            v.lang.includes('zh-CN') || v.lang.includes('zh-TW')
        );
        if (chineseVoice) {
            msg.voice = chineseVoice;
            msg.lang = chineseVoice.lang;
        }
    }

    msg.rate = speechRate;
    msg.pitch = speechPitch;

    // --- Sự kiện ---
msg.onstart = () => {
    isSpeaking = true;
    showVisualizer();

    const duration = estimateSpeechDuration(text, speechRate);
    const minVisibleTime = 1; // tối thiểu 0.6 giây
    const visibleDuration = Math.max(duration, minVisibleTime);
    const transitionTime = 0.4;
    let hideTime = (visibleDuration - transitionTime) * 1000;
    if (hideTime < 0) hideTime = 0;

    clearTimeout(earlyHideTimer);
    earlyHideTimer = setTimeout(() => {
        if (isSpeaking) {
            hideVisualizer();
        }
    }, hideTime);
};
    msg.onend = () => {
        clearTimeout(earlyHideTimer);
        isSpeaking = false;
        // Đảm bảo ẩn nếu chưa kịp ẩn
        hideVisualizer();
    };

    msg.onerror = (event) => {
        clearTimeout(earlyHideTimer);
        isSpeaking = false;
        hideVisualizer();
        console.error('Lỗi phát âm:', event);
    };

    window.speechSynthesis.speak(msg);
}

function showVisualizer() {
    const el = document.getElementById('audio-visualizer');
    if (el) el.classList.add('visible');
}

function hideVisualizer() {
    const el = document.getElementById('audio-visualizer');
    if (el) el.classList.remove('visible');
}
function stopSpeaking() {
    window.speechSynthesis.cancel();
    isSpeaking = false;
    hideVisualizer();   // ẩn ngay
}
function updateSoundIcon() {
    const icon = document.getElementById('soundStatusIcon');
    if (icon) {
        icon.textContent = isSoundOn ? '🔊' : '🔇';
    }
    // Visualizer được điều khiển hoàn toàn bởi onstart/onend, không cần xử lý ở đây
}



function exportAllLessonsDictionary() {
  let exportContent = 'TỪ ĐIỂN HÁN VIỆT - TOÀN BỘ BÀI HỌC\n';
  exportContent += `Xuất ngày: ${new Date().toLocaleString('vi-VN')}\n`;
  exportContent += '='.repeat(50) + '\n\n';
  
  // Duyệt qua tất cả bài học
  lessons.forEach(lesson => {
    exportContent += `📚 BÀI ${lesson.id}: ${lesson.title}\n`;
    exportContent += '-'.repeat(40) + '\n';
    
    // Thêm tất cả từ vựng của bài học
    lesson.vocabulary.forEach((word, index) => {
      exportContent += `${word.chinese}|${word.pinyin}|${word.meaning}`;
      if (word.example && word.example.trim() !== '') {
        exportContent += `|${word.example}`;
      }
      exportContent += '\n';
    });
    
    exportContent += '\n'; // Dòng trống giữa các bài
  });
  
  // Tạo và tải file
  const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  
  // Đặt tên file với ngày tháng
  const today = new Date();
  const dateStr = today.toISOString().slice(0, 10).replace(/-/g, '');
  a.download = `tu-dien-han-viet-${dateStr}.txt`;
  
  a.href = url;
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function showSlider() {
    const slider = document.querySelector('.slider-container');
    slider.classList.remove('hide');
    slider.classList.add('show');
    
    // Reset timeout
    clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideSlider, 5000); // Ẩn sau 5 giây
}

// Ẩn slider
function hideSlider() {
    const slider = document.querySelector('.slider-container');
    slider.classList.remove('show');
    slider.classList.add('hide');
}

// Sự kiện click nút
document.getElementById('toggleHeightBtn').addEventListener('click', function() {
    const slider = document.querySelector('.slider-container');
    if (slider.classList.contains('show')) {
        hideSlider();
    } else {
        showSlider();
    }
});

// Reset timer khi tương tác với slider
document.querySelector('.slider-container').addEventListener('mouseenter', function() {
    clearTimeout(hideTimeout);
});

document.querySelector('.slider-container').addEventListener('mouseleave', function() {
    hideTimeout = setTimeout(hideSlider, 5000);
});

// Tự động ẩn khi click ra ngoài
document.addEventListener('click', function(event) {
    const slider = document.querySelector('.slider-container');
    const toggleBtn = document.getElementById('toggleHeightBtn');
    
    if (!slider.contains(event.target) && !toggleBtn.contains(event.target) && slider.classList.contains('show')) {
        hideSlider();
    }
});
function initInputHeightSlider() {
    const slider = document.getElementById('inputHeightSlider');
    const sliderContainer = document.getElementById('inputHeightSliderContainer');
    
    // Kiểm tra phần tử tồn tại
    if (!slider || !sliderContainer) {
        console.error('Không tìm thấy phần tử thanh gạt');
        return;
    }
    
    // Tải giá trị đã lưu từ localStorage
    const savedHeight = localStorage.getItem('inputAreaHeight');
    if (savedHeight) {
        inputAreaHeight = parseInt(savedHeight);
        slider.value = inputAreaHeight;
        updateInputAreaPosition();
    }
    
    // Sự kiện khi kéo thanh gạt
    slider.addEventListener('input', function(e) {
        inputAreaHeight = parseInt(e.target.value);
        updateInputAreaPosition();
        saveInputHeight();
    });
    
    console.log('Đã khởi tạo thanh gạt độ cao');
}


// Hàm cập nhật vị trí input-area
function updateInputAreaPosition() {
    const inputArea = document.querySelector('.input-area');
    if (inputArea) {
        // Cập nhật animation keyframes dựa trên giá trị mới
        updateInputAnimations(inputAreaHeight);
        
        // Nếu input-area đang hiển thị, cập nhật ngay lập tức
        if (inputArea.classList.contains('visible')) {
            inputArea.style.bottom = inputAreaHeight + 'vh';
        }
    }
}

// Hàm cập nhật animation keyframes - PHIÊN BẢN SỬA
function updateInputAnimations(height) {
    // Tìm stylesheet đầu tiên
    const styleSheets = document.styleSheets;
    let targetSheet = null;
    
    // Tìm stylesheet có chứa rule cho .input-area
    for (let i = 0; i < styleSheets.length; i++) {
        try {
            const rules = styleSheets[i].cssRules || styleSheets[i].rules;
            for (let j = 0; j < rules.length; j++) {
                if (rules[j].name === 'slideInputUp' || rules[j].name === 'slideInputDown') {
                    targetSheet = styleSheets[i];
                    break;
                }
            }
            if (targetSheet) break;
        } catch (e) {
            // Bỏ qua stylesheet từ domain khác (CORS)
            continue;
        }
    }
    
    // Nếu không tìm thấy, sử dụng stylesheet đầu tiên
    if (!targetSheet && styleSheets.length > 0) {
        targetSheet = styleSheets[0];
    }
    
    if (!targetSheet) {
        console.error('Không tìm thấy stylesheet phù hợp');
        return;
    }

    // Xóa keyframes cũ
    const rules = targetSheet.cssRules || targetSheet.rules;
    const rulesToDelete = [];
    
    for (let i = 0; i < rules.length; i++) {
        if (rules[i].name === 'slideInputUp' || rules[i].name === 'slideInputDown') {
            rulesToDelete.push(i);
        }
    }
    
    // Xóa từ cuối để tránh làm hỏng index
    rulesToDelete.sort((a, b) => b - a).forEach(index => {
        targetSheet.deleteRule(index);
    });
    
    // Thêm keyframes mới
    const slideInputUp = `
    @keyframes slideInputUp {
        0% {
            bottom: 10vh;
            opacity: 0;
        }
        70% {
            bottom: ${height + 2}vh;
        }
        100% {
            bottom: ${height}vh;
            opacity: 1;
        }
    }`;
    
    const slideInputDown = `
    @keyframes slideInputDown {
        0% {
            bottom: ${height}vh;
            opacity: 1;
        }
        40% {
            bottom: ${height + 2}vh;
        }
        100% {
            bottom: -2vh;
            opacity: 0;
        }
    }`;
    
    try {
        targetSheet.insertRule(slideInputUp, targetSheet.cssRules.length);
        targetSheet.insertRule(slideInputDown, targetSheet.cssRules.length);
    } catch (e) {
        console.error('Lỗi khi chèn keyframes:', e);
        
        // Fallback: Thêm trực tiếp vào style tag
        const styleTag = document.createElement('style');
        styleTag.textContent = slideInputUp + slideInputDown;
        document.head.appendChild(styleTag);
    }
}


// Hàm lưu giá trị vào localStorage
function saveInputHeight() {
    localStorage.setItem('inputAreaHeight', inputAreaHeight.toString());
}

// Hàm hiển thị/ẩn thanh gạt
function toggleHeightSlider(show) {
    const sliderContainer = document.getElementById('inputHeightSliderContainer');
    if (sliderContainer) {
        sliderContainer.style.display = show ? 'flex' : 'none';
    }
}
function capitalizeVietnamese(str) {
    if (!str) return str;
    
    // Chỉ viết hoa chữ cái đầu tiên của toàn bộ chuỗi
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}


function displayRadicalAnalysis(hanzi) {
    const container = document.getElementById('radicalContent');
    container.innerHTML = '';

    // Kiểm tra xem có cần hiển thị phân tích bộ thủ không
    const analysisContainer = document.getElementById('radicalAnalysis');
    if (!showRadicalAnalysis) {
        analysisContainer.style.display = 'none';
        return;
    }
    analysisContainer.style.display = 'block';

    // Xử lý trường hợp không có chữ Hán đầu vào
    if (!hanzi) {
        const placeholder = document.createElement('div');
        placeholder.className = 'no-radicals';
        container.appendChild(placeholder);
        return;
    }

    // BƯỚC 1: Tìm bài học chứa cấu trúc bộ thủ (bài 14)
    const lesson14 = lessons.find(lesson => lesson.id === 14);

// Hàm tìm kiếm thông tin chữ Hán trong các bài học khác - PHIÊN BẢN ƯU TIÊN TỪ NGẮN
const findInLessons = (char) => {
    let foundWords = []; // Lưu tất cả từ tìm thấy
    
    for (const lesson of lessons) {
        if (lesson.id === 14) continue; // Bỏ qua bài 14
        
        for (const vocab of lesson.vocabulary) {
            if (vocab.chinese.includes(char)) {
                foundWords.push({
                    chineseFull: vocab.chinese,
                    pinyin: vocab.pinyin,
                    meaning: vocab.meaning,
                    lessonTitle: lesson.title,
                    length: vocab.chinese.length // Thêm độ dài để so sánh
                });
            }
        }
    }
    
    // Ưu tiên từ ngắn nhất (có độ dài nhỏ nhất)
    if (foundWords.length > 0) {
        foundWords.sort((a, b) => a.length - b.length); // Sắp xếp theo độ dài tăng dần
        return foundWords[0]; // Lấy từ ngắn nhất
    }
    
    return null;
};


    // BƯỚC 2: Xử lý từng ký tự trong chữ Hán
    for (let i = 0; i < hanzi.length; i++) {
        const character = hanzi[i];
        
        // BƯỚC 3: Lấy danh sách bộ thủ từ bài 14
        let radicals = [character]; // Mặc định: chính ký tự đó
        
        if (lesson14) {
            // Tìm chữ Hán trong bài 14
            const radicalsEntry = lesson14.vocabulary.find(word => word.chinese === character);
            
            // Nếu tìm thấy, tách danh sách bộ thủ
            if (radicalsEntry) {
                radicals = radicalsEntry.meaning.split(",");
            }
        }

        // Tạo phần tử hiển thị cho ký tự
        const charElement = document.createElement('div');
        charElement.className = 'radical-item';
        
        // Hiển thị ký tự gốc
        const charTitle = document.createElement('div');
        charTitle.className = 'radical-character';
        charTitle.textContent = character;
        charElement.appendChild(charTitle);
        
        // BƯỚC 4: Hiển thị các bộ thủ
        if (radicals.length > 0) {
            const componentsContainer = document.createElement('div');
            componentsContainer.className = 'radical-components';
            
            // Xử lý từng bộ thủ
 radicals.forEach(radical => {
    const radicalInfo = radicalDictionary[radical];
    const lessonInfo = findInLessons(radical);
    
    const componentElement = document.createElement('div');
    componentElement.className = 'radical-component';
    
    // Tạo dòng đầu tiên
    const line1 = document.createElement('div');
    line1.className = 'radical-line1';
    
    // Thêm chữ Hán
    const hanziSpan = document.createElement('span');
    hanziSpan.className = 'radical-hanzi';
    hanziSpan.textContent = radical;
    line1.appendChild(hanziSpan);
    
    let hasHint = false;
    
    // Xử lý các trường hợp
    if (radicalInfo) {
        // Kiểm tra và thêm hint nếu có
        if (radicalInfo.chineseFull && radical !== radicalInfo.chineseFull) {
            hasHint = true;
            const hintSpan = document.createElement('span');
            hintSpan.className = 'radical-hint';
            hintSpan.textContent = `(${radicalInfo.chineseFull})`;
            line1.appendChild(hintSpan);
        }
        
        componentElement.appendChild(line1);
        
        // Xử lý pinyin và meaning
        if (hasHint) {
            // Có hint: hiển thị pinyin và meaning ở dòng riêng
            const pinyinSpan = document.createElement('span');
            pinyinSpan.className = 'radical-pinyin';
            pinyinSpan.textContent = radicalInfo.pinyin;
            componentElement.appendChild(pinyinSpan);
            
            const meaningSpan = document.createElement('span');
            meaningSpan.className = 'radical-meaning';
            meaningSpan.textContent = radicalInfo.meaning;
            componentElement.appendChild(meaningSpan);
        } else {
            // Không có hint: hiển thị pinyin cùng dòng với chữ Hán
            const pinyinSpan = document.createElement('span');
            pinyinSpan.className = 'radical-pinyin';
            pinyinSpan.textContent = radicalInfo.pinyin;
            pinyinSpan.style.marginLeft = '8px'; // Tạo khoảng cách
            line1.appendChild(pinyinSpan);
            
            const meaningSpan = document.createElement('span');
            meaningSpan.className = 'radical-meaning';
            meaningSpan.textContent = radicalInfo.meaning;
            componentElement.appendChild(meaningSpan);
        }
    }
    else if (lessonInfo) {
        // Xử lý tương tự với lessonInfo
        if (lessonInfo.chineseFull && radical !== lessonInfo.chineseFull) {
            hasHint = true;
            const hintSpan = document.createElement('span');
            hintSpan.className = 'radical-hint';
            hintSpan.textContent = `(${lessonInfo.chineseFull})`;
            line1.appendChild(hintSpan);
        }
        
        componentElement.appendChild(line1);
        
        if (hasHint) {
            const pinyinSpan = document.createElement('span');
            pinyinSpan.className = 'radical-pinyin';
            pinyinSpan.textContent = lessonInfo.pinyin;
            componentElement.appendChild(pinyinSpan);
            
            const meaningSpan = document.createElement('span');
            meaningSpan.className = 'radical-meaning';
            meaningSpan.textContent = lessonInfo.meaning;
            componentElement.appendChild(meaningSpan);
        } else {
            const pinyinSpan = document.createElement('span');
            pinyinSpan.className = 'radical-pinyin';
            pinyinSpan.textContent = lessonInfo.pinyin;
            pinyinSpan.style.marginLeft = '8px';
            line1.appendChild(pinyinSpan);
            
            const meaningSpan = document.createElement('span');
            meaningSpan.className = 'radical-meaning';
            meaningSpan.textContent = lessonInfo.meaning;
            componentElement.appendChild(meaningSpan);
        }
    }
    else {
        // Trường hợp không có thông tin
        componentElement.appendChild(line1);
    }
    
    componentsContainer.appendChild(componentElement);
});

            charElement.appendChild(componentsContainer);
        }
        
        container.appendChild(charElement);
    }
}


const toneMap = {
    'a': { '1': 'ā', '2': 'á', '3': 'ǎ', '4': 'à' },
    'e': { '1': 'ē', '2': 'é', '3': 'ě', '4': 'è' },
    'i': { '1': 'ī', '2': 'í', '3': 'ǐ', '4': 'ì' },
    'o': { '1': 'ō', '2': 'ó', '3': 'ǒ', '4': 'ò' },
    'u': { '1': 'ū', '2': 'ú', '3': 'ǔ', '4': 'ù' },
    'v': { '1': 'ǖ', '2': 'ǘ', '3': 'ǚ', '4': 'ǜ' }
};
function handleToneKeyInput(e, inputElement) {
    if (e.key >= '1' && e.key <= '4' && !e.ctrlKey && !e.altKey) {
        const input = inputElement;
        const start = input.selectionStart;
        const end = input.selectionEnd;
        const value = input.value;
        
        // Tìm nguyên âm gần nhất trước con trỏ
        if (start > 0) {
            const textBeforeCursor = value.substring(0, start);
            let vowelIndex = -1;
            let vowelChar = '';
            
            // Tìm nguyên âm cuối cùng (a, e, i, o, u, v)
            for (let i = start - 1; i >= 0; i--) {
                const char = value[i].toLowerCase();
                if (['a', 'e', 'i', 'o', 'u', 'v'].includes(char)) {
                    vowelIndex = i;
                    vowelChar = value[i];
                    break;
                }
            }
            
            // CHỈ thêm dấu nếu tìm thấy nguyên âm
            if (vowelIndex !== -1 && toneMap[vowelChar.toLowerCase()] && toneMap[vowelChar.toLowerCase()][e.key]) {
                e.preventDefault();
                
                const isUpperCase = vowelChar >= 'A' && vowelChar <= 'Z';
                let newChar = toneMap[vowelChar.toLowerCase()][e.key];
                
                if (isUpperCase) {
                    newChar = newChar.toUpperCase();
                }
                
                // Thay thế nguyên âm bằng nguyên âm có dấu
                const newValue = value.substring(0, vowelIndex) + newChar + value.substring(vowelIndex + 1);
                input.value = newValue;
                
                // Đặt con trỏ sau ký tự vừa thay thế
                input.setSelectionRange(vowelIndex + 1, vowelIndex + 1);
                return true;
            }
        }
        
        // Nếu KHÔNG tìm thấy nguyên âm, CHO PHÉP gõ số bình thường
        return false;
    }
    return false;
}
function initPinyinToneHandlers() {
    // Xử lý cho modal thêm từ
    const pinyinInputModal = document.getElementById('pinyinInputModal');
    if (pinyinInputModal) {
        pinyinInputModal.addEventListener('keydown', function(e) {
            handleToneKeyInput(e, this);
        });
    }
    
    // Xử lý cho textarea thêm nhiều từ
    const bulkAddWords = document.getElementById('bulkAddWords');
    if (bulkAddWords) {
        bulkAddWords.addEventListener('keydown', function(e) {
            handleToneKeyInput(e, this);
        });
    }
    
    // Xử lý cho các ô nhập Pinyin khi sửa từ (delegation)
    document.addEventListener('keydown', function(e) {
        const activeElement = document.activeElement;
        if (activeElement && activeElement.id && activeElement.id.startsWith('editPinyin-')) {
            handleToneKeyInput(e, activeElement);
        }
    });
      // THÊM: Xử lý cho ô tìm kiếm trong từ điển
  document.addEventListener('keydown', function(e) {
    const activeElement = document.activeElement;
    if (activeElement && activeElement.id === 'dictionarySearch') {
      handleToneKeyInput(e, activeElement);
    }
  });

}


let wordCount = 20;
let showVietnamese = true;
let currentLesson = null;
let currentWordIndex = 0;
let nextWordIndex = 1;
let correctAnswers = 0;
let totalWordsAttempted = 0;
let wrongWords = [];
let gameActive = false;
let remainingWords = [];
let startTime;
let swapDisplay = false;
let maxPinyinShowCount = 20;
let pinyinShowCount = maxPinyinShowCount;
let correctBonusTime = 15;
let wrongBonusTime = 10;
let timePerWord = 30;
let timeLeft; 
let wordTimer; 
let showExampleInstead = false;
// Biến lưu giá trị độ cao

// Hàm tạo màu tự động dựa trên ID bài học
function generateColorForLesson(lessonId) {
  const colors = [
    '#3498db', '#3498db', '#3498db', '#3498db', '#3498db',
    '#3498db', '#3498db','#3498db', '#3498db', '#34db6d'
  ];
  return colors[(lessonId - 1) % colors.length];
}

// Hàm làm tối màu để tạo gradient
// Hàm làm tối màu để tạo gradient - SỬA LẠI CHO CHÍNH XÁC
function darkenColor(hex, percent) {
  // Xử lý cả mã hex 3 ký tự
  let r, g, b;
  
  if (hex.length === 4) {
    // #RGB -> #RRGGBB
    r = parseInt(hex[1] + hex[1], 16);
    g = parseInt(hex[2] + hex[2], 16);
    b = parseInt(hex[3] + hex[3], 16);
  } else {
    // #RRGGBB
    r = parseInt(hex.slice(1, 3), 16);
    g = parseInt(hex.slice(3, 5), 16);
    b = parseInt(hex.slice(5, 7), 16);
  }
  
  // Làm tối màu
  r = Math.max(0, Math.floor(r * (100 - percent) / 100));
  g = Math.max(0, Math.floor(g * (100 - percent) / 100));
  b = Math.max(0, Math.floor(b * (100 - percent) / 100));
  
  return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
}


function initLessonSelection() {
  const container = document.getElementById('lessonsContainer');
  container.innerHTML = '';
  
  lessons.filter(lesson => lesson.id <= 10).forEach(lesson => {
    const lessonBtn = document.createElement('button');
    lessonBtn.className = 'lesson-btn';
    lessonBtn.textContent = lesson.id;
    lessonBtn.title = lesson.title;
    lessonBtn.dataset.lessonId = lesson.id;
    
    // Sử dụng CSS variables thay vì style trực tiếp
    const baseColor = lesson.color || generateColorForLesson(lesson.id);
    const gradientColor = darkenColor(baseColor, 30);
    const borderColor = darkenColor(baseColor, 20);
    
    // Thiết lập CSS variables
    lessonBtn.style.setProperty('--base-color', baseColor);
    lessonBtn.style.setProperty('--gradient-color', gradientColor);
    lessonBtn.style.setProperty('--border-color', borderColor);
    
    lessonBtn.addEventListener('click', () => selectLesson(lesson));
    container.appendChild(lessonBtn);
  });
}





document.getElementById('restartBtn').addEventListener('click', function() {
    resetGameState();
    
  wordCount = parseInt(document.getElementById('wordCount').value) || 20;
  updateRemainingWords(); // Sử dụng hàm này thay vì gán trực tiếp

    document.getElementById('resultContainer').style.display = 'none';
    document.getElementById('gameArea').style.display = 'block';
    document.querySelector('.word-display').style.display = 'none';
    document.querySelector('.input-area').classList.remove('visible', 'hiding');
    document.querySelector('.time-bar-container').style.display = 'none';
    document.querySelector('.start-instruction').style.display = 'block';
    document.getElementById('wordCounter').style.display = 'none';
    
    document.querySelectorAll('.pinyin-box').forEach(box => {
        box.classList.remove('used');
    });

    setTimeout(() => {
        startGame();
    }, 100);
});


function selectLesson(lesson) {

currentLesson = lesson;
  const gameScreen = document.getElementById('gameScreen');
  if (lesson.id >= 11) {
    gameScreen.classList.add('special-lesson');
    gameScreen.classList.remove('normal-lesson');
  } else {
    gameScreen.classList.add('normal-lesson');
    gameScreen.classList.remove('special-lesson');
  }
  if (lesson.id === 11 || lesson.id === 12 || lesson.id === 13) {
    wordCount = lesson.vocabulary.length; // Sử dụng tất cả từ vựng
  } else {
    wordCount = parseInt(document.getElementById('wordCount').value) || 20;
  }
  if (lesson.id === 14) {
    document.getElementById('vietnameseMeaning').style.display = 'none';
    document.getElementById('nextWordPreview').style.display = 'none';
  }
    resetGameState();
 updateRemainingWords();

  if (showRadicalAnalysis) {
    displayRadicalAnalysis('');
  } else {
    document.getElementById('radicalAnalysis').style.display = 'none';
  }




document.getElementById('darkModeToggle').style.display = 'none';
document.getElementById('currentLessonTitleDisplay').textContent = lesson.title;
document.getElementById('lessonSelection').style.display = 'none';
document.getElementById('gameScreen').style.display = 'block';


document.querySelector('.dictionary-section').style.display = 'none';
document.getElementById('addWordSection').style.display = 'none';
document.querySelector('.lesson-sidebar').style.display = 'none';
document.getElementById('openCatalogBtn').style.display = 'none';



  document.querySelectorAll('.lesson-sidebar-item').forEach(item => {
    item.classList.toggle('active', item.dataset.lessonId == lesson.id);
  });
resetGameState();
setTimeout(() => {
startGame();
}, 100);

displayRadicalAnalysis('');
}

function updatePinyinBoxes() {
  const countInput = document.getElementById('pinyinCount');
  maxPinyinShowCount = parseInt(countInput.value) || 20;
  pinyinShowCount = maxPinyinShowCount;
  
  const container = document.getElementById('pinyinIndicator');
  container.innerHTML = '';
  

  for (let i = 0; i < maxPinyinShowCount; i++) {
    const box = document.createElement('div');
    box.className = 'pinyin-box';
    container.appendChild(box);
  }
}


const darkModeToggle = document.getElementById('darkModeToggle');
const savedMode = localStorage.getItem('darkMode');


if (savedMode === 'enabled') {
  document.body.classList.add('dark-mode');
}

darkModeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  
  // Lưu trạng thái vào localStorage
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
  
  // Đổi icon
  darkModeToggle.textContent = isDark ? '☀️' : '🌙';
});

if (savedMode === 'enabled') {
  darkModeToggle.textContent = '☀️';
}
function updateWordCounter() {
  if (!gameActive) return;
  
  document.getElementById('currentWordIndex').textContent = totalWordsAttempted;
  const pinyinHeight = document.getElementById('pinyinIndicator').offsetHeight;
  const topPosition = `${pinyinHeight + 68}px`;
  
  // Cập nhật vị trí cho cả wordCounter và soundStatusIcon
  document.getElementById('wordCounter').style.top = topPosition;
}

function resetGameState() {
    currentDisplayedWord = null;
    animatedWords = []; 
    currentWordIndex = 0;
    nextWordIndex = 1;
    correctAnswers = 0;
    totalWordsAttempted = 0;
    wrongWords = [];
    gameActive = false;
    toggleHeightSlider(false);
    hasShownPinyin = false;

  displayRadicalAnalysis(showRadicalAnalysis ? '' : '');
  const container = document.querySelector('#gameScreen .container');
  container.style.opacity = '0';
  container.classList.remove('normal-lesson', 'special-lesson');

  const resultContainer = document.getElementById('resultContainer');
  if (resultContainer) {
    resultContainer.classList.remove('victory');
    document.querySelector('.result-title').classList.remove('victory-title');
    document.querySelector('.result-title').textContent = "结果";
  }
  document.querySelectorAll('.energy-particle').forEach(particle => {
    particle.parentNode.removeChild(particle);
  });
  shownPinyinWords = [];
  pinyinShowCount = maxPinyinShowCount;
  const countInput = document.getElementById('pinyinCount');
  maxPinyinShowCount = parseInt(countInput.value) || 20;

  if (showRadicalAnalysis) {
    displayRadicalAnalysis('');
  } else {
    document.getElementById('radicalAnalysis').style.display = 'none';
  }



    clearInterval(wordTimer);
    timeLeft = timePerWord;
    document.getElementById('timeProgress').style.width = '100%';
    document.getElementById('timeProgress').style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
    

    document.getElementById('wordCounter').style.display = 'none';
    document.querySelector('.word-display').style.display = 'none';
    document.querySelector('.input-area').classList.remove('visible', 'hiding');
    document.querySelector('.time-bar-container').style.display = 'none';
    document.getElementById('resultContainer').style.display = 'none';
    document.getElementById('pinyinIndicator').style.display = 'none';

    document.getElementById('chineseInput').value = '';
    
    // Reset các ô pinyin
    document.querySelectorAll('.pinyin-box').forEach(box => {
        box.classList.remove('used');
    updatePinyinBoxes();
    });
displayRadicalAnalysis('');
    
    // KHÔNG reset remainingWords ở đây, sẽ xử lý trong sự kiện click
}
function showHeader() {
document.body.classList.remove('hide-header');
document.body.classList.add('show-header');
}

showHeader();
function renderLessonSidebar() {
  const sidebarItems = document.getElementById('lessonSidebarItems');
  sidebarItems.innerHTML = '';
  
  // Chỉ lấy các bài học từ 1-10
  lessons.filter(lesson => lesson.id <= 10).forEach(lesson => {
    const item = document.createElement('div');
    item.className = 'lesson-sidebar-item';

    const lessonTitle = lesson.title.replace(/^Bài\s+bài\s+/i, 'Bài '); // Thay "Bài bài" thành "Bài"
    item.textContent = lessonTitle;
    
    item.dataset.lessonId = lesson.id;
    
    // Highlight bài học hiện tại
    if (currentLesson && currentLesson.id === lesson.id) {
      item.classList.add('active');
    }
    
    item.addEventListener('click', () => {
      selectLesson(lesson);
    });
    
    sidebarItems.appendChild(item);
  });
}


// ========== HÀM KHỞI ĐỘNG GAME ========== //
// Sự kiện xuất từ điển
document.getElementById('exportDictionaryBtn').addEventListener('click', function() {
  // Tạo mảng chứa tất cả từ vựng
  // Lấy lessonId của bài đang xem trong từ điển
  const lessonId = currentDictionaryLessonId;
  const lesson = lessons.find(l => l.id === lessonId);
  
  if (!lesson) {
    alert('Không tìm thấy bài học để xuất!');
    return;
  }

  // Chỉ xuất từ vựng của bài học này
  const exportText = lesson.vocabulary.map(word => {
    return `${word.chinese}|${word.pinyin}|${word.meaning}|${word.example || ''}`;
  }).join('\n');
  
  // Tạo popup hiển thị
  const popup = document.createElement('div');
  popup.style.position = 'fixed';
  popup.style.top = '50%';
  popup.style.left = '50%';
  popup.style.transform = 'translate(-50%, -50%)';
  popup.style.backgroundColor = 'white';
  popup.style.padding = '20px';
  popup.style.borderRadius = '8px';
  popup.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
  popup.style.zIndex = '10000';
  popup.style.width = '80%';
  popup.style.maxWidth = '500px';
  
  popup.innerHTML = `
    <h3>Toàn bộ từ điển</h3>
    <textarea id="exportedContent" style="width: 100%; height: 200px; margin: 10px 0; font-family: monospace;">${exportText}</textarea>
    <div style="display:flex; justify-content: space-between;">
      <button id="copyExportedBtn">Sao chép</button>
      <button id="downloadExportedBtn">Tải xuống</button>
      <button id="closeExportPopup">Đóng</button>
    </div>
  `;
  
  document.body.appendChild(popup);
  
  // Sự kiện sao chép
  document.getElementById('copyExportedBtn').addEventListener('click', function() {
    const textarea = document.getElementById('exportedContent');
    textarea.select();
    document.execCommand('copy');
    alert('Đã sao chép vào clipboard!');
  });
  
  // Sự kiện tải xuống
  document.getElementById('downloadExportedBtn').addEventListener('click', function() {
    const content = document.getElementById('exportedContent').value;
    const blob = new Blob([content], {type: 'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'tu-dien-han-viet.txt';
    a.click();
  });
  
  // Sự kiện đóng
  document.getElementById('closeExportPopup').addEventListener('click', function() {
    document.body.removeChild(popup);
  });
});

function updatePreview() {
    const previewElement = document.getElementById('nextWordPreview');
    if (!previewElement) return;
    if (listenWriteMode) {
        previewElement.textContent = ''; // Xóa nội dung cũ (tùy chọn)
        return;
    }
    if (remainingWords.length > 0) {
        const currentWord = remainingWords[currentWordIndex];
        
        if (showExampleInstead) {
            previewElement.textContent = currentWord.example && currentWord.example.trim() !== '' 
                ? currentWord.example 
                : "";
        } else {
            if (remainingWords.length > 1) {
                nextWordIndex = (currentWordIndex + 1) % remainingWords.length;
                const nextWord = remainingWords[nextWordIndex];
                
                if (swapDisplay) {
                    previewElement.textContent = capitalizeVietnamese(nextWord.meaning);
                } else {
                    previewElement.textContent = nextWord.chinese;
                }
            } else {
                previewElement.textContent = '';
            }
        }
    } else {
        previewElement.textContent = '';
    }
}

function initSpecialLessons() {
  const specialContainer = document.getElementById('specialLessons');
  if (!specialContainer) return;

  specialContainer.innerHTML = '';
  
  // Kiểm tra xem bài 11 có tồn tại không
  const lesson11 = lessons.find(lesson => lesson.id === 11);
  if (lesson11) {
    const pronunciationBtn = document.createElement('button');
    pronunciationBtn.className = 'special-lesson-btn';
    pronunciationBtn.innerHTML = '11<br><span>Thanh mẫu</span>';
    pronunciationBtn.addEventListener('click', () => selectLesson(lesson11));
    specialContainer.appendChild(pronunciationBtn);
  }
  
  // Kiểm tra xem bài 12 có tồn tại không
  const lesson12 = lessons.find(lesson => lesson.id === 12);
  if (lesson12) {
    const radicalsBtn = document.createElement('button');
    radicalsBtn.className = 'special-lesson-btn';
    radicalsBtn.innerHTML = '12<br><span>Phụ mẫu</span>';
    radicalsBtn.addEventListener('click', () => selectLesson(lesson12));
    specialContainer.appendChild(radicalsBtn);
  }
  const lesson13 = lessons.find(lesson => lesson.id === 13);
  if (lesson13) {
    const radicalsBtn = document.createElement('button');
    radicalsBtn.className = 'special-lesson-btn';
    radicalsBtn.innerHTML = '13<br><span>Bộ Thủ</span>';
    radicalsBtn.addEventListener('click', () => selectLesson(lesson13));
    specialContainer.appendChild(radicalsBtn);
  }



}


function startGame() {

  toggleHeightSlider(true);
  const container = document.querySelector('#gameScreen .container');
  
  // THÊM ĐOẠN NÀY ĐỂ KÍCH HOẠT LẠI ANIMATION
  void container.offsetWidth; // Kích hoạt reflow
  container.style.animation = 'none';
  
  // Reset và kích hoạt lại animation
  setTimeout(() => {
    if (currentLesson.id >= 11) {
      container.style.animation = 'simpleFadeIn 0.4s ease-out forwards';
    } else {
      container.style.animation = 'containerAppear 0.6s ease-out forwards';
    }
  }, 10);


  if (showRadicalAnalysis && remainingWords.length > 0 && currentWordIndex < remainingWords.length) {
    displayRadicalAnalysis(remainingWords[currentWordIndex].chinese);
  } else {
    document.getElementById('radicalAnalysis').style.display = 'none';
  }

const inputArea = document.querySelector('.input-area');
const timeBarContainer = document.querySelector('.time-bar-container');
const wordDisplay = document.querySelector('.word-display');
const timeProgress = document.getElementById('timeProgress');
const chineseInput = document.getElementById('chineseInput');

if (!remainingWords || remainingWords.length === 0) {
console.error('Không có từ vựng để hiển thị');
return;
}

gameActive = true;
updatePreviewVisibility();
startTime = Date.now();

// Reset trạng thái hiển thị
wordDisplay.style.display = 'block';

// Hiển thị pinyin indicator
document.getElementById('pinyinIndicator').style.display = 'flex';

// Hiển thị input area với animation
inputArea.style.display = 'block';
inputArea.classList.remove('hiding');
inputArea.classList.add('visible');

// Hiển thị và reset thanh thời gian
timeBarContainer.style.display = 'block';
timeBarContainer.classList.remove('hide');
timeProgress.style.width = '0%';

// Reset interval thời gian
    clearInterval(wordTimer); // Xóa timer cũ nếu có
    timeLeft = timePerWord;
    updateTimeBar();
    wordTimer = setInterval(() => {
  timeLeft -= 0.01; // Giảm 0.01 giây mỗi lần (10ms)
        updateTimeBar();
        
        if (timeLeft <= 0) {
            clearInterval(wordTimer);
            handleTimeOut();
        }
    }, 10);

// Xáo trộn từ nếu cần
if (totalWordsAttempted === 0 || remainingWords.length > 1) {
shuffleArray(remainingWords);
document.querySelectorAll('.pinyin-box').forEach(box => {
box.classList.remove('used');
});
}

displayWord();
updateWordCounter();
chineseInput.value = '';
chineseInput.focus();

// Đảm bảo game area hiển thị
document.getElementById('radicalAnalysis').style.display = 'block';
document.getElementById('gameArea').style.display = 'block';
document.getElementById('resultContainer').style.display = 'none';
document.getElementById('wordCounter').style.display = 'block';
    correctStreak = 0; // Reset streak khi bắt đầu game mới
    maxStreak = 0;
}

document.getElementById('dictionaryBtn').addEventListener('click', function() {
document.getElementById('dictionaryModal').style.display = 'flex';
renderDictionary();

});

function updateTimeBar() {
    const progress = (timeLeft / timePerWord) * 100;
    const timeProgress = document.getElementById('timeProgress');
    
    timeProgress.style.transition = 'width 0.01s linear';
    timeProgress.style.width = `${progress}%`;
    
    if (progress <= 20){
        timeProgress.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
        timeProgress.style.animation = 'blink 0.3s infinite';
    } else if (progress <= 40) {
       timeProgress.style.background = 'linear-gradient(90deg, #ffd700, #ffa500)';
       timeProgress.style.animation = 'none';
    } else {
        timeProgress.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
        timeProgress.style.animation = 'none';
    }
}

function handleTimeOut() {
    if (!gameActive) return;
    
    // Thêm từ hiện tại vào danh sách sai nếu chưa có
    if (currentWordIndex >= 0 && currentWordIndex < remainingWords.length) {
        const currentWord = remainingWords[currentWordIndex];
        if (!wrongWords.some(w => w.chinese === currentWord.chinese)) {
                  wrongWords.push({
        ...currentWord,
        lessonId: currentLesson.id // Lưu ID bài học gốc
      });

        }
        totalWordsAttempted++;
    }
    
    // Hiển thị kết quả
    endGame();
}
function saveTimeSettings() {
  localStorage.setItem('timeSettings', JSON.stringify({
    timePerWord: timePerWord,
    correctBonusTime: correctBonusTime,
    wrongBonusTime: wrongBonusTime,
    wordCount: wordCount,
    pinyinCount: maxPinyinShowCount,
    showVietnamese: showVietnamese,
    showRadicalAnalysis: showRadicalAnalysis,
    showExampleInstead: showExampleInstead,
    swapDisplay: swapDisplay,
    preSpeak: preSpeak,
    showRewardMessage: showRewardMessage,
    showFirework: showFirework,
    listenWriteMode: listenWriteMode,
    postSpeak: postSpeak,
    isSoundOn: isSoundOn  
  }));
  console.log('Đã lưu cài đặt thời gian:', {correctBonusTime, wrongBonusTime});
}
document.getElementById('wordCount').addEventListener('change', function() {
  let value = parseInt(this.value);
  if (isNaN(value) || value < 5 || value > 1000) {
    value = 20;
    this.value = value;
  }
  wordCount = value;
  saveTimeSettings();
});





let currentDictionaryLessonId = 1; 

const INITIAL_LOAD_COUNT = 200;
const LOAD_MORE_COUNT = 200;// Số lượng từ mỗi lần load ở từ điển 

let currentDisplayedCount = 0;
let filteredWords = [];


function renderDictionary() {
    selectedWords = [];
    updateBulkActionsPanel();
    
    // Phần còn lại giữ nguyên...
    const dictionaryContent = document.getElementById('dictionaryContent');
    dictionaryContent.innerHTML = `
        <h2 class="dictionary-title">Từ Điển Hán Việt</h2>
        <div class="search-container">
            <input type="text" id="dictionarySearch" placeholder="Tìm kiếm từ vựng...">
            <div class="search-hint"> Nhấn phím 1,2,3,4 để thêm dấu thanh </div>
        </div>
        <div class="lesson-tabs" id="lessonTabs"></div>
        <div id="wordsContainer"></div>
    `;
    
    // Render tabs bài học
    const lessonTabs = document.getElementById('lessonTabs');
    lessons.forEach(lesson => {
        const tab = document.createElement('div');
        tab.className = 'lesson-tab';
        tab.textContent = `Bài ${lesson.id}`;
        tab.dataset.lessonId = lesson.id;
        tab.addEventListener('click', () => {
            currentDictionaryLessonId = lesson.id; // Lưu lại ID bài học hiện tại
            showLessonWords(lesson.id);
  
        });
        lessonTabs.appendChild(tab);
    });

if (lessons.length > 0) {
showLessonWords(lessons[0].id);
document.querySelector('.lesson-tab').classList.add('active');
}

    
    // Đánh dấu tab active
    document.querySelectorAll('.lesson-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.lessonId == currentDictionaryLessonId);
    });

    // Các sự kiện khác giữ nguyên
    document.getElementById('dictionarySearch').addEventListener('input', function(e) {
        const searchTerm = this.value.toLowerCase();
        filterWords(searchTerm);
    });
    
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.move-options')) {
            document.querySelectorAll('.move-options').forEach(el => el.remove());
        }
    });

    document.getElementById('closeDictionary').addEventListener('click', function() {
        document.getElementById('dictionaryModal').style.display = 'none';
    });

    document.addEventListener('keydown', function(e) {
        const inDictionary = document.getElementById('dictionaryModal').style.display === 'flex';
        const inAddWordModal = document.getElementById('addWordModal').style.display === 'flex';
        const inCatalog = document.getElementById('lessonCatalog').style.display === 'flex';
        
        if (inDictionary || inAddWordModal || inCatalog) {
            if (e.key === 'Enter') {
                e.preventDefault();
                return;
            }
        }
        return true;
    });
}



// ========== LƯU VÀ TẢI DỮ LIỆU ========== //
// Lưu dữ liệu vào localStorage
function saveDataToStorage() {
  try {
    // ĐẢM BẢO LƯU CẢ THUỘC TÍNH color
    localStorage.setItem('hanNguLessons', JSON.stringify(lessons.map(lesson => ({
      id: lesson.id,
      title: lesson.title,
      color: lesson.color || generateColorForLesson(lesson.id), // THÊM DÒNG NÀY
      vocabulary: lesson.vocabulary
    }))));
    console.log('Dữ liệu đã lưu :', lessons);
    return true;
  } catch (e) {
    console.error('Lỗi khi lưu vào localStorage:', e);
    return false;
  }
}

// Tải dữ liệu từ localStorage
function loadDataFromStorage() {
  const savedData = localStorage.getItem('hanNguLessons');
  if (savedData) {
    try {
      const parsedData = JSON.parse(savedData);
      
      // Xóa mảng lessons hiện tại
      lessons.length = 0;

      // Thêm dữ liệu từ localStorage vào
      parsedData.forEach(lesson => {
        // ĐẢM BẢO KHÔI PHỤC MÀU SẮC
        const color = lesson.color || generateColorForLesson(lesson.id);
        
        // Đảm bảo mỗi từ trong vocabulary có trường example
        const vocabulary = (lesson.vocabulary || []).map(word => {
          const newWord = {
            chinese: word.chinese || '',
            pinyin: word.pinyin || '',
            meaning: word.meaning || '',
            example: word.example || '',
            mastered: word.mastered || false
          };
          
          for (const key in word) {
            if (!newWord.hasOwnProperty(key)) {
              newWord[key] = word[key];
            }
          }
          
          return newWord;
        });

        lessons.push({
          id: lesson.id,
          title: lesson.title,
          color: color, // KHÔI PHỤC MÀU
          vocabulary: vocabulary
        });
      });
      
      console.log('Đã tải dữ liệu từ localStorage với màu sắc');
    } catch (e) {
      console.error('Lỗi khi đọc dữ liệu từ localStorage:', e);
    }
  } else {
    // Nếu không có dữ liệu lưu, thêm màu cho các bài học mặc định
    lessons.forEach(lesson => {
      if (!lesson.color) {
        lesson.color = generateColorForLesson(lesson.id);
      }
    });
    saveDataToStorage();
  }
}


//tRÙNG LẶP TỪ Ở PHẦN THÊM TỪ
function isWordExist(lessonId, chinese) {
  const lesson = lessons.find(l => l.id === lessonId);
  if (!lesson) return false;
  
  // SỬA LẠI - CHỈ KIỂM TRA CHỮ HÁN, KHÔNG KIỂM TRA PINYIN
  return lesson.vocabulary.some(word => 
    word.chinese.toLowerCase() === chinese.toLowerCase()
  );
}

let highScore = localStorage.getItem('hanNguHighScore') || 0; // Biến toàn cục lưu điểm cao
highScore = parseInt(highScore) || 0;

// Hàm cập nhật điểm cao
function updateHighScore(currentScore) {
    if (currentScore > highScore) {
        highScore = currentScore;
        localStorage.setItem('hanNguHighScore', highScore);
    }
    document.getElementById('highScoreDisplay').textContent = `${highScore}🏆`;
}


// Hiển thị từ vựng theo bài học
function showLessonWords(lessonId) {
    selectedWords = [];
    updateBulkActionsPanel();
    const dictionaryContent = document.getElementById('dictionaryContent');
    const scrollPosition = dictionaryContent.scrollTop;
    currentDictionaryLessonId = lessonId;
    const lesson = lessons.find(l => l.id == lessonId);
    if (!lesson) return;

    document.querySelectorAll('.lesson-tab').forEach(tab => {
      tab.classList.toggle('active', tab.dataset.lessonId == lessonId);
    });

    const wordsContainer = document.getElementById('wordsContainer');
    wordsContainer.innerHTML = `
        <h3>${lesson.title}</h3>
        <div class="word-count">${lesson.vocabulary.length} từ</div>
        <div class="dictionary-words" id="dictionaryWords-${lessonId}"></div>
        <div id="loader-${lessonId}" class="loader">Đang tải thêm...</div>
    `;

    // Khởi tạo filteredWords với originalIndex
    currentDisplayedCount = 0;
    filteredWords = lesson.vocabulary.map((word, index) => ({
        word: word,
        originalIndex: index
    }));
    
    loadMoreWords(lessonId);

    // Thiết lập IntersectionObserver để tải thêm khi cuộn đến loader
    const loader = document.getElementById(`loader-${lessonId}`);
    const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
            loadMoreWords(lessonId);
        }
    }, { threshold: 0.1 });

    observer.observe(loader);


}

function loadMoreWords(lessonId) {
    const wordsDiv = document.getElementById(`dictionaryWords-${lessonId}`);
    const loader = document.getElementById(`loader-${lessonId}`);
    
    const start = currentDisplayedCount;
    const end = Math.min(start + LOAD_MORE_COUNT, filteredWords.length);
    
    const fragment = document.createDocumentFragment();
    for (let i = start; i < end; i++) {
        const wordData = filteredWords[i]; // wordData chứa {word, originalIndex}
        const wordCard = createWordCard(wordData, lessonId);
        fragment.appendChild(wordCard);
    }
    
    wordsDiv.appendChild(fragment);
    currentDisplayedCount = end;
    
    // Ẩn loader nếu đã hiển thị hết
    if (currentDisplayedCount >= filteredWords.length) {
        loader.style.display = 'none';
    } else {
        loader.style.display = 'block';
    }
}
let selectedWords = [];
let currentBulkLessonId = null;

// Hàm cập nhật bảng chức năng
function updateBulkActionsPanel() {
    const panel = document.getElementById('bulkActionsPanel');
    const selectedCount = document.getElementById('selectedCount');
    
    selectedCount.textContent = selectedWords.length;
    
    if (selectedWords.length > 0) {
        panel.classList.remove('hidden');
    } else {
        panel.classList.add('hidden');
    }
}


 function createWordCard(wordData, lessonId) {
    const wordCard = document.createElement('div');
    wordCard.className = 'word-card';
    
    const word = wordData.word;
    const originalIndex = wordData.originalIndex;
    
    // Escape HTML để tránh XSS
    const escapeHTML = (str) => {
        if (str == null) return '';
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
    };
    
    const escapedChinese = escapeHTML(word.chinese);
    const escapedPinyin = escapeHTML(word.pinyin);
    const escapedMeaning = escapeHTML(word.meaning);
    const escapedExample = escapeHTML(word.example);
    
    let htmlContent = '';
    
// Trong phần tạo HTML, đảo vị trí checkbox và chữ Hán
if (lessonId === 14) {
    htmlContent = `
        <div class="word-card-header">
            <h3>${escapedChinese}</h3> <!-- Chữ Hán trước -->
            <input type="checkbox" class="word-checkbox" data-lesson="${lessonId}" data-index="${originalIndex}"> <!-- Checkbox sau -->
        </div>
        <div class="word-card-content">
            <p><strong>Pinyin:</strong> ${colorizePinyin(escapedPinyin)}</p>
            <p><strong style="color: #0066cc;">Bộ thủ:</strong> 
                <span style="color: #0066cc; font-weight: bold;">${escapedMeaning}</span>
            </p>
        </div>
    `;
} else {
    htmlContent = `
        <div class="word-card-header">
            <h3>${escapedChinese}</h3> <!-- Chữ Hán trước -->
            <input type="checkbox" class="word-checkbox" data-lesson="${lessonId}" data-index="${originalIndex}"> <!-- Checkbox sau -->
        </div>
        <div class="word-card-content">
            <p><strong>Pinyin:</strong> ${colorizePinyin(escapedPinyin)}</p>
            <p><strong>Nghĩa:</strong> ${capitalizeVietnamese(escapedMeaning)}</p>
    `;
    
    if (word.example && word.example.trim() !== '') {
        htmlContent += `<p class="word-example"><strong>Ví dụ:</strong> ${escapedExample}</p>`;
    }
    
    htmlContent += `</div>`;
}
    
    // Thêm phần action buttons
    htmlContent += `
    <div class="word-actions">
        <button class="edit-btn" data-lesson="${lessonId}" data-index="${originalIndex}">Sửa</button>
        <button class="delete-btn" data-lesson="${lessonId}" data-index="${originalIndex}">Xóa</button>
        <button class="move-btn" data-lesson="${lessonId}" data-index="${originalIndex}">🔗</button>
        <button class="mastered-btn ${word.mastered ? 'mastered' : ''}" 
                data-lesson="${lessonId}" data-index="${originalIndex}">
            ${word.mastered ? '✓ Đã thuộc' : 'Đánh dấu'}
        </button>
    </div>
    `;
    
    wordCard.innerHTML = htmlContent;
    attachWordCardEvents(wordCard, lessonId, originalIndex);
    
    // Thêm sự kiện cho checkbox
    const checkbox = wordCard.querySelector('.word-checkbox');
    checkbox.addEventListener('change', function() {
        const lessonId = parseInt(this.dataset.lesson);
        const wordIndex = parseInt(this.dataset.index);
        
        if (this.checked) {
            selectedWords.push({ lessonId, wordIndex });
        } else {
            selectedWords = selectedWords.filter(sw => 
                !(sw.lessonId === lessonId && sw.wordIndex === wordIndex)
            );
        }
        
        currentBulkLessonId = lessonId;
        updateBulkActionsPanel();
    });
    
    return wordCard;
}
function bulkDeleteWords() {
    if (selectedWords.length === 0) return;
    
    if (confirm(`Bạn có chắc muốn xóa ${selectedWords.length} từ này?`)) {
        // Sắp xếp theo index giảm dần để tránh lỗi khi xóa
        selectedWords.sort((a, b) => b.wordIndex - a.wordIndex);
        
        selectedWords.forEach(sw => {
            const lesson = lessons.find(l => l.id === sw.lessonId);
            if (lesson) {
                lesson.vocabulary.splice(sw.wordIndex, 1);
            }
        });
        
        saveDataToStorage();
        showLessonWords(currentBulkLessonId);
        selectedWords = [];
        updateBulkActionsPanel();
        
        showMessage(`Đã xóa ${selectedWords.length} từ thành công!`, 'success');
    }
}
function showToast(message, type = 'info') {
    // Tạo toast container nếu chưa tồn tại
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        `;
        document.body.appendChild(toastContainer);
    }

    // Tạo toast element
    const toast = document.createElement('div');
    toast.style.cssText = `
        background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
        color: white;
        padding: 12px 20px;
        border-radius: 4px;
        margin-bottom: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: opacity 0.3s;
        opacity: 0;
        max-width: 300px;
        word-wrap: break-word;
    `;
    toast.textContent = message;

    // Thêm toast vào container
    toastContainer.appendChild(toast);

    // Hiện toast với hiệu ứng
    setTimeout(() => {
        toast.style.opacity = '1';
    }, 10);

    // Tự động ẩn sau 0.5 giây
    setTimeout(() => {
        toast.style.opacity = '0';
        // Xóa toast sau khi ẩn
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 1500);
}


function bulkMoveWords() {
    if (selectedWords.length === 0) return;
    
    
    // Tạo popup với giao diện được cải thiện
    const popup = document.createElement('div');
    popup.className = 'bulk-move-popup';
    popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--popup-bg, white);
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        z-index: 10000;
        min-width: 400px;
        max-width: 90vw;
        max-height: 80vh;
        overflow-y: auto;
        border: 1px solid var(--border-color, #e0e0e0);
        font-family: inherit;
    `;
    
    popup.innerHTML = `
        <div class="bulk-move-header">
            <h3 style="margin: 0 0 15px 0; color: var(--text-primary, #333); font-size: 1.5em;">
                📦 Đã chọn [${selectedWords.length}] từ

        </div>
        
        <div class="bulk-move-content">
 
            </label>
            <select id="targetLessonSelect" class="bulk-move-select">
                ${lessons.map(lesson => 
                    `<option value="${lesson.id}" ${lesson.id === currentBulkLessonId ? 'disabled' : ''}>
                        ${lesson.title} ${lesson.id === currentBulkLessonId ? '(Bài hiện tại)' : ''}
                    </option>`
                ).join('')}
            </select>
            
            <div class="selected-words-preview" style="margin-top: 20px; max-height: 150px; overflow-y: auto;">
                <div style="font-weight: 600; margin-bottom: 10px; color: var(--text-primary, #333);">
                    Các từ sẽ chuyển [${selectedWords.length}] từ:
                </div>
                <div id="selectedWordsList" style="font-size: 0.9em; color: var(--text-secondary, #666);">
                    <!-- Danh sách từ sẽ được thêm bằng JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="bulk-move-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 0px; padding-top: 15px; border-top: 1px solid var(--border-color, #e0e0e0);">
            <button id="cancelBulkMove" class="bulk-move-btn secondary">Hủy</button>
            <button id="confirmBulkMove" class="bulk-move-btn primary">Xác nhận</button>
        </div>
    `;
    
    document.body.appendChild(popup);
    
    // Thêm CSS cho popup nếu chưa có
    if (!document.getElementById('bulk-move-styles')) {
        const styles = document.createElement('style');
        styles.id = 'bulk-move-styles';
        styles.textContent = `
            .bulk-move-popup {
                --popup-bg: white;
                --text-primary: #333;
                --text-secondary: #666;
                --border-color: #e0e0e0;
                --primary-btn-bg: #3498db;
                --primary-btn-hover: #2980b9;
                --secondary-btn-bg: #95a5a6;
                --secondary-btn-hover: #7f8c8d;
            }
            
            .bulk-move-select {
                width: 100%;
                padding: 10px 12px;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                background: var(--popup-bg);
                color: var(--text-primary);
                font-size: 14px;
                transition: border-color 0.2s;
            }
            
            .bulk-move-select:focus {
                outline: none;
                border-color: #3498db;
                box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            }
            
            .bulk-move-btn {
                padding: 10px 20px;
                border: none;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .bulk-move-btn.primary {
                background: var(--primary-btn-bg);
                color: white;
            }
            
            .bulk-move-btn.primary:hover {
                background: var(--primary-btn-hover);
                transform: translateY(-1px);
            }
            
            .bulk-move-btn.secondary {
                background: var(--secondary-btn-bg);
                color: white;
            }
            
            .bulk-move-btn.secondary:hover {
                background: var(--secondary-btn-hover);
            }
            
            .selected-word-item {
                padding: 5px 0;
                border-bottom: 1px solid var(--border-color, #e0e0e0);
            }
            
            .selected-word-item:last-child {
                border-bottom: none;
            }

.bulk-move-popup::-webkit-scrollbar {
    width: 8px;
}

.bulk-move-popup::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.bulk-move-popup::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

.bulk-move-popup::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Tùy chỉnh thanh cuộn cho phần danh sách từ */
.selected-words-preview::-webkit-scrollbar {
    width: 6px;
}

.selected-words-preview::-webkit-scrollbar-track {
    background: #f8f9fa;
    border-radius: 3px;
}

.selected-words-preview::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
}

.selected-words-preview::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
}
        `;
        document.head.appendChild(styles);
    }
    
    // Hiển thị danh sách từ được chọn
    const selectedWordsList = document.getElementById('selectedWordsList');
    selectedWords.slice(0, 10).forEach(sw => { // Hiển thị tối đa 10 từ
        const lesson = lessons.find(l => l.id === sw.lessonId);
        const word = lesson?.vocabulary[sw.wordIndex];
        if (word) {
            const item = document.createElement('div');
            item.className = 'selected-word-item';
            item.textContent = `${word.chinese} - ${word.meaning}`;
            selectedWordsList.appendChild(item);
        }
    });
    
    if (selectedWords.length > 10) {
        const moreItem = document.createElement('div');
        moreItem.className = 'selected-word-item';
        moreItem.textContent = `... và ${selectedWords.length - 10} từ khác`;
        moreItem.style.fontStyle = 'italic';
        selectedWordsList.appendChild(moreItem);
    }
    
    // Xử lý sự kiện hủy
    document.getElementById('cancelBulkMove').addEventListener('click', function() {
        document.body.removeChild(popup);
    });
    
    // Xử lý sự kiện xác nhận
    document.getElementById('confirmBulkMove').addEventListener('click', function() {
        const targetLessonId = parseInt(document.getElementById('targetLessonSelect').value);
        const targetLesson = lessons.find(l => l.id === targetLessonId);
        
        if (!targetLesson) {
            showToast('Bài học đích không tồn tại!', 'error');
            return;
        }
        
        if (targetLessonId === currentBulkLessonId) {
            showToast('Không thể chuyển từ trong cùng bài học!', 'error');
            return;
        }
        
        // Hiển thị loading state
        const confirmBtn = document.getElementById('confirmBulkMove');
        confirmBtn.textContent = 'Đang xử lý...';
        confirmBtn.disabled = true;
        
        // Thực hiện chuyển từ (giữ nguyên logic xử lý từ code gốc)
        const wordsToMove = [...selectedWords];
        let movedCount = 0;
        let duplicateCount = 0;
        let errorCount = 0;
        
        wordsToMove.sort((a, b) => {
            if (a.lessonId === b.lessonId) {
                return b.wordIndex - a.wordIndex;
            }
            return a.lessonId - b.lessonId;
        });
        
        wordsToMove.forEach(sw => {
            const sourceLesson = lessons.find(l => l.id === sw.lessonId);
            if (sourceLesson && sw.wordIndex < sourceLesson.vocabulary.length) {
                const word = sourceLesson.vocabulary[sw.wordIndex];
                
                if (targetLesson.vocabulary.some(w => w.chinese === word.chinese)) {
                    duplicateCount++;
                    return;
                }
                
                try {
                    targetLesson.vocabulary.unshift({...word});
                    sourceLesson.vocabulary.splice(sw.wordIndex, 1);
                    movedCount++;
                } catch (e) {
                    errorCount++;
                    console.error('Lỗi khi chuyển từ:', e);
                }
            }
        });
        
        // Lưu dữ liệu
        saveDataToStorage();
        
        // Cập nhật giao diện
        const affectedLessonIds = [...new Set([...wordsToMove.map(sw => sw.lessonId), targetLessonId])];
        affectedLessonIds.forEach(lessonId => {
            smartReloadLesson(lessonId);
        });
        
        // Reset và đóng popup
        selectedWords = [];
        updateBulkActionsPanel();
        document.body.removeChild(popup);
        
        // Hiển thị kết quả
        let message = `✅ Đã chuyển ${movedCount} từ thành công!`;
        if (duplicateCount > 0) {
            message += ` ⚠️ ${duplicateCount} từ trùng lặp không được chuyển.`;
        }
        if (errorCount > 0) {
            message += ` ❌ ${errorCount} lỗi xảy ra khi chuyển từ.`;
        }
        
        showToast(message, movedCount > 0 ? 'success' : 'error');
    });
    
    // Đóng popup khi click ra ngoài
    popup.addEventListener('click', function(e) {
        if (e.target === popup) {
            document.body.removeChild(popup);
        }
    });
    
    // Đóng popup khi nhấn Escape
    const escapeHandler = function(e) {
        if (e.key === 'Escape') {
            document.body.removeChild(popup);
            document.removeEventListener('keydown', escapeHandler);
        }
    };
    document.addEventListener('keydown', escapeHandler);
}

function forceUpdateLessonDisplay(lessonId) {
    // Cập nhật ngay lập tức không cần điều kiện
    if (currentDictionaryLessonId === lessonId) {
        const wordsContainer = document.getElementById(`dictionaryWords-${lessonId}`);
        if (wordsContainer) {
            // Xóa và render lại toàn bộ
            showLessonWords(lessonId);
        }
    }
    
    // Cập nhật sidebar nếu cần
    renderLessonSidebar();
}

// Hàm đổi trạng thái nhiều từ
function bulkToggleStatus() {
    if (selectedWords.length === 0) return;
    
    selectedWords.forEach(sw => {
        const lesson = lessons.find(l => l.id === sw.lessonId);
        if (lesson && sw.wordIndex < lesson.vocabulary.length) {
            lesson.vocabulary[sw.wordIndex].mastered = !lesson.vocabulary[sw.wordIndex].mastered;
        }
    });
    
    saveDataToStorage();
    showLessonWords(currentBulkLessonId);
    selectedWords = [];
    updateBulkActionsPanel();
    
    showMessage(`Đã cập nhật trạng thái ${selectedWords.length} từ!`, 'success');
}


function attachWordCardEvents(wordCard, lessonId, originalIndex) {
    // Sự kiện sửa từ
    const editBtn = wordCard.querySelector('.edit-btn');
    editBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        editWord(lessonId, originalIndex);
    });
    
    // Sự kiện xóa từ
    const deleteBtn = wordCard.querySelector('.delete-btn');
    deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        deleteWord(lessonId, originalIndex);
    });
    
    // Sự kiện chuyển bài
    const moveBtn = wordCard.querySelector('.move-btn');
    moveBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        showMoveOptions(lessonId, originalIndex, e);
    });
    
    // Sự kiện đánh dấu đã thuộc
    const masteredBtn = wordCard.querySelector('.mastered-btn');
    masteredBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMastered(lessonId, originalIndex);
    });
}


function updateRemainingWords() {
  if (!currentLesson) return;
  
  // Luôn lọc từ đã thuộc mà không cần kiểm tra toggle
  remainingWords = [...currentLesson.vocabulary].filter(word => !word.mastered);
  
  shuffleArray(remainingWords);
  remainingWords = remainingWords.slice(0, wordCount);
  
  // Reset game state nếu đang chơi
  if (gameActive) {
    currentWordIndex = 0;
    nextWordIndex = 1;
  }
}
function optimizedReloadLesson(lessonId) {
    if (lessonId === 2 || lessonId === 10 || lessonId === 13 || lessonId === 14) return; // KHÔNG reload bài 10
    
    const lesson = lessons.find(l => l.id === lessonId);
    if (!lesson) return;
    
    // Chỉ reload nếu bài học có ít hơn 500 từ để tránh lag
    if (lesson.vocabulary.length < 500) {
        smartReloadLesson(lessonId);
    } else {
        // Với bài học nhiều từ, chỉ cập nhật số lượng
        const wordCountElement = document.querySelector('.word-count');
        if (wordCountElement) {
            wordCountElement.textContent = lesson.vocabulary.length + ' từ';
        }
    }
}

function toggleMastered(lessonId, wordIndex) {
    const lesson = lessons.find(l => l.id === lessonId);
    if (lesson && wordIndex < lesson.vocabulary.length) {
        lesson.vocabulary[wordIndex].mastered = !lesson.vocabulary[wordIndex].mastered;
        saveDataToStorage();
        
        // CHỈ CẬP NHẬT NÚT, KHÔNG RELOAD TOÀN BỘ
        const masteredBtn = document.querySelector(`.mastered-btn[data-lesson="${lessonId}"][data-index="${wordIndex}"]`);
        if (masteredBtn) {
            masteredBtn.textContent = lesson.vocabulary[wordIndex].mastered ? '✓ Đã thuộc' : 'Đánh dấu';
            masteredBtn.classList.toggle('mastered', lesson.vocabulary[wordIndex].mastered);
        }
         smartReloadLesson(lessonId);
    }
}
function filterWords(searchTerm) {
    const lesson = lessons.find(l => l.id == currentDictionaryLessonId);
    if (!lesson) return;

    // Nếu searchTerm rỗng, hiển thị lại toàn bộ từ
    if (!searchTerm.trim()) {
        filteredWords = lesson.vocabulary.map((word, index) => ({ 
            word: word, 
            originalIndex: index 
        }));
    } else {
        const lowerSearchTerm = searchTerm.toLowerCase();
        
        // Tách thành 2 nhóm: ưu tiên và không ưu tiên
        let priorityResults = []; // Chứa kết quả từ chinese, pinyin, meaning
        let secondaryResults = []; // Chứa kết quả chỉ từ example
        
        lesson.vocabulary.forEach((word, index) => {
            const item = { word: word, originalIndex: index };
            
            // Kiểm tra trong các trường ưu tiên trước
            const inChinese = word.chinese.toLowerCase().includes(lowerSearchTerm);
            const inPinyin = word.pinyin.toLowerCase().includes(lowerSearchTerm);
            const inMeaning = word.meaning.toLowerCase().includes(lowerSearchTerm);
            const inExample = word.example && word.example.toLowerCase().includes(lowerSearchTerm);
            
            if (inChinese || inPinyin || inMeaning) {
                // Thêm vào nhóm ưu tiên
                priorityResults.push(item);
            } else if (inExample) {
                // Thêm vào nhóm thứ cấp
                secondaryResults.push(item);
            }
        });
        
        // Kết hợp kết quả: ưu tiên trước, thứ cấp sau
        filteredWords = [...priorityResults, ...secondaryResults];
    }

    // Reset container và tải lại
    const wordsDiv = document.getElementById(`dictionaryWords-${currentDictionaryLessonId}`);
    wordsDiv.innerHTML = '';
    
    currentDisplayedCount = 0;
    loadMoreWords(currentDictionaryLessonId);
}





// Sửa từ
function editWord(lessonId, wordIndex) {
    const word = lessons.find(l => l.id === lessonId).vocabulary[wordIndex];
    
    // TÌM THẺ TỪ ĐÚNG CÁCH: Duyệt qua tất cả thẻ từ để tìm đúng index
    const wordCards = document.querySelectorAll(`#dictionaryWords-${lessonId} .word-card`);
    let wordCard = null;
    
    for (const card of wordCards) {
        const editBtn = card.querySelector('.edit-btn');
        if (editBtn && parseInt(editBtn.dataset.index) === wordIndex) {
            wordCard = card;
            break;
        }
    }
    
    if (!wordCard) {
        console.error('Không tìm thấy thẻ từ để sửa');
        return;
    }

    wordCard.innerHTML = `
        <div class="edit-word-form">
            <div>
                <label>Chữ Hán:</label>
                <input type="text" id="editChinese-${lessonId}-${wordIndex}" value="${word.chinese}" required>
            </div>
            <div>
                <label>Pinyin:</label>
                <input type="text" id="editPinyin-${lessonId}-${wordIndex}" value="${word.pinyin}" required>
            </div>
            <div>
                <label>Nghĩa:</label>
                <input type="text" id="editMeaning-${lessonId}-${wordIndex}" value="${word.meaning}" required>
            </div>
            <div>
                <label>Ví dụ:</label>
                <input type="text" id="editExample-${lessonId}-${wordIndex}" value="${word.example || ''}">
            </div>
            <div class="edit-actions">
                <button class="save-btn" onclick="saveWord(${lessonId}, ${wordIndex})">Lưu</button>
                <button class="cancel-btn" onclick="cancelEdit(${lessonId}, ${wordIndex})">Hủy</button>
            </div>
        </div>
        <div id="pinyin-display" style="display:none;"></div>
    `;
        const pinyinInput = document.getElementById(`editPinyin-${lessonId}-${wordIndex}`);
    if (pinyinInput) {
        pinyinInput.addEventListener('keydown', function(e) {
            handleToneKeyInput(e, this);
        });
    }
}

// Hủy sửa từ
function cancelEdit(lessonId, wordIndex) {
    // CHỈ HỦY FORM EDIT, KHÔNG RELOAD TOÀN BỘ
    const wordCard = document.querySelector(`.edit-word-form`).closest('.word-card');
    if (wordCard) {
        const wordData = { 
            word: lessons.find(l => l.id === lessonId).vocabulary[wordIndex], 
            originalIndex: wordIndex 
        };
        const newWordCard = createWordCard(wordData, lessonId);
        wordCard.parentNode.replaceChild(newWordCard, wordCard);
    }
}
// Lưu từ đã sửa
function saveWord(lessonId, wordIndex) {
    const lesson = lessons.find(l => l.id === lessonId);
    if (lesson && wordIndex < lesson.vocabulary.length) {
        const wasMastered = lesson.vocabulary[wordIndex].mastered;

        lesson.vocabulary[wordIndex] = {
            chinese: document.getElementById(`editChinese-${lessonId}-${wordIndex}`).value,
            pinyin: document.getElementById(`editPinyin-${lessonId}-${wordIndex}`).value,
            meaning: document.getElementById(`editMeaning-${lessonId}-${wordIndex}`).value,
            example: document.getElementById(`editExample-${lessonId}-${wordIndex}`).value.trim(),
            mastered: wasMastered
        };
        
        saveDataToStorage();
        
        // CHỈ CẬP NHẬT THẺ TỪ ĐANG SỬA, KHÔNG RELOAD TOÀN BỘ
        const wordCard = document.querySelector(`.edit-word-form`).closest('.word-card');
        if (wordCard) {
            const wordData = { word: lesson.vocabulary[wordIndex], originalIndex: wordIndex };
            const newWordCard = createWordCard(wordData, lessonId);
            wordCard.parentNode.replaceChild(newWordCard, wordCard);
        }
        smartReloadLesson(lessonId);
    }
}


// Xóa từ
function deleteWord(lessonId, wordIndex) {
    if (confirm('Bạn có chắc muốn xóa từ này?')) {
        const lessonIndex = lessons.findIndex(l => l.id === lessonId);
        if (lessonIndex !== -1) {
            lessons[lessonIndex].vocabulary.splice(wordIndex, 1);
            
            saveDataToStorage();
            
            // CHỈ XÓA THẺ TỪ CỤ THỂ, KHÔNG RELOAD TOÀN BỘ
            const wordCard = document.querySelector(`.word-card [data-lesson="${lessonId}"][data-index="${wordIndex}"]`).closest('.word-card');
            if (wordCard) {
                wordCard.remove();
            }
            
            // Cập nhật số lượng từ
            const wordCountElement = document.querySelector('.word-count');
            if (wordCountElement) {
                wordCountElement.textContent = lessons[lessonIndex].vocabulary.length + ' từ';
            }
            
            // Nếu đang học bài này, cập nhật remainingWords
            if (currentLesson && currentLesson.id === lessonId) {
                remainingWords = [...lessons[lessonIndex].vocabulary];
                if (remainingWords.length === 0) {
                    endGame();
                }
            }
              smartReloadLesson(lessonId);
        }
    }
}

function smartReloadLesson(lessonId) {
    // KHÔNG reload nếu là bài 10
    if (lessonId === 13 || lessonId === 14) return;
    
    // Chỉ reload nếu đang xem bài học này trong từ điển
    if (currentDictionaryLessonId === lessonId) {
        // Giữ lại vị trí scroll hiện tại
        const dictionaryContent = document.getElementById('dictionaryContent');
        const scrollPosition = dictionaryContent.scrollTop;
        
        // Reload bài học
        showLessonWords(lessonId);
        
        // Khôi phục vị trí scroll sau khi reload
        setTimeout(() => {
            dictionaryContent.scrollTop = scrollPosition;
        }, 10);
    }
}
function createEnergyParticles() {
    // Đảm bảo DOM đã sẵn sàng
    requestAnimationFrame(() => {
        const container = document.getElementById('resultContainer');
        if (!container) return;

        // Thêm delay nhỏ đảm bảo render hoàn tất
        setTimeout(() => {
            const rect = container.getBoundingClientRect();
            const containerX = rect.left + window.scrollX;
            const containerY = rect.top + window.scrollY;

            // Số lượng hạt
            const particleCount = 200;
            
            // Tạo các hạt với độ trễ ngẫu nhiên
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'energy-particle';

                    // Kích thước và màu sắc
                    const size = Math.random() * 5 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.backgroundColor = `hsl(50, 100%, ${Math.floor(Math.random() * 30) + 50}%)`;

                    // Vị trí xuất phát ngẫu nhiên trên viền container
                    const side = Math.floor(Math.random() * 4);
                    let startX, startY;
                    
                    // Tính toán vị trí chính xác ngay từ đầu
const margin = 10; // Khoảng cách từ viền
switch (side) {
    case 0: // top
        startX = Math.random() * rect.width;
        startY = -size - margin;
        break;
    case 1: // right
        startX = rect.width + size + margin;
        startY = Math.random() * rect.height;
        break;
    case 2: // bottom
        startX = Math.random() * rect.width;
        startY = rect.height + size + margin;
        break;
    case 3: // left
        startX = -size - margin;
        startY = Math.random() * rect.height;
        break;
}
              // Đặt vị trí FIXED với tính toán chính xác
                    particle.style.position = 'fixed';
                    particle.style.left = `${containerX + startX}px`;
                    particle.style.top = `${containerY + startY}px`;
                    particle.style.willChange = 'transform, opacity'; // Tối ưu hiệu năng

                    // Animation
                    const angle = calculateAngle(side);
                    const distance = 50 + Math.random() * 100;
                    
                    particle.animate([
                        { transform: 'translate(0, 0)', opacity: 1 },
                        { transform: `translate(${Math.cos(angle)*distance}px, ${Math.sin(angle)*distance}px)`, opacity: 0 }
                    ], {
                        duration: 1000 + Math.random() * 2000,
                        easing: 'ease-out',
                        fill: 'forwards'
                    }).onfinish = () => particle.remove();

                    document.body.appendChild(particle);
                }, i * 50);
            }
        }, 50); // Thêm delay 50ms đảm bảo render hoàn tất
    });
}
function calculateAngle(side) {
    switch(side) {
        case 0: return Math.PI * 1.5 + (Math.random() - 0.5) * Math.PI / 2;
        case 1: return Math.random() * Math.PI - Math.PI/2;
        case 2: return Math.PI * 0.5 + (Math.random() - 0.5) * Math.PI / 2;
        case 3: return Math.PI + (Math.random() - 0.5) * Math.PI / 2;
    }
}
function showMoveOptionsForWrongWord(lessonId, chinese, event) {
    event.stopPropagation();
    
    // Xóa bảng chọn cũ nếu có
    document.querySelectorAll('.move-options').forEach(el => el.remove());
    
    const moveOptions = document.createElement('div');
    moveOptions.className = 'move-options';
    moveOptions.style.display = 'block';
    
    // Thêm tiêu đề
    const title = document.createElement('div');
    title.textContent = 'Chọn bài mới:';
    title.style.fontWeight = 'bold';
title.style.color = '#1e90ff';
    moveOptions.appendChild(title);
    
    // Phân loại bài học
    const normalLessons = lessons.filter(lesson => lesson.id <= 10);
    const specialLessons = lessons.filter(lesson => lesson.id > 10);
    
    // Hiển thị bài học từ 1 đến 10
    normalLessons.forEach(lesson => {
        if (lesson.id !== lessonId) {
            const option = document.createElement('div');
            option.className = 'move-option';
            option.textContent = lesson.title;
            option.onclick = (e) => {
                e.stopPropagation();
                moveWrongWordToLesson(lessonId, chinese, lesson.id);
                moveOptions.remove();
            };
            moveOptions.appendChild(option);
        }
    });
    
    // Tạo container cho bài học đặc biệt (ẩn ban đầu)
    const specialContainer = document.createElement('div');
    specialContainer.className = 'special-lessons-container';
    specialContainer.style.display = 'none';
    
    // Thêm bài học đặc biệt vào container
    specialLessons.forEach(lesson => {
        if (lesson.id !== lessonId) {
            const option = document.createElement('div');
            option.className = 'move-option special-lesson';
            option.textContent = lesson.title;
            option.onclick = (e) => {
                e.stopPropagation();
                moveWrongWordToLesson(lessonId, chinese, lesson.id);
                moveOptions.remove();
            };
            specialContainer.appendChild(option);
        }
    });
    
    // Thêm nút "Xem thêm" nếu có bài học đặc biệt
    if (specialLessons.length > 0) {
        const showMoreBtn = document.createElement('div');
        showMoreBtn.className = 'show-more-btn';

        showMoreBtn.style.cursor = 'pointer';
        showMoreBtn.style.padding = '6px';
        showMoreBtn.style.textAlign = 'center';
        showMoreBtn.style.backgroundColor = '#f0f0f0';
        showMoreBtn.style.borderRadius = '4px';
        showMoreBtn.style.marginTop = '5px';
        
        showMoreBtn.onclick = (e) => {
            e.stopPropagation();
            if (specialContainer.style.display === 'none') {
                specialContainer.style.display = 'block';
        
            } else {
                specialContainer.style.display = 'none';
          
            }
            
            // Tính toán lại vị trí sau khi thay đổi chiều cao
            repositionMoveOptions(moveOptions, event.target);
        };
        
        moveOptions.appendChild(showMoreBtn);
        moveOptions.appendChild(specialContainer);
    }
    
    document.body.appendChild(moveOptions);
    
    // Tính toán vị trí thông minh
    repositionMoveOptions(moveOptions, event.target);
    
    // Tự động đóng khi click ra ngoài
    setTimeout(() => {
        const closeHandler = (e) => {
            if (!moveOptions.contains(e.target) && e.target !== event.target) {
                moveOptions.remove();
                document.removeEventListener('click', closeHandler);
            }
        };
        document.addEventListener('click', closeHandler);
    }, 0);
}


// Hàm phụ trợ tính toán vị trí hiển thị
function repositionMoveOptions(moveOptions, targetElement) {
    const rect = targetElement.getBoundingClientRect();
    const windowHeight = window.innerHeight;
    const optionsHeight = moveOptions.offsetHeight;
    const windowWidth = window.innerWidth;
    const optionsWidth = moveOptions.offsetWidth;

    // Tính toán vị trí top
    let top;
    if (rect.bottom + optionsHeight > windowHeight) {
        // Hiển thị phía trên nếu không đủ chỗ phía dưới
        top = rect.top - optionsHeight;
    } else {
        // Hiển thị phía dưới nếu đủ chỗ
        top = rect.bottom;
    }

    // Tính toán vị trí left
    let left = rect.left;
    if (left + optionsWidth > windowWidth) {
        // Hiển thị lùi vào nếu vượt biên phải
        left = windowWidth - optionsWidth;
    }

    // Đặt vị trí
    moveOptions.style.position = 'fixed';
    moveOptions.style.top = `${top}px`;
    moveOptions.style.left = `${left}px`;
    moveOptions.style.zIndex = '10000';
}
// ========== HÀM CHUYỂN TỪ SAI SANG BÀI KHÁC ========== //
function moveWrongWordToLesson(fromLessonId, chinese, toLessonId) {
  const fromLesson = lessons.find(l => l.id === fromLessonId);
  const toLesson = lessons.find(l => l.id === toLessonId);
  
  if (fromLesson && toLesson) {
    const wordIndex = fromLesson.vocabulary.findIndex(word => word.chinese === chinese);
    if (wordIndex !== -1) {
      const word = fromLesson.vocabulary[wordIndex];
      
      // THÊM KIỂM TRA TRÙNG LẶP
      if (toLesson.vocabulary.some(w => w.chinese === word.chinese)) {
        alert('Từ này đã tồn tại trong bài học đích!');
        return;
      }
      
      fromLesson.vocabulary.splice(wordIndex, 1);
      toLesson.vocabulary.unshift(word);
      
      // Xóa từ khỏi danh sách sai
      const wrongIndex = wrongWords.findIndex(w => 
        w.lessonId === fromLessonId && w.chinese === chinese
      );
      if (wrongIndex !== -1) {
        wrongWords.splice(wrongIndex, 1);
      }
      
      // Lưu dữ liệu
      saveDataToStorage();
      localStorage.setItem('wrongWords', JSON.stringify(wrongWords));
      renderWrongWordsList();
    }
  }
}

// ========== CẬP NHẬT GIAO DIỆN TỪ SAI ========== //
function renderWrongWordsList() {
    const wrongWordsContainer = document.getElementById('wrongWords');
    // QUAN TRỌNG: Xóa toàn bộ nội dung cũ trước khi render lại
    wrongWordsContainer.innerHTML = '';
    
    // Nếu không có từ sai, hiển thị thông báo
    if (wrongWords.length === 0) {
        wrongWordsContainer.innerHTML += '<div>Đã chuyển hết các từ sai!</div>';
        return;
    }
    // Duyệt qua từng từ sai và thêm vào danh sách
    wrongWords.forEach(word => {
        const wrongWordElement = document.createElement('div');
        wrongWordElement.className = 'wrong-word';
wrongWordElement.innerHTML = `
    <div style="display: flex; justify-content: space-between; width: 100%;">
        <div>
            <strong>${word.chinese}</strong>
            <div style="color:#747d8c; font-size:16px;">${colorizePinyin(word.pinyin)}</div>
        </div>
        <div style="text-align: right;">
            ${capitalizeVietnamese(word.meaning)}
        </div>
    </div>
    <button class="move-btn">🔗</button>
`;
        // Gắn sự kiện cho nút chuyển bài
        const moveBtn = wrongWordElement.querySelector('.move-btn');
        moveBtn.addEventListener('click', (e) => {
            showMoveOptionsForWrongWord(word.lessonId, word.chinese, e);
        });
        
        wrongWordsContainer.appendChild(wrongWordElement);
    });
}

// ========== HÀM KẾT THÚC GAME ========== //
function endGame() {

if (!gameActive) return;
  updateHighScore(correctAnswers);
gameActive = false;
toggleHeightSlider(false);
clearInterval(wordTimer);
// Ẩn các phần tử không cần thiết
    // Sửa cách ẩn các phần tử
    document.getElementById('wordCounter').style.display = 'none';
    document.querySelector('.word-display').style.display = 'none';
    document.getElementById('pinyinIndicator').style.display = 'none';
    document.querySelector('.time-bar-container').style.display = 'none';
    document.querySelector('.input-area').style.display = 'none';
    document.getElementById('radicalAnalysis').style.display = 'none';


// Thêm từ hiện tại vào danh sách sai nếu còn từ
if (remainingWords.length > 0 && currentWordIndex >= 0) {
const currentWord = remainingWords[currentWordIndex];
if (!wrongWords.some(w => w.chinese === currentWord.chinese)) {
wrongWords.push({
...currentWord,
lessonId: currentLesson.id
});

}
}

 const resultContainer = document.getElementById('resultContainer');
 resultContainer.classList.remove('victory');

  if (wrongWords.length === 0) {
    correctAnswers = totalWordsAttempted;
    document.getElementById('wrongWords').style.display = 'none';
    
    // Kích hoạt hiệu ứng chiến thắng
    resultContainer.classList.add('victory');
    
    // Cập nhật tiêu đề
    document.querySelector('.result-title').textContent = "太棒了";
    document.querySelector('.result-title').classList.add('victory-title');
    
    // Tạo hiệu ứng hạt
    createEnergyParticles();
  } else {
    document.getElementById('wrongWords').style.display = 'block';
    document.querySelector('.result-title').textContent = "结果";
    document.querySelector('.result-title').classList.remove('victory-title');
  }


// Hiển thị kết quả
document.getElementById('finalStats').textContent =
`Bạn đã viết đúng ${correctAnswers}/${totalWordsAttempted}🎯`;

renderWrongWordsList();

// Hiển thị màn hình kết quả
document.getElementById('gameArea').style.display = 'none';
document.getElementById('resultContainer').style.display = 'block';
}
function showMoveOptions(currentLessonId, wordIndex, event) {
    event.stopPropagation(); // Ngăn sự kiện nổi bọt
    
    // Xóa các move-options cũ nếu có
    document.querySelectorAll('.move-options').forEach(el => el.remove());
    
    const moveOptions = document.createElement('div');
    moveOptions.className = 'move-options';
    moveOptions.style.display = 'block'; // Hiển thị ngay lập tức
    
    // Thêm tiêu đề
    const title = document.createElement('div');
    title.textContent = 'Chọn bài mới:';
    title.style.fontWeight = 'bold';
    title.style.color = '#1e90ff';
    moveOptions.appendChild(title);
    
    // Phân loại bài học
    const normalLessons = lessons.filter(lesson => lesson.id <= 10);
    const specialLessons = lessons.filter(lesson => lesson.id > 10);
    
    // Hiển thị bài học từ 1 đến 10
    normalLessons.forEach(lesson => {
        if (lesson.id !== currentLessonId) {
            const option = document.createElement('div');
            option.className = 'move-option';
            option.textContent = lesson.title;
            option.onclick = (e) => {
                e.stopPropagation();
                moveWordToLesson(currentLessonId, wordIndex, lesson.id);
            };
            moveOptions.appendChild(option);
        }
    });
    
    // Tạo container cho bài học đặc biệt (ẩn ban đầu)
    const specialContainer = document.createElement('div');
    specialContainer.className = 'special-lessons-container';
    specialContainer.style.display = 'none'; // Ẩn ban đầu
    
    // Thêm bài học đặc biệt vào container
    specialLessons.forEach(lesson => {
        if (lesson.id !== currentLessonId) {
            const option = document.createElement('div');
            option.className = 'move-option special-lesson';
            option.textContent = lesson.title;
            option.onclick = (e) => {
                e.stopPropagation();
                moveWordToLesson(currentLessonId, wordIndex, lesson.id);
            };
            specialContainer.appendChild(option);
        }
    });
    
    // Thêm nút "Xem thêm" nếu có bài học đặc biệt
    if (specialLessons.length > 0) {
        const showMoreBtn = document.createElement('div');
        showMoreBtn.className = 'show-more-btn';

        showMoreBtn.style.cursor = 'pointer';
        showMoreBtn.style.padding = '6px';
        showMoreBtn.style.textAlign = 'center';
        showMoreBtn.style.backgroundColor = '#f0f0f0';
        showMoreBtn.style.borderRadius = '4px';
        showMoreBtn.style.marginTop = '5px';
        
        showMoreBtn.onclick = (e) => {
            e.stopPropagation();
            if (specialContainer.style.display === 'none') {
                specialContainer.style.display = 'block';
                
            } else {
                specialContainer.style.display = 'none';
                
            }
        };
        
        moveOptions.appendChild(showMoreBtn);
        moveOptions.appendChild(specialContainer);
    }
    
    // Thêm vào body trước khi tính toán kích thước
    document.body.appendChild(moveOptions);
    
    // Tính toán vị trí
    const btn = event.target;
    const rect = btn.getBoundingClientRect();
    const windowHeight = window.innerHeight;
    const optionsHeight = moveOptions.offsetHeight;
    const windowWidth = window.innerWidth;
    const optionsWidth = moveOptions.offsetWidth;

    // Tính toán vị trí top
    let top;
    if (rect.bottom + optionsHeight > windowHeight) {
        // Hiển thị phía trên nếu không đủ chỗ phía dưới
        top = rect.top - optionsHeight;
    } else {
        // Hiển thị phía dưới nếu đủ chỗ
        top = rect.bottom;
    }

    // Tính toán vị trí left
    let left = rect.left;
    if (left + optionsWidth > windowWidth) {
        // Hiển thị lùi vào nếu vượt biên phải
        left = windowWidth - optionsWidth;
    }

    // Đặt vị trí
    moveOptions.style.position = 'fixed';
    moveOptions.style.top = `${top}px`;
    moveOptions.style.left = `${left}px`;
    moveOptions.style.zIndex = '10000'; // Đảm bảo hiển thị trên các phần tử khác
    
    // Đóng khi click ra ngoài
    setTimeout(() => {
        const closeHandler = function(e) {
            if (!moveOptions.contains(e.target) && e.target !== btn) {
                moveOptions.remove();
                document.removeEventListener('click', closeHandler);
            }
        };
        document.addEventListener('click', closeHandler);
    }, 0);
}

function moveWordToLesson(fromLessonId, wordIndex, toLessonId) {
    const fromLesson = lessons.find(l => l.id === fromLessonId);
    const toLesson = lessons.find(l => l.id === toLessonId);
    
    if (fromLesson && toLesson) {
        const word = fromLesson.vocabulary[wordIndex];
        
        if (toLesson.vocabulary.some(w => w.chinese === word.chinese)) {
            alert('Từ này đã tồn tại trong bài học đích!');
            return;
        }
        
        fromLesson.vocabulary.splice(wordIndex, 1);
        toLesson.vocabulary.unshift(word); 
        
        saveDataToStorage();
        
        // CHỈ XÓA THẺ TỪ Ở BÀI NGUỒN, KHÔNG RELOAD TOÀN BỘ
        const wordCard = document.querySelector(`.word-card [data-lesson="${fromLessonId}"][data-index="${wordIndex}"]`).closest('.word-card');
        if (wordCard) {
            wordCard.remove();
        }
        
        // Cập nhật số lượng từ cho bài nguồn
        const wordCountElement = document.querySelector('.word-count');
        if (wordCountElement) {
            wordCountElement.textContent = fromLesson.vocabulary.length + ' từ';
        }

        // Ẩn danh sách chuyển bài
        document.querySelectorAll('.move-options').forEach(el => el.remove());
        smartReloadLesson(fromLessonId);
        smartReloadLesson(toLessonId);
    }
}


// ========== HÀM HIỂN THỊ TỪ ========== //
let currentDisplayedWord = null;
let isWordTransitioning = false;
function displayWord() {
 hasShownPinyin = false;


    requestAnimationFrame(() => {
        const currentWord = remainingWords[currentWordIndex];
       isSpeaking = false; 
        
        // CHỈ SỬA DÒNG NÀY: không dùng force, chỉ phát khi âm thanh bật
if (isSoundOn && preSpeak) {
    if (listenWriteMode) {
        speakWithEffect(currentWord.chinese);
    } else {
        speak(currentWord.chinese);
    }
}
        // Xử lý preview (nextword) - THÊM RESET TRANSFORM
        const preview = document.getElementById('nextWordPreview');
        preview.style.animation = 'none';
        preview.style.transform = 'translateX(-100px)'; // ← THÊM DÒNG NÀY
        void preview.offsetWidth; // Trigger reflow
        updatePreview(); 
        preview.style.opacity = '0';

        displayRadicalAnalysis(currentWord.chinese);

        const targetChar = document.getElementById('targetCharacter');
        const meaningElement = document.getElementById('meaningText');
        const vietnameseContainer = document.getElementById('vietnameseMeaning');

        // Reset opacity và animation cho cả 3 phần tử
        targetChar.style.opacity = '0';
        vietnameseContainer.style.opacity = '0';
        preview.style.opacity = '0';
        
        // Reset animation và transform cho meaning container
        vietnameseContainer.style.animation = 'none';
        vietnameseContainer.style.transform = 'translateX(-100px)'; // ← THÊM DÒNG NÀY
        void vietnameseContainer.offsetWidth;

        // Xử lý hoán đổi hiển thị
        if (swapDisplay) {
            targetChar.textContent = capitalizeVietnamese(currentWord.meaning);
            meaningElement.textContent = currentWord.chinese;
        } else {
            targetChar.textContent = currentWord.chinese;
            meaningElement.textContent = capitalizeVietnamese(currentWord.meaning);
        }

        if (showVietnamese) {
            meaningElement.style.display = 'inline';
        } else {
            meaningElement.style.display = 'none';
        }

        void targetChar.offsetWidth; // Trigger reflow

        requestAnimationFrame(() => {
            // Áp dụng opacity cho cả 3 phần tử
            targetChar.style.opacity = '1';
            vietnameseContainer.style.opacity = '1';
            preview.style.opacity = '1';

            // CHỈ targetChar dùng hiệu ứng fade (chữ Hán)
            if (swapDisplay) {
                targetChar.classList.add('vietnamese-intro');
            } else {
                targetChar.classList.add('chinese-intro');
            }
            
            // Meaning và Nextword DÙNG CÙNG HIỆU ỨNG SLIDE
            preview.style.animation = 'slideInFromLeft 0.6s forwards';
            vietnameseContainer.style.animation = 'slideInFromLeft 0.6s forwards';
            
            // Xóa class sau khi animation kết thúc (chỉ cho targetChar)
            setTimeout(() => {
                requestAnimationFrame(() => {
                    targetChar.classList.remove('chinese-intro', 'vietnamese-intro');
                });
            }, 600);
        });

        currentDisplayedWord = currentWord.chinese;

        // Kiểm tra kết thúc game
        if (remainingWords.length === 0 || currentWordIndex >= remainingWords.length) {
            endGame();
            return;
        }

        // Cập nhật từ hiện tại
        requestAnimationFrame(() => {
            document.getElementById('pinyinTooltip').style.display = 'none';
            document.getElementById('chineseInput').value = '';
            document.getElementById('chineseInput').focus();
        });
    });
}



// ========== HÀM KIỂM TRA CÂU TRẢ LỜI ========== //
let hasShownPinyin = false;
let correctStreak = 0;
let maxStreak = 0;
function checkAnswer() {
    if (!gameActive || remainingWords.length === 0) return;

    const userAnswer = document.getElementById('chineseInput').value.trim();
    const currentWord = remainingWords[currentWordIndex];

    const targetChar = document.getElementById('targetCharacter');
    const vietnameseElement = document.getElementById('vietnameseMeaning');

    // Reset animation nếu cần
    if (targetChar.classList.contains('correct-answer') || targetChar.classList.contains('wrong-answer')) {
        targetChar.style.animation = 'none';
        void targetChar.offsetWidth;
        targetChar.style.animation = '';
    }

    targetChar.classList.remove('correct-answer', 'wrong-answer');

    isCorrect = (currentLesson.id === 11 || currentLesson.id === 12)
        ? userAnswer === currentWord.pinyin
        : (currentLesson.id === 13)
            ? userAnswer.toLowerCase() === currentWord.meaning.toLowerCase()
            : userAnswer === currentWord.chinese;
    
    if (isCorrect) {
        if (!hasShownPinyin) {
            correctAnswers++;
            correctStreak++; // TĂNG STREAK KHI ĐÚNG
            maxStreak = Math.max(maxStreak, correctStreak);
            
            // KIỂM TRA VÀ HIỂN THỊ Khen thưởng
            checkAndShowReward();
        }
        
        // Xử lý tooltip theo chế độ
        if (listenWriteMode) {
            // Chế độ nghe: giữ nguyên chữ Hán trong tooltip, không hiển thị pinyin
            document.getElementById('pinyinTooltip').classList.remove('incorrect-pinyin');
            // Có thể thêm class 'correct-chinese' nếu muốn, nhưng hiện tại không có
        } else {
            // Chế độ thường: hiển thị pinyin trong tooltip
            document.getElementById('pinyinTooltip').classList.remove('incorrect-pinyin');
            document.getElementById('pinyinTooltip').classList.add('correct-pinyin');
            document.getElementById('pinyinTooltip').innerHTML = colorizePinyin(currentWord.pinyin) + " - ";
            document.getElementById('pinyinTooltip').style.display = 'inline';
        }
        
        // Đảm bảo meaning hiển thị (trong chế độ nghe nó đã hiển thị, trong chế độ thường có thể đang ẩn)
        document.getElementById('meaningText').style.display = 'inline';
        
        document.getElementById('wordCounter').classList.remove('incorrect-pinyin2');
        document.getElementById('wordCounter').classList.add('correct-pinyin2');
        
        targetChar.classList.add('correct-answer');
        if (isSoundOn && postSpeak) {
            speak(currentWord.chinese);
        }

        hasShownPinyin = false;

        setTimeout(() => {
            targetChar.classList.remove('correct-answer');
            nextWord(false);
        }, 500);

    } else {
        // RESET STREAK KHI SAI
        correctStreak = 0;
        
        document.getElementById('pinyinTooltip').classList.remove('correct-pinyin');
        document.getElementById('pinyinTooltip').classList.add('incorrect-pinyin');
        document.getElementById('wordCounter').classList.remove('correct-pinyin2');
        document.getElementById('wordCounter').classList.add('incorrect-pinyin2');
        targetChar.classList.add('wrong-answer');

        // Luôn thêm vào danh sách sai nếu là lần đầu
        if (!hasShownPinyin && !wrongWords.some(w => w.chinese === currentWord.chinese)) {
            wrongWords.push({
                ...currentWord,
                lessonId: currentLesson.id
            });
        }

        if (pinyinShowCount <= 0) {
            if (isSoundOn && postSpeak) {
            speak(currentWord.chinese);
                }
            setTimeout(() => {
                targetChar.classList.remove('wrong-answer');
                nextWord(true);
            }, 390);
            return;
        }

        if (!hasShownPinyin) {
            if (isSoundOn && postSpeak) {
            speak(currentWord.chinese);
            }
            showPinyin();
            hasShownPinyin = true;
            document.getElementById('chineseInput').value = '';
            document.getElementById('chineseInput').focus();
        } else {
            setTimeout(() => {
                if (isSoundOn && postSpeak) {
                speak(currentWord.chinese);
                }
                targetChar.classList.remove('wrong-answer');
                nextWord(true);
                hasShownPinyin = false;
            }, 390);
        }
    }
}
function checkAndShowReward() {
    const specialMilestones = [5, 10, 20, 30, 50, 75, 100, 125, 150, 200, 300];
    if (specialMilestones.includes(correctStreak) || (correctStreak >= 300 && correctStreak % 50 === 0)) {
        showRewardEffect(correctStreak);
    }
}

function showRewardEffect(streak) {
    const specialMessages = {
        5:   { text: "Tuyệt vời! 5 từ đúng liên tiếp! 🎉", type: "good" },
        10:  { text: "Xuất sắc! 10 từ đúng liên tiếp! 🌟", type: "great" },
        20:  { text: "Thần đồng! 20 từ đúng liên tiếp! 🔥", type: "excellent" },
        30:  { text: "Bất khả chiến bại! 30 từ đúng! 💎", type: "amazing" },
        50:  { text: "Huyền thoại! 50 từ đúng liên tiếp! 🏆", type: "legendary" },
        75:  { text: "Siêu sao! 75 từ đúng! ⚡", type: "super" },
        100: { text: "VÔ ĐỊCH! 100 từ đúng! 🏅", type: "champion" },
        125: { text: "THIÊN TÀI! 125 từ đúng! 🌠", type: "genius" },
        150: { text: "HUYỀN THOẠI SỐNG! 150 từ đúng! 👑", type: "godlike" },
        200: { text: "BẤT TỬ! 200 từ đúng! 💫", type: "immortal" },
        300: { text: "SIÊU PHÀM! 300 từ đúng! 🚀", type: "divine" }
    };

    // Xác định kích thước
    let size = 'small';
    if (streak >= 100) size = 'xxxlarge';
    else if (streak >= 50) size = 'xxlarge';
    else if (streak >= 25) size = 'xlarge';
    else if (streak >= 15) size = 'large';
    else if (streak >= 10) size = 'medium';

    let message, type;
    if (specialMessages[streak]) {
        message = specialMessages[streak].text;
        type = specialMessages[streak].type;
    } else {
        message = `${streak} từ đúng liên tiếp! Cố gắng lên! 💪`;
        if (streak >= 50) type = 'champion';
        else if (streak >= 25) type = 'legendary';
        else if (streak >= 15) type = 'amazing';
        else if (streak >= 10) type = 'excellent';
        else if (streak >= 5) type = 'great';
        else type = 'good';
    }

    // Chỉ hiển thị thông báo nếu showRewardMessage được bật
    if (showRewardMessage) {
        const rewardElement = document.createElement('div');
        rewardElement.className = `reward-notification ${type} ${size}`;
        rewardElement.innerHTML = `
            <div class="reward-content">
                <span class="reward-text">${message}</span>
                <div class="reward-animation"></div>
            </div>
        `;
        document.body.appendChild(rewardElement);

        // Hiệu ứng xuất hiện
        setTimeout(() => {
            rewardElement.classList.add('show');
        }, 100);

        // Tự động ẩn sau 4 giây
        setTimeout(() => {
            rewardElement.classList.remove('show');
            setTimeout(() => rewardElement.remove(), 500);
        }, 4000);
    }

    // Chỉ bắn pháo hoa nếu showFirework được bật và streak đủ lớn
    if (showFirework && streak >= 5) {
        triggerFireworks(streak);
    }
}
// HÀM PHÁO HOA
function triggerFireworks(streak) {
    const intensity = Math.min(Math.floor(streak / 5), 15); // tối đa 15
    const count = Math.floor(intensity * 1.5) + 2;

    for (let i = 0; i < count; i++) {
        setTimeout(() => {
            createAdvancedFirework();
        }, i * 250);
    }
}

function createAdvancedFirework() {
    const firework = document.createElement('div');
    firework.className = 'firework';
    firework.style.left = Math.random() * 100 + 'vw';
    firework.style.top = Math.random() * 100 + 'vh';
    document.body.appendChild(firework);

    // Số lượng hạt chính
    const mainParticles = 20 + Math.floor(Math.random() * 30);
    const colors = [
        '#ff3333', '#33ff33', '#3333ff', '#ffff33',
        '#ff33ff', '#33ffff', '#ff9933', '#ff66b2',
        '#aaff33', '#33ffaa', '#aa33ff', '#ffaa33'
    ];

    // Tạo các hạt chính
    for (let i = 0; i < mainParticles; i++) {
        createParticle(firework, colors, true);
    }

    // Tạo thêm hạt nhỏ (nổ cấp 2)
    setTimeout(() => {
        const secondaryParticles = 10 + Math.floor(Math.random() * 20);
        for (let i = 0; i < secondaryParticles; i++) {
            createParticle(firework, colors, false);
        }
    }, 200);

    setTimeout(() => firework.remove(), 2000);
}

function createParticle(container, colors, isMain = true) {
    const particle = document.createElement('div');
    particle.className = 'particle';

    // Random hình dạng (70% tròn, 20% sao, 10% vuông)
    const rand = Math.random();
    if (rand < 0.7) {
        // tròn – giữ nguyên
    } else if (rand < 0.9) {
        particle.classList.add('star');
    } else {
        particle.classList.add('square');
    }

    // Kích thước ngẫu nhiên
    const size = isMain ? 4 + Math.random() * 8 : 2 + Math.random() * 4;
    particle.style.setProperty('--size', size + 'px');

    // Màu sắc gradient
    const color1 = colors[Math.floor(Math.random() * colors.length)];
    const color2 = colors[Math.floor(Math.random() * colors.length)];
    particle.style.setProperty('--color', color1);
    particle.style.background = `radial-gradient(circle at 30% 30%, white, ${color1})`;

    // Hướng bay
    const angle = Math.random() * Math.PI * 2;
    particle.style.setProperty('--angle', angle + 'rad');

    // Khoảng cách bay
    const distance = (isMain ? 80 + Math.random() * 120 : 40 + Math.random() * 80) + 'px';
    particle.style.setProperty('--distance', distance);

    // Thời gian bay
    const duration = (isMain ? 0.8 + Math.random() * 0.7 : 0.5 + Math.random() * 0.5) + 's';
    particle.style.setProperty('--duration', duration);

    container.appendChild(particle);
}
// ========== HÀM CHUYỂN TỪ TIẾP THEO ========== //
function nextWord(isSkipped) {
    if (remainingWords.length === 0) {
        endGame();
        return;
    } 

    currentDisplayedWord = null;
    clearInterval(wordTimer);
    
    const bonusTime = isSkipped ? wrongBonusTime : correctBonusTime;
    timeLeft = Math.min(timeLeft + bonusTime, timePerWord); // Giữ nguyên thời gian tối đa
    
    updateTimeBar();

    wordTimer = setInterval(() => {
        timeLeft -= 0.01; // Giảm 0.01 giây
        updateTimeBar();
        
        if (timeLeft <= 0) {
            clearInterval(wordTimer);
            handleTimeOut();
        }
    }, 10);
    if (isSkipped) {
        if (!wrongWords.some(w => w.chinese === remainingWords[currentWordIndex].chinese)) {
                  wrongWords.push({
        ...remainingWords[currentWordIndex],
        lessonId: currentLesson.id // Lưu ID bài học gốc
      });
        }
                correctStreak = 0;
    }
    // Phần còn lại giữ nguyên
    totalWordsAttempted++;
    updateWordCounter();

  const targetChar = document.getElementById('targetCharacter');

  targetChar.classList.remove('slide-in');

  remainingWords.splice(currentWordIndex, 1);

    // Kiểm tra lại sau khi xóa
    if (remainingWords.length === 0) {
        endGame();
        return;
    }

    // Luôn đặt index về 0 vì mảng đã bị xóa phần tử
    currentWordIndex = 0;
    nextWordIndex = remainingWords.length > 1 ? 1 : 0;
    updatePreview();
    // Hiệu ứng chuyển từ
    document.getElementById('targetCharacter').classList.add('word-transition');

    setTimeout(() => {
        displayWord();
        document.getElementById('targetCharacter').classList.remove('word-transition');
    }, 0);
}




// ========== HÀM XÁO TRỘN MẢNG ========== //
function shuffleArray(array) {
for (let i = array.length - 1; i > 0; i--) {
const j = Math.floor(Math.random() * (i + 1));
[array[i], array[j]] = [array[j], array[i]];
}
return array;
}
document.getElementById('pinyinCount').addEventListener('change', function() {
  let value = parseInt(this.value);
  if (isNaN(value) || value < 0 || value > 100) {
    value = 20;
    this.value = value;
  }
  maxPinyinShowCount = value;
  pinyinShowCount = maxPinyinShowCount;
  saveTimeSettings();
  updatePinyinBoxes();
});
// ========== HÀM HIỂN THỊ PINYIN ========== //
let shownPinyinWords = []; 
function showPinyin() {
    const currentWord = remainingWords[currentWordIndex];
    if (shownPinyinWords.includes(currentWord.chinese)) return;

    const pinyinTooltip = document.getElementById('pinyinTooltip');
    const meaningText = document.getElementById('meaningText');

    // Xóa class cũ để tránh xung đột
    pinyinTooltip.classList.remove('correct-pinyin', 'incorrect-pinyin', 'chinese-hint', 'pinyin-tooltip-pop');
    meaningText.classList.remove('meaning-pop');

    if (listenWriteMode) {
        // --- Chế độ nghe: tooltip hiển thị chữ Hán (màu trắng) ---
        pinyinTooltip.innerHTML = currentWord.chinese+ '<span class="pinyin-separator"> -</span>';
        pinyinTooltip.classList.add('chinese-hint');
        pinyinTooltip.style.display = 'inline';

        // Hiển thị meaning với hiệu ứng
        meaningText.style.display = 'inline';
        meaningText.textContent = capitalizeVietnamese(currentWord.meaning);
        meaningText.classList.add('meaning-pop');
        // Xóa class sau khi animation kết thúc để có thể chạy lại lần sau
        meaningText.addEventListener('animationend', function() {
            meaningText.classList.remove('meaning-pop');
        }, { once: true });
    } else {
        // --- Chế độ thường: tooltip hiển thị pinyin (màu đỏ) ---
        pinyinTooltip.innerHTML = colorizePinyin(currentWord.pinyin) + '<span class="pinyin-separator"> - </span>';
        pinyinTooltip.classList.add('incorrect-pinyin');
        pinyinTooltip.style.display = 'inline';

        // Nếu đang ẩn meaning, hiện nó với hiệu ứng
        if (!showVietnamese) {
            meaningText.style.display = 'inline';
            meaningText.textContent = capitalizeVietnamese(currentWord.meaning);
            meaningText.classList.add('meaning-pop');
            meaningText.addEventListener('animationend', function() {
                meaningText.classList.remove('meaning-pop');
            }, { once: true });
        }
    }

    // --- Hiệu ứng pop cho tooltip (dùng class) ---
    pinyinTooltip.classList.add('pinyin-tooltip-pop');
    pinyinTooltip.addEventListener('animationend', function() {
        pinyinTooltip.classList.remove('pinyin-tooltip-pop');
    }, { once: true });

    // --- Cập nhật ô pinyin box (giữ nguyên code cũ) ---
    const boxes = document.querySelectorAll('.pinyin-box');
    const usedCount = maxPinyinShowCount - pinyinShowCount;

    if (boxes[usedCount]) {
        const box = boxes[usedCount];
        box.classList.remove('used', 'reveal');
        void box.offsetWidth; // force reflow
        box.classList.add('reveal');
        box.addEventListener('animationend', function() {
            box.classList.remove('reveal');
            box.classList.add('used');
        }, { once: true });
    }

    shownPinyinWords.push(currentWord.chinese);
    pinyinShowCount--;
}
document.getElementById('showRadicalAnalysis').addEventListener('change', function() {
  showRadicalAnalysis = this.checked;
  saveTimeSettings();

  // Cập nhật ngay lập tức
  if (gameActive && currentWordIndex >= 0) {
    if (showRadicalAnalysis) {
      displayRadicalAnalysis(remainingWords[currentWordIndex].chinese);
      document.getElementById('radicalAnalysis').style.display = 'block';
    } else {
      document.getElementById('radicalAnalysis').style.display = 'none';
    }
  }
});

function resetAddWordForm() {
document.getElementById('chineseInputModal').value = '';
document.getElementById('pinyinInputModal').value = '';
document.getElementById('meaningInputModal').value = '';
 document.getElementById('exampleInputModal').value = ''; 
}

function ensureExampleField() {
  lessons.forEach(lesson => {
    lesson.vocabulary.forEach(word => {
      if (!word.hasOwnProperty('example')) {
        word.example = "";
      }
      if (!word.hasOwnProperty('mastered')) {
        word.mastered = false;
      }
    });
  });
}
function updatePreviewVisibility() {
    const preview = document.getElementById('nextWordPreview');
    if (listenWriteMode) {
        preview.classList.add('hide-nextword');
    } else {
        preview.classList.remove('hide-nextword');
    }
}
function speakWithEffect(text) {
    // Phóng to chữ Hán
    const targetChar = document.getElementById('targetCharacter');
    targetChar.style.transition = 'transform 0.3s ease';
    targetChar.style.transform = 'scale(3)';
    
    // Phát âm
    speak(text, true);
    
    // Sau 0.3s, thu nhỏ lại
    setTimeout(() => {
        targetChar.style.transform = 'scale(1)';
        // Xóa transition sau khi hoàn tất để không ảnh hưởng các hiệu ứng khác
        setTimeout(() => {
            targetChar.style.transition = '';
        }, 300);
    }, 300);
}
document.addEventListener('DOMContentLoaded', function() {
loadDataFromStorage();
renderLessonSidebar();
updatePinyinBoxes();
loadTimeSettings();
initSpecialLessons(); 
displayRadicalAnalysis('');
ensureExampleField(); 
initInputHeightSlider();
initPinyinToneHandlers();
loadVoices();
    window.speechSynthesis.onvoiceschanged = loadVoices;
    // Đảm bảo voices được tải xong trước khi gọi speak
function waitForVoices() {
    return new Promise((resolve) => {
        let voices = window.speechSynthesis.getVoices();
        if (voices.length > 0) {
            resolve(voices);
        } else {
            window.speechSynthesis.onvoiceschanged = () => {
                resolve(window.speechSynthesis.getVoices());
            };
        }
    });
}
const autoPronounceCheckbox = document.getElementById('autoPronounce');
const listenWriteCheckbox = document.getElementById('listenWriteMode');

function syncListenWriteWithAutoPronounce() {
    const autoChecked = document.getElementById('autoPronounce').checked;
    const listenCheck = document.getElementById('listenWriteMode');
    
    if (!autoChecked) {
        // Nếu đang bật "Nghe viết", tắt nó và kích hoạt sự kiện change
        if (listenCheck.checked) {
            listenCheck.checked = false;
            listenCheck.dispatchEvent(new Event('change')); // Gọi change để cập nhật giao diện
        }
        listenCheck.disabled = true;
    } else {
        listenCheck.disabled = false;
    }
}
// Gọi lần đầu khi trang load
syncListenWriteWithAutoPronounce();

// Khi autoPronounce thay đổi
autoPronounceCheckbox.addEventListener('change', syncListenWriteWithAutoPronounce);

// Khi người dùng cố bật listenWrite nhưng autoPronounce đang tắt, tự động bật autoPronounce
listenWriteCheckbox.addEventListener('change', function() {
    if (this.checked && !autoPronounceCheckbox.checked) {
        autoPronounceCheckbox.checked = true;
        // Gọi lại hàm đồng bộ để cập nhật trạng thái disable (sẽ không cần vì đã bật autoPronounce)
        syncListenWriteWithAutoPronounce();
        // Kích hoạt sự kiện change của autoPronounce để các logic khác (nếu có) cập nhật
        autoPronounceCheckbox.dispatchEvent(new Event('change'));
    }
});
document.getElementById('listenWriteMode').addEventListener('change', function() {
    listenWriteMode = this.checked;
    if (listenWriteMode) {
        document.body.classList.add('listen-mode');
        // Tự động bật preSpeak, tắt postSpeak
        document.getElementById('preSpeak').checked = true;
        preSpeak = true;
        document.getElementById('postSpeak').checked = false;
        postSpeak = false;
    } else {
        document.body.classList.remove('listen-mode');
    }
    updatePreviewVisibility(); // Ẩn/hiện preview
    if (gameActive) {
        updatePreview();        // Cập nhật nội dung preview nếu đang chơi
        displayWord();          // Cập nhật lại từ hiện tại (để đồng bộ)
    }
    saveTimeSettings();
});
document.getElementById('showRewardMessage').addEventListener('change', function() {
    showRewardMessage = this.checked;
    saveTimeSettings();
});
document.getElementById('showFirework').addEventListener('change', function() {
    showFirework = this.checked;
    saveTimeSettings();
});
// Gọi sau khi DOM ready
waitForVoices().then((voices) => {
    console.log('Voices ready:', voices.length);
    loadVoices(); // hàm loadVoices hiện tại của bạn (giữ nguyên)
    // Bạn có thể gọi speak test ở đây nếu muốn
});
    // Sự kiện click vào biểu tượng bánh răng
document.getElementById('gearIcon').addEventListener('click', function(e) {
    e.stopPropagation(); // Quan trọng: ngăn sự kiện lan ra ngoài
    const voiceOptions = document.getElementById('voiceOptions');
    voiceOptions.classList.toggle('active');
});
    document.getElementById('bulkDeleteBtn').addEventListener('click', bulkDeleteWords);
    document.getElementById('bulkMoveBtn').addEventListener('click', bulkMoveWords);
    document.getElementById('bulkToggleStatusBtn').addEventListener('click', bulkToggleStatus);
// Thêm sự kiện click toàn trang để ẩn khi click ra ngoài
document.addEventListener('click', function(e) {
    const voiceOptions = document.getElementById('voiceOptions');
    const gearIcon = document.getElementById('gearIcon');
    
    // Ẩn nếu click không phải vào voiceOptions hoặc gearIcon
    if (!voiceOptions.contains(e.target) && e.target !== gearIcon) {
        voiceOptions.classList.remove('active');
    }
});

// Ngăn sự kiện click trong voiceOptions lan ra ngoài
document.getElementById('voiceOptions').addEventListener('click', function(e) {
    e.stopPropagation();
});

document.getElementById('voiceSelect').addEventListener('change', function() {
        const voiceURI = this.value;
        const voices = window.speechSynthesis.getVoices();
        
        if (voiceURI) {
            selectedVoice = voices.find(voice => voice.voiceURI === voiceURI);
            if (selectedVoice) {
                localStorage.setItem('selectedVoiceURI', voiceURI);
                console.log('Đã chọn giọng:', selectedVoice.name, 'Lang:', selectedVoice.lang);
                
                // Kiểm tra ngay lập tức
                speak('测试'); // Chữ "测试" để test giọng
            }
        } else {
            selectedVoice = null;
            localStorage.removeItem('selectedVoiceURI');
            console.log('Chuyển về giọng mặc định');
        }
    });
        document.getElementById('rateControl').addEventListener('input', function() {
        speechRate = parseFloat(this.value);
        document.getElementById('rateValue').textContent = speechRate;
    });
    
    // Sự kiện thay đổi độ cao
    document.getElementById('pitchControl').addEventListener('input', function() {
        speechPitch = parseFloat(this.value);
        document.getElementById('pitchValue').textContent = speechPitch;
    });
    
    // Sự kiện kiểm tra giọng nói
    document.getElementById('testButton').addEventListener('click', function() {
        speak("你好，你叫什么名字，今年你多少岁");
    });
    
    // Sự kiện thay đổi trạng thái âm thanh (đã có, nhưng cần đảm bảo cập nhật biểu tượng)
    document.getElementById('autoPronounce').addEventListener('change', function() {
        isSoundOn = this.checked;
        updateSoundIcon();
    });
document.getElementById('preSpeak').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('postSpeak').checked = false;
        postSpeak = false;
    }
    preSpeak = this.checked;
    saveTimeSettings();
});

document.getElementById('postSpeak').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('preSpeak').checked = false;
        preSpeak = false;
    }
    postSpeak = this.checked;
    saveTimeSettings();
});
    const savedWrongWords = localStorage.getItem('wrongWords');
    if (savedWrongWords) {
        try {
            wrongWords = JSON.parse(savedWrongWords);
        } catch (e) {
            console.error("Lỗi khi tải danh sách từ sai:", e);
            wrongWords = [];
        }
    }

document.getElementById('showExampleInstead').addEventListener('change', function() {
  showExampleInstead = this.checked;
  saveTimeSettings();
  
  // Cập nhật ngay lập tức nếu đang trong game
  if (gameActive) {
    updatePreview();
  }
});

document.getElementById('showVietnamese').addEventListener('change', function() {
  showVietnamese = this.checked;
  saveTimeSettings();

  if (document.getElementById('lessonSelection').style.display !== 'block') {
    document.getElementById('darkModeToggle').style.display = 'none';
  }
  if (document.getElementById('lessonSelection').style.display !== 'block') {
    document.getElementById('darkModeToggle').style.display = 'none';
  }
highScore = parseInt(localStorage.getItem('hanNguHighScore')) || 0;
document.getElementById('highScoreDisplay').textContent = `🏆 ${highScore}`;

  // Cập nhật ngay lập tức nếu đang trong game
  if (gameActive) {
    const meaningElement = document.getElementById('meaningText');
    if (showVietnamese) {
      meaningElement.style.display = 'inline';
    } else {
      meaningElement.style.display = 'none';
    }
  }
});
  document.getElementById('swapDisplay').addEventListener('change', function() {
    swapDisplay = this.checked;
    saveTimeSettings();
    
    // Cập nhật ngay lập tức nếu đang trong game
    if (gameActive) {
      displayWord();
    }
  });

let radicalDictionary = {};
const radicalLesson = lessons.find(lesson => lesson.id === 13);

if (radicalLesson) {
  // Chuyển đổi dữ liệu từ bài học thành dictionary
  radicalLesson.vocabulary.forEach(word => {
    radicalDictionary[word.chinese] = {
      pinyin: word.pinyin,
      meaning: word.meaning
    };
  });
}


document.getElementById('bulkAddBtn').addEventListener('click', processBulkAdd);

function processBulkAdd() {
  const text = document.getElementById('bulkAddWords').value.trim();
  const lessonId = parseInt(document.getElementById('lessonSelect').value);
  
  if (!text) {
    showMessage('Vui lòng nhập nội dung để thêm hàng loạt!', 'error');
    return;
  }

  const lesson = lessons.find(l => l.id === lessonId);
  if (!lesson) {
    showMessage('Không tìm thấy bài học!', 'error');
    return;
  }

  const lines = text.split('\n').filter(line => line.trim() !== '');
  let addedCount = 0;
  let duplicateCount = 0;
  let errorCount = 0;
  let errorDetails = [];

  // Tạo mảng từ mới trước để xử lý lỗi trước khi thêm
  const newWords = [];

  lines.forEach((line, index) => {
    const lineNumber = index + 1;
    const parts = line.split('|').map(item => item.trim());
    
    // Kiểm tra định dạng
    if (parts.length < 3) {
      errorCount++;
      errorDetails.push(`Dòng ${lineNumber}: Sai định dạng. Cần: Chữ Hán|Pinyin|Nghĩa|Ví dụ (tùy chọn)`);
      return;
    }
    
    const chinese = parts[0];
    const pinyin = parts[1] || ''; // SỬA: Đảm bảo không bị undefined
    const meaning = parts[2];
    const example = parts[3] || '';

    // Kiểm tra dữ liệu bắt buộc
    if (!chinese) {
      errorCount++;
      errorDetails.push(`Dòng ${lineNumber}: Chữ Hán không được để trống`);
      return;
    }
    
    if (!meaning) {
      errorCount++;
      errorDetails.push(`Dòng ${lineNumber}: Nghĩa không được để trống`);
      return;
    }

    // KIỂM TRA TRÙNG LẶP - CHỈ KIỂM TRA CHỮ HÁN (ĐÚNG)
    const isDuplicate = lesson.vocabulary.some(word => 
      word.chinese.toLowerCase() === chinese.toLowerCase()
    );
    
    if (isDuplicate) {
      duplicateCount++;
      errorDetails.push(`Dòng ${lineNumber}: Từ "${chinese}" đã tồn tại`);
      return;
    }

    // Thêm vào mảng từ mới
    newWords.push({
      chinese: chinese,
      pinyin: pinyin,
      meaning: meaning,
      example: example,
      mastered: false
    });
  });

  // THÊM TẤT CẢ TỪ MỚI VÀO BÀI HỌC
  if (newWords.length > 0) {
    lesson.vocabulary.unshift(...newWords);
    addedCount = newWords.length;
    
    // Lưu vào localStorage
    saveDataToStorage();
  }

  // Hiển thị kết quả
  let message = `✅ Đã thêm ${addedCount} từ mới!`;
  if (duplicateCount > 0) message += `\n⚠️ ${duplicateCount} từ đã tồn tại`;
  if (errorCount > 0) message += `\n❌ ${errorCount} dòng lỗi`;
  
  // Hiển thị chi tiết lỗi nếu có
  if (errorDetails.length > 0 && errorCount > 0) {
    const errorPopup = document.createElement('div');
    errorPopup.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      z-index: 10000;
      max-width: 500px;
      max-height: 400px;
      overflow-y: auto;
      font-family: Arial, sans-serif;
    `;
    
    errorPopup.innerHTML = `
      <h3 style="margin-top:0; color:#e74c3c;">Chi tiết lỗi (${errorCount} lỗi)</h3>
      <div style="margin-bottom:15px; color:#666; max-height: 200px; overflow-y: auto;">
        ${errorDetails.map(err => `<div style="margin-bottom:5px; font-size: 14px;">• ${err}</div>`).join('')}
      </div>
      <button onclick="this.parentElement.remove()" 
              style="padding:8px 16px; background:#3498db; color:white; border:none; border-radius:5px; cursor:pointer;">
        Đóng
      </button>
    `;
    
    document.body.appendChild(errorPopup);
  }
  
  showMessage(message.split('\n')[0], addedCount > 0 ? 'success' : 'error');
  
  // Reset textarea
  document.getElementById('bulkAddWords').value = '';
  
  // Cập nhật lại từ điển nếu đang mở
  if (document.getElementById('dictionaryModal').style.display === 'flex') {
    showLessonWords(lessonId);
  }
  
  // Cập nhật remainingWords nếu đang học bài này
  if (currentLesson && currentLesson.id === lessonId) {
    updateRemainingWords();
  }
}



// Thêm vào phần DOMContentLoaded
document.querySelectorAll('.catalog-tab').forEach(tab => {
  tab.addEventListener('click', function() {

    // Xóa active tất cả tab
    document.querySelectorAll('.catalog-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.catalog-content').forEach(c => c.classList.remove('active'));
    
    // Active tab được click
    this.classList.add('active');
    document.getElementById(`${this.dataset.tab}Tab`).classList.add('active');
  });
});
document.getElementById('backToLessonsBtn').addEventListener('click', function() {
  resetGame();
});

// Hiển thị nút thêm từ
document.getElementById('addWordSection').style.display = 'block';

// Khởi tạo màn hình chọn bài
initLessonSelection();

  // Lấy giá trị ban đầu từ input
  correctBonusTime = parseInt(document.getElementById('correctBonusTime').value) || 15;
  wrongBonusTime = parseInt(document.getElementById('wrongBonusTime').value) || 10;

  // Xử lý thay đổi thời gian - CHỈ CẦN 1 LẦN
  document.getElementById('correctBonusTime').addEventListener('change', function() {
    let value = parseInt(this.value);
    if (isNaN(value) || value < 1 || value > 30) {
      value = 15;
      this.value = value;
    }
    correctBonusTime = value;
     saveTimeSettings(); 
    console.log('Correct bonus time updated to:', correctBonusTime); // Debug
  });


document.getElementById('timePerWord').addEventListener('change', function() {
    let value = parseInt(this.value);
    if (isNaN(value) || value < 5 || value > 120) {
        value = 30;
        this.value = value;
    }
    timePerWord = value;
    saveTimeSettings();
    
    // Cập nhật thời gian nếu đang trong game
    if (gameActive) {
        timeLeft = timePerWord;
        updateTimeBar();
    }
});



  document.getElementById('wrongBonusTime').addEventListener('change', function() {
    let value = parseInt(this.value);
    if (isNaN(value) || value < 1 || value > 30) {
      value = 10;
      this.value = value;
    }
    wrongBonusTime = value;
  saveTimeSettings(); // Thêm dòng này
    console.log('Wrong bonus time updated to:', wrongBonusTime); // Debug
  });
// Ẩn màn hình game
document.getElementById('gameScreen').style.display = 'none';
document.getElementById('closeDictionary').addEventListener('click', function() {
document.getElementById('dictionaryModal').style.display = 'none';
});
document.getElementById('closeAddWordModal').addEventListener('click', function() {
  document.getElementById('addWordModal').style.display = 'none';
  resetAddWordForm();
});
// Khởi tạo dropdown chọn bài học
const lessonSelect = document.getElementById('lessonSelect');
lessons.forEach(lesson => {
const option = document.createElement('option');
option.value = lesson.id;
option.textContent = lesson.title;
lessonSelect.appendChild(option);
});

document.getElementById('addWordBtn').addEventListener('click', function() {
document.getElementById('addWordModal').style.display = 'flex';
});

document.getElementById('addWordCancel').addEventListener('click', function() {
document.getElementById('addWordModal').style.display = 'none';
resetAddWordForm();
});

document.getElementById('addWordForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const lessonId = parseInt(document.getElementById('lessonSelect').value);
  const chinese = document.getElementById('chineseInputModal').value.trim();
  const pinyin = document.getElementById('pinyinInputModal').value.trim(); 
  const meaning = document.getElementById('meaningInputModal').value.trim();
   const example = document.getElementById('exampleInputModal').value.trim(); 
 if (!chinese || !meaning) {
    showMessage('Vui lòng điền chữ Hán và nghĩa!', 'error');
    return;
  }

  if (isWordExist(lessonId, chinese)) {
    showMessage('Từ này đã có trong từ điển!', 'error');
    return;
  }

  const lesson = lessons.find(l => l.id === lessonId);
  if (lesson) {
    // THÊM TỪ VỚI PINYIN CÓ THỂ RỖNG
    lesson.vocabulary.unshift({
      chinese: chinese,
      pinyin: pinyin,
      meaning: meaning,
      example: example,
      mastered: false
    });

    saveDataToStorage();
    showMessage('✅ Đã thêm từ mới thành công!', 'success');
    resetAddWordForm();

    if (currentLesson && currentLesson.id === lessonId) {
      remainingWords = [...lesson.vocabulary];
    }
    initLessonSelection();
  }

});
document.getElementById('openCatalogBtn').addEventListener('click', function() {
  document.getElementById('lessonCatalog').style.display = 'flex';
  document.getElementById('catalogOverlay').style.display = 'block';
  renderCatalog();
});

document.getElementById('closeCatalog').addEventListener('click', function() {
  document.getElementById('lessonCatalog').style.display = 'none';
document.getElementById('catalogOverlay').style.display = 'none';
});

function renderCatalog() {
  const catalogList = document.getElementById('catalogList');
  catalogList.innerHTML = '';
  
  lessons.forEach(lesson => {
    const lessonItem = document.createElement('div');
    lessonItem.className = 'lesson-item';
    lessonItem.dataset.lessonId = lesson.id;
    
    // Áp dụng màu từ dữ liệu bài học
    const baseColor = lesson.color || generateColorForLesson(lesson.id);
    const gradientColor = darkenColor(baseColor, 20);
    lessonItem.style.background = `linear-gradient(45deg, ${baseColor}, ${gradientColor})`;
    lessonItem.style.color = 'white';
    
    const titleParts = lesson.title.split(':');
    const lessonNumber = titleParts[0].trim().replace(/^Bài\s+/i, '');
    const lessonTitle = titleParts.length > 1 ? titleParts[1].trim() : titleParts[0].trim();
    
    lessonItem.innerHTML = `
      <div class="lesson-number">${lessonNumber.replace('Bài', '')}</div>
      <div class="lesson-title">${lessonTitle}</div>
      <button class="edit-lesson-btn">✏️</button>
      <div class="edit-controls" style="display: none;">
        <input type="text" class="lesson-title-edit" value="${lessonTitle}">
      <div class="color-buttons-container">
        <div class="color-picker-container">
          <input type="color" class="lesson-color-edit" value="${baseColor}">
          <div class="color-preview" style="
            background: linear-gradient(45deg, ${baseColor}, ${gradientColor});
          "></div>
        </div>
        <div class="edit-buttons">
          <button class="save-lesson-btn">💾 Lưu</button>
          <button class="cancel-edit-btn">❌ Hủy</button>
        </div>
      </div>
    `;
    
    catalogList.appendChild(lessonItem);
    
    // Xử lý sự kiện chỉnh sửa
    const editBtn = lessonItem.querySelector('.edit-lesson-btn');
    const displayTitle = lessonItem.querySelector('.lesson-title');
    const editControls = lessonItem.querySelector('.edit-controls');
    const editInput = lessonItem.querySelector('.lesson-title-edit');
    const colorPicker = lessonItem.querySelector('.lesson-color-edit');
    const colorPreview = lessonItem.querySelector('.color-preview');
    const saveBtn = lessonItem.querySelector('.save-lesson-btn');
    const cancelBtn = lessonItem.querySelector('.cancel-edit-btn');
    
    // Cập nhật preview khi chọn màu
    colorPicker.addEventListener('input', function() {
      const newBaseColor = this.value;
      const newGradientColor = darkenColor(newBaseColor, 20);
      colorPreview.style.background = `linear-gradient(45deg, ${newBaseColor}, ${newGradientColor})`;
    });
    
    editBtn.addEventListener('click', function() {
      displayTitle.style.display = 'none';
      editBtn.style.display = 'none';
      editControls.style.display = 'block';
      editInput.focus();
    });
    
    saveBtn.addEventListener('click', function() {
      const newTitle = editInput.value.trim() ? `Bài ${lessonNumber}: ${editInput.value}` : `Bài ${lessonNumber}`;
      const newColor = colorPicker.value;
      
      // Cập nhật bài học
      lesson.title = newTitle;
      lesson.color = newColor;
      
      // Lưu dữ liệu
      saveDataToStorage();
      
      // Cập nhật giao diện catalog
      const newGradientColor = darkenColor(newColor, 20);
      lessonItem.style.background = `linear-gradient(45deg, ${newColor}, ${newGradientColor})`;
      
      // Cập nhật tiêu đề hiển thị
      const titleToShow = newTitle.split(':').length > 1 ? newTitle.split(':')[1].trim() : newTitle;
      displayTitle.textContent = titleToShow;
      
      displayTitle.style.display = 'block';
      editBtn.style.display = 'block';
      editControls.style.display = 'none';
      
      // Đồng bộ với các nơi khác
      updateLessonUI(lesson.id, newTitle, newColor);
    });
    
    cancelBtn.addEventListener('click', function() {
      // Khôi phục giá trị cũ
      editInput.value = lesson.title.split(':').length > 1 ? lesson.title.split(':')[1].trim() : lesson.title;
      colorPicker.value = baseColor;
      
      displayTitle.style.display = 'block';
      editBtn.style.display = 'block';
      editControls.style.display = 'none';
    });
  });
}

// Hàm cập nhật giao diện bài học
function updateLessonUI(lessonId, newTitle, newColor) {
  // Cập nhật nút bài học trong màn hình chọn
  const lessonBtn = document.querySelector(`.lesson-btn[data-lesson-id="${lessonId}"]`);
  if (lessonBtn) {
    const gradientColor = darkenColor(newColor, 30);
    const borderColor = darkenColor(newColor, 20);
    
    // Cập nhật CSS variables
    lessonBtn.style.setProperty('--base-color', newColor);
    lessonBtn.style.setProperty('--gradient-color', gradientColor);
    lessonBtn.style.setProperty('--border-color', borderColor);
    lessonBtn.title = newTitle;
  }
  
  // Cập nhật tiêu đề nếu đang học bài này
  if (currentLesson && currentLesson.id === lessonId) {
    document.getElementById('currentLessonTitleDisplay').textContent = newTitle;
    currentLesson.title = newTitle;
    currentLesson.color = newColor; // CẬP NHẬT MÀU
  }
  
  // Cập nhật dropdown chọn bài học (nếu có)
  const lessonSelect = document.getElementById('lessonSelect');
  if (lessonSelect) {
    const option = lessonSelect.querySelector(`option[value="${lessonId}"]`);
    if (option) option.textContent = newTitle;
  }
}



function updateLessonTitle(lessonId, newTitle) {
  renderLessonSidebar(); // Cập nhật sidebar
  initLessonSelection();
  const lesson = lessons.find(l => l.id === lessonId);
  if (lesson) {
    lesson.title = newTitle;
    
    console.log('Đang lưu tiêu đề mới:', newTitle);
    saveDataToStorage();
    
    const savedData = localStorage.getItem('hanNguLessons');
    console.log('Dữ liệu sau khi lưu:', savedData);
  }
  
  const lessonSelect = document.getElementById('lessonSelect');
  const option = lessonSelect.querySelector(`option[value="${lessonId}"]`);
  if (option) option.textContent = newTitle;
  
  if (currentLesson && currentLesson.id === lessonId) {
    document.getElementById('currentLessonTitleDisplay').textContent = newTitle;
    currentLesson.title = newTitle;
  }
  
  if (document.getElementById('dictionaryModal').style.display === 'flex') {
    renderDictionary();
  }
}

function showMessage(message, type) {
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${type}`;
  messageDiv.textContent = message;
    const oldMsg = document.querySelector('.message');
  if (oldMsg) oldMsg.remove();
  
  document.querySelector('.add-word-content').appendChild(messageDiv);
 
  setTimeout(() => {
    messageDiv.remove();
  }, 2000);;//localStorage.removeItem('hanNguAuthenticated');//
}





function loadTimeSettings() {
  const savedSettings = localStorage.getItem('timeSettings');
  if (savedSettings) {
    try {
      const settings = JSON.parse(savedSettings);
      timePerWord = settings.timePerWord || 30; 
      correctBonusTime = settings.correctBonusTime || 15;
      wrongBonusTime = settings.wrongBonusTime || 10;
      wordCount = settings.wordCount || 20;
      maxPinyinShowCount = settings.pinyinCount || 10;
      showVietnamese = settings.showVietnamese !== undefined ? settings.showVietnamese : true;
      showRadicalAnalysis = settings.showRadicalAnalysis !== undefined ? settings.showRadicalAnalysis : true;
      showExampleInstead = settings.showExampleInstead !== undefined ? settings.showExampleInstead : false; // Thêm dòng này
      swapDisplay = settings.swapDisplay || false;
      preSpeak = settings.preSpeak !== undefined ? settings.preSpeak : true; // THÊM
      postSpeak = settings.postSpeak !== undefined ? settings.postSpeak : false; // THÊM
      showRewardMessage = settings.showRewardMessage !== undefined ? settings.showRewardMessage : true;
      showFirework = settings.showFirework !== undefined ? settings.showFirework : true;
      listenWriteMode = settings.listenWriteMode !== undefined ? settings.listenWriteMode : false;



      isSoundOn = settings.isSoundOn !== undefined ? settings.isSoundOn : true;

      


   
       if (listenWriteMode) {
    document.body.classList.add('listen-mode');
    // Buộc preSpeak = true, postSpeak = false
    preSpeak = true;
    postSpeak = false;
    document.getElementById('preSpeak').checked = true;
    document.getElementById('postSpeak').checked = false;
} else {
    document.body.classList.remove('listen-mode');

}
    if (preSpeak && postSpeak) { preSpeak = false;
      document.getElementById('preSpeak').checked = false;
       }
       document.getElementById('autoPronounce').checked = isSoundOn; 
            document.getElementById('listenWriteMode').checked = listenWriteMode;
      document.getElementById('showRewardMessage').checked = showRewardMessage;
      document.getElementById('showFirework').checked = showFirework;
      document.getElementById('timePerWord').value = timePerWord; 
      document.getElementById('swapDisplay').checked = swapDisplay;
      document.getElementById('showExampleInstead').checked = showExampleInstead; 
      document.getElementById('showRadicalAnalysis').checked = showRadicalAnalysis; 
      document.getElementById('showVietnamese').checked = showVietnamese;
      document.getElementById('correctBonusTime').value = correctBonusTime;
      document.getElementById('wrongBonusTime').value = wrongBonusTime;
      document.getElementById('wordCount').value = wordCount;
      document.getElementById('pinyinCount').value = maxPinyinShowCount;
      document.getElementById('autoPronounce').checked = isSoundOn;
              document.getElementById('preSpeak').checked = preSpeak; // THÊM
        document.getElementById('postSpeak').checked = postSpeak; // THÊM
    } catch (e) {
      console.error('Lỗi khi đọc cài đặt:', e);
    }
  }
}
document.getElementById('autoPronounce').addEventListener('change', function(e) {
    isSoundOn = e.target.checked;
    updateSoundIcon(); // Thêm dòng này để cập nhật loa ngay khi bấm nút
    if (isSoundOn) {
        speak("声音已开启"); 

    }
     saveTimeSettings(); 
});
let isProcessing = false;
function resetGame() {
document.getElementById('addWordSection').style.display = 'block';
document.querySelector('.dictionary-section').style.display = 'block';
document.querySelector('.lesson-sidebar').style.display = 'block';
document.getElementById('openCatalogBtn').style.display = 'block';
document.getElementById('dictionarySection').style.display = 'block';
document.getElementById('lessonSelection').style.display = 'block';
document.getElementById('gameScreen').style.display = 'none';
document.getElementById('darkModeToggle').style.display = 'block';
document.getElementById('wordCounter').style.display = 'none';

document.querySelectorAll('.pinyin-box').forEach(box => {
box.classList.remove('used');
});
initLessonSelection();
}



document.getElementById('gameScreen').style.display = 'none';
const backToLessonsBtn = document.getElementById('backToLessonsBtn');

document.addEventListener('keydown', function(e) {
    if (e.target.id === 'dictionarySearch') return;

    switch(e.key) {
        case 'Escape':
            e.preventDefault();
            
            // Sau đó mới đóng các modal
            document.getElementById('wordCounter').style.display = 'none';
            document.getElementById('pinyinIndicator').style.display = 'none';
            document.getElementById('dictionaryModal').style.display = 'none';
            document.getElementById('addWordModal').style.display = 'none';
            document.getElementById('lessonCatalog').style.display = 'none';
            document.getElementById('catalogOverlay').style.display = 'none';
            document.querySelectorAll('.move-options').forEach(el => el.remove());
            resetAddWordForm();
            resetGame();
            break;

case 'Enter':
    if (gameActive && document.getElementById('gameScreen').style.display === 'block') {
        e.preventDefault();
        const currentWord = remainingWords[currentWordIndex];
        if (currentWord && isSoundOn) { // Chỉ phát khi isSoundOn = true
            window.speechSynthesis.cancel();
            isSpeaking = false;
            speak(currentWord.chinese, true);
        }
    }
    break;
;
case ' ':
    if (gameActive && !isProcessing && remainingWords.length > 0) {
        e.preventDefault();
        isProcessing = true; 
        checkAnswer();
     
        setTimeout(() => {
            isProcessing = false;
        }, 200); 
    }
    break;
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && document.getElementById('resultContainer').style.display === 'block') {
        document.getElementById('restartBtn').click();
        e.preventDefault(); // Ngăn không cho form submit nếu có
    }
});

backToLessonsBtn.addEventListener('click', resetGame);
restartBtn.addEventListener('click', function() {
resetGameState();
startGame();
});

})
  </script>
</body>
</html>
